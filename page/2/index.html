<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>HKBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="时光岁月如流水，流水奔流入海不复回">
<meta property="og:type" content="website">
<meta property="og:title" content="HKBlog">
<meta property="og:url" content="https://huangxok.github.io/blog/page/2/index.html">
<meta property="og:site_name" content="HKBlog">
<meta property="og:description" content="时光岁月如流水，流水奔流入海不复回">
<meta property="article:author" content="HKmaster">
<meta property="article:tag" content="hexo">
<meta property="article:tag" content="jsxgraph">
<meta property="article:tag" content="xulrunner">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="HKBlog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">HKBlog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">努力不一定成功，放弃一定会很轻松</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://huangxok.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-函数式编程笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/03/03/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2017-03-03T06:41:58.000Z" itemprop="datePublished">2017-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/03/03/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">函数式编程笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="函数式编程笔记"><a href="#函数式编程笔记" class="headerlink" title="函数式编程笔记"></a>函数式编程笔记</h1><h2 id="柯里化示例1"><a href="#柯里化示例1" class="headerlink" title="柯里化示例1"></a>柯里化示例1</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> adder = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _args = [];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> _args.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> a + b;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        [].push.apply(_args, [].slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">arguments</span>.callee;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;    </span><br><span class="line"><span class="keyword">var</span> sum = adder();</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(sum);     <span class="comment">// Function</span></span><br><span class="line"> </span><br><span class="line">sum(<span class="number">100</span>,<span class="number">200</span>)(<span class="number">300</span>);    <span class="comment">// 调用形式灵活，一次调用可输入一个或者多个参数，并且支持链式调用</span></span><br><span class="line">sum(<span class="number">400</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sum());   <span class="comment">// 1000 （加总计算）</span></span><br></pre></td></tr></table></figure>


<h2 id="柯里化示例2-currying"><a href="#柯里化示例2-currying" class="headerlink" title="柯里化示例2 currying"></a>柯里化示例2 currying</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currying = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _args = [];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, _args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Array</span>.prototype.push.apply(_args, [].slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">arguments</span>.callee;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> multi=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, c; c = <span class="built_in">arguments</span>[i++];) &#123;</span><br><span class="line">        total += c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> sum = currying(multi);  </span><br><span class="line">  </span><br><span class="line">sum(<span class="number">100</span>,<span class="number">200</span>)(<span class="number">300</span>);</span><br><span class="line">sum(<span class="number">400</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sum());     <span class="comment">// 1000  （空白调用时才真正计算）</span></span><br></pre></td></tr></table></figure>

<h2 id="柯里化示例3"><a href="#柯里化示例3" class="headerlink" title="柯里化示例3"></a>柯里化示例3</h2><p>柯里化的基础<br>上面的代码（示例2）其实是一个高阶函数（high-order function）, 高阶函数是指操作函数的函数，它接收一个或者多个函数作为参数，并返回一个新函数。此外，还依赖与闭包的特性，来保存中间过程中输入的参数。即：<br>函数可以作为参数传递<br>函数能够作为函数的返回值<br>闭包<br>柯里化的作用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addEvent = <span class="function"><span class="keyword">function</span>(<span class="params">el, type, fn, capture</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">         el.addEventListener(type, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">             fn.call(el, e);</span><br><span class="line">         &#125;, capture);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">         el.attachEvent(<span class="string">"on"</span> + type, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">             fn.call(el, e);</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125; </span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addEvent = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">el, sType, fn, capture</span>) </span>&#123;</span><br><span class="line">            el.addEventListener(sType, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                fn.call(el, e);</span><br><span class="line">            &#125;, (capture));</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">el, sType, fn, capture</span>) </span>&#123;</span><br><span class="line">            el.attachEvent(<span class="string">"on"</span> + sType, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                fn.call(el, e);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>Function.prototype.bind 方法也是柯里化应用<br>与 call/apply 方法直接执行不同，bind 方法 将第一个参数设置为函数执行的上下文，其他参数依次传递给调用方法（函数的主体本身不执行，可以看成是延迟执行），并动态创建返回一个新的函数， 这符合柯里化特点。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;<span class="attr">x</span>: <span class="number">888</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;.bind(foo);               <span class="comment">// 绑定</span></span><br><span class="line">bar();                     <span class="comment">// 888</span></span><br></pre></td></tr></table></figure>

<p>下面是一个 bind 函数的模拟，testBind 创建并返回新的函数，在新的函数中将真正要执行业务的函数绑定到实参传入的上下文，延迟执行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.testBind = <span class="function"><span class="keyword">function</span> (<span class="params">scope</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fn = <span class="keyword">this</span>;                    <span class="comment">//// this 指向的是调用 testBind 方法的一个函数， </span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fn.apply(scope);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> testBindBar = bar.testBind(foo);  <span class="comment">// 绑定 foo，延迟执行</span></span><br><span class="line"><span class="built_in">console</span>.log(testBindBar);             <span class="comment">// Function (可见，bind之后返回的是一个延迟执行的新函数)</span></span><br><span class="line">testBindBar();                        <span class="comment">// 888</span></span><br><span class="line"><span class="string">``</span><span class="string">`                       </span></span><br><span class="line"><span class="string">这里要注意 prototype 中 this 的理解。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 组合 compose</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">示例1</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">var</span> compose = <span class="function"><span class="keyword">function</span>(<span class="params">f,g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toUpperCase = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x.toUpperCase(); &#125;;</span><br><span class="line"><span class="keyword">var</span> exclaim = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x + <span class="string">'!'</span>; &#125;;</span><br><span class="line"><span class="keyword">var</span> shout = compose(exclaim, toUpperCase);</span><br><span class="line">shout(<span class="string">"send in the clowns"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shout = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> exclaim(toUpperCase(x));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>示例2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> head = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x[<span class="number">0</span>]; &#125;;</span><br><span class="line"><span class="keyword">var</span> reverse = reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, x</span>)</span>&#123; <span class="keyword">return</span> [x].concat(acc); &#125;, []);</span><br><span class="line"><span class="keyword">var</span> last = compose(head, reverse);</span><br><span class="line"></span><br><span class="line">last([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>]);</span><br><span class="line"><span class="comment">//=&gt; 'uppercut'</span></span><br></pre></td></tr></table></figure>
<p>** head ** 取第一个元素,** reverse **反转元素序列</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结合律（associativity）</span></span><br><span class="line"><span class="keyword">var</span> associative = compose(f, compose(g, h)) == compose(compose(f, g), h);</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>compose 的调用分组不重要，所以结果都是一样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compose(toUpperCase, compose(head, reverse));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">compose(compose(toUpperCase, head), reverse);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前面的例子中我们必须要写两个组合才行，但既然组合是符合结合律的，我们就可以只写一个，</span></span><br><span class="line"><span class="comment">// 而且想传给它多少个函数就传给它多少个，然后让它自己决定如何分组。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lastUpper = compose(toUpperCase, head, reverse);</span><br><span class="line"></span><br><span class="line">lastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>]);</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loudLastUpper = compose(exclaim, toUpperCase, head, reverse)</span><br><span class="line"></span><br><span class="line">loudLastUpper([<span class="string">'jumpkick'</span>, <span class="string">'roundhouse'</span>, <span class="string">'uppercut'</span>]);</span><br><span class="line"><span class="comment">//=&gt; 'UPPERCUT!'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loudLastUpper = compose(exclaim, toUpperCase, head, reverse);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">var</span> last = compose(head, reverse);</span><br><span class="line"><span class="keyword">var</span> loudLastUpper = compose(exclaim, toUpperCase, last);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">var</span> last = compose(head, reverse);</span><br><span class="line"><span class="keyword">var</span> angry = compose(exclaim, toUpperCase);</span><br><span class="line"><span class="keyword">var</span> loudLastUpper = compose(angry, last);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更多变种...</span></span><br></pre></td></tr></table></figure>



<h3 id="pointerfree"><a href="#pointerfree" class="headerlink" title="pointerfree"></a>pointerfree</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非 pointfree，因为提到了数据：word</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = <span class="function"><span class="keyword">function</span> (<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> word.toLowerCase().replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pointfree</span></span><br><span class="line"><span class="keyword">var</span> snakeCase = compose(replace(<span class="regexp">/\s+/ig</span>, <span class="string">'_'</span>), toLowerCase);</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非 pointfree，因为提到了数据：name</span></span><br><span class="line"><span class="keyword">var</span> initials = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name.split(<span class="string">' '</span>).map(compose(toUpperCase, head)).join(<span class="string">'. '</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pointfree</span></span><br><span class="line"><span class="keyword">var</span> initials = compose(join(<span class="string">'. '</span>), map(compose(toUpperCase, head)), split(<span class="string">' '</span>));</span><br><span class="line"></span><br><span class="line">initials(<span class="string">"hunter stockton thompson"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>组合的一个常见错误是，在没有局部调用之前，就组合类似 map 这样接受两个参数的函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误做法：我们传给了 `angry` 一个数组，根本不知道最后传给 `map` 的是什么东西。</span></span><br><span class="line"><span class="keyword">var</span> latin = compose(map, angry, reverse);</span><br><span class="line"></span><br><span class="line">latin([<span class="string">"frog"</span>, <span class="string">"eyes"</span>]);</span><br><span class="line"><span class="comment">// error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确做法：每个函数都接受一个实际参数。</span></span><br><span class="line"><span class="keyword">var</span> latin = compose(map(angry), reverse);</span><br><span class="line"></span><br><span class="line">latin([<span class="string">"frog"</span>, <span class="string">"eyes"</span>]);</span><br><span class="line"><span class="comment">// ["EYES!", "FROG!"])</span></span><br></pre></td></tr></table></figure>


<p><a href="http://www.2cto.com/kf/201412/357997.html" target="_blank" rel="noopener">http://www.2cto.com/kf/201412/357997.html</a></p>
<p><a href="https://www.gitbook.com/book/llh911001/mostly-adequate-guide-chinese/details" target="_blank" rel="noopener">https://www.gitbook.com/book/llh911001/mostly-adequate-guide-chinese/details</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2017/03/03/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" data-id="ckb7ljdxq002clis6279q8oy3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/curry/" rel="tag">curry</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-XULRunner-Gecko-Firefox" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/01/13/XULRunner-Gecko-Firefox/" class="article-date">
  <time datetime="2017-01-13T02:03:15.000Z" itemprop="datePublished">2017-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/01/13/XULRunner-Gecko-Firefox/">xulrunner-gecko-firefox</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="XULRunner"><a href="#XULRunner" class="headerlink" title="XULRunner"></a>XULRunner</h2><h3 id="软件和工具"><a href="#软件和工具" class="headerlink" title="软件和工具"></a>软件和工具</h3><p>发行版下载<br>下载站点</p>
<p><a href="http://ftp.mozilla.org/pub/firefox/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/firefox/</a></p>
<p><a href="http://download.cdn.mozilla.net/pub/mozilla.org/" target="_blank" rel="noopener">http://download.cdn.mozilla.net/pub/mozilla.org/</a></p>
<p>xulrunner 在这里：</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/releases/latest/runtimes/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/releases/latest/runtimes/</a> – 稳定版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/candidates/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/candidates/</a> – beta版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-aurora/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-aurora/</a> – aurora版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-central/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-central/</a> – central版</p>
<p>firefox 在这里：</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/firefox/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/firefox/</a></p>
<p>注意，xulrunner 只提供英文版，而 firefox 则有各种本地化版本，例如</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-mozilla-aurora-l10n/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-mozilla-aurora-l10n/</a></p>
<p>firefox sdk 只在 aurora 里面有，如<br><a href="http://ftp.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-47.0a2.en-US.win32.sdk.zip" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-47.0a2.en-US.win32.sdk.zip</a></p>
<p>可以利用后者的资源文件本地化前者，详见“本地化”。</p>
<h3 id="XULRunner-参考"><a href="#XULRunner-参考" class="headerlink" title="XULRunner 参考"></a>XULRunner 参考</h3><p>Creating Applications with Mozilla<br>  <a href="http://books.mozdev.org/html/index.html" target="_blank" rel="noopener">http://books.mozdev.org/html/index.html</a></p>
<p>XULRunner in large projects<br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-1-what-is-that-xulrunner-thingy-anyway" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-1-what-is-that-xulrunner-thingy-anyway</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-2-why-xulrunner-isn-t-like-java" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-2-why-xulrunner-isn-t-like-java</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-3-bugs-bugs-and-more-bugs" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-3-bugs-bugs-and-more-bugs</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-4-localization-pitfalls" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-4-localization-pitfalls</a></p>
<p>Getting_started_with_XULRunner<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Getting_started_with_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Getting_started_with_XULRunner</a><br>Structure_of_an_installable_bundle<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Structure_of_an_installable_bundle" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Structure_of_an_installable_bundle</a><br>XULRunner_tips<br>  <a href="https://developer.mozilla.org/en-US/docs/XULRunner_tips" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XULRunner_tips</a><br>JavaScript code modules<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules</a><br>Windows_and_menus<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Windows_and_menus_in_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Windows_and_menus_in_XULRunner</a><br>Dialogs<br>  <a href="https://developer.mozilla.org/en-US/docs/Dialogs_in_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Dialogs_in_XULRunner</a><br>browser<br>  <a href="https://developer.mozilla.org/en-US/docs/XUL/browser" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/browser</a><br>Stream<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide</a><br>Using JavaScript code modules<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Using#Importing_CommonJS_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Using#Importing_CommonJS_modules</a><br>nsIDirectoryService<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Using_nsIDirectoryService" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Using_nsIDirectoryService</a></p>
<p>A Brief Introduction To XULRunner<br>  <a href="http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_1" target="_blank" rel="noopener">http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_1</a><br>  <a href="http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_2" target="_blank" rel="noopener">http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_2</a></p>
<p>Mozilla 错误代码表 error codes<br>  <a href="https://developer.mozilla.org/en-US/docs/Table_Of_Errors" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Table_Of_Errors</a><br>  <a href="http://james-ross.co.uk/mozilla/misc/nserror_list" target="_blank" rel="noopener">http://james-ross.co.uk/mozilla/misc/nserror_list</a></p>
<p>使用XPCOM:实现高级处理<br>  <a href="http://caoyue.sinaapp.com/?p=430" target="_blank" rel="noopener">http://caoyue.sinaapp.com/?p=430</a></p>
<p>样例代码<br>  <a href="https://github.com/matthewkastor/XULRunner-Examples" target="_blank" rel="noopener">https://github.com/matthewkastor/XULRunner-Examples</a></p>
<p>Mozilla研究<br>  Mozilla研究—用户界面的基本要素 <a href="http://www.cnblogs.com/faunus/archive/2009/04/12/1434213.html" target="_blank" rel="noopener">http://www.cnblogs.com/faunus/archive/2009/04/12/1434213.html</a><br>  Mozilla研究—XUL窗口创建和事件处理 <a href="http://www.cnblogs.com/faunus/archive/2009/04/12/1434214.html" target="_blank" rel="noopener">http://www.cnblogs.com/faunus/archive/2009/04/12/1434214.html</a></p>
<p>Add-ons/Extension Signing<br>  <a href="https://wiki.mozilla.org/Addons/Extension_Signing" target="_blank" rel="noopener">https://wiki.mozilla.org/Addons/Extension_Signing</a>  </p>
<p>system/child_process<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process</a></p>
<h3 id="XUL-应用结构"><a href="#XUL-应用结构" class="headerlink" title="XUL 应用结构"></a>XUL 应用结构</h3><ul>
<li>myapp/<br>|</li>
<li>-+ chrome/<br>| |<br>| +-+ content/<br>| | |<br>| | +– main.xul<br>| | |<br>| | +– main.js<br>| |<br>| +– chrome.manifest //用于向下兼容，可以没有<br>|</li>
<li>-+ defaults/<br>| |<br>| +-+ preferences/<br>|   |<br>|   +– prefs.js<br>|</li>
<li>– application.ini<br>|</li>
<li>– chrome.manifest </li>
</ul>
<p>与 extension 相比，XUL 应用只是多出了 application.ini 文件，但少了intall.rdf。<br>其它部分，如 chrome.manifest 与 extension 中的写法相同。</p>
<ul>
<li>默认执行的 xul<br>The prefs.js file tells XULRunner the name of the XUL file to use as the main window. Here is mine:</li>
</ul>
<p>pref(“toolkit.defaultChromeURI”, “chrome://myapp/content/main.xul”);</p>
<p>如果没有指定，xulrunner 会试图查找 content （chrome.manifest 中，content 指令指明的目录）中与 package 同名的 xul 文件，例如chrome/content/myapp.xul。</p>
<ul>
<li>application.ini<br><a href="https://developer.mozilla.org/en-US/docs/XUL_Application_Packaging" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL_Application_Packaging</a></li>
</ul>
<p>注意  Profile=MyAppData 可以指定Profile目录。在linux上是 $HOME/.MyAppData。</p>
<h3 id="Deploying"><a href="#Deploying" class="headerlink" title="Deploying"></a>Deploying</h3><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Deploying_XULRunner_1.8" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Deploying_XULRunner_1.8</a></p>
<pre><code>installdir/
    application.ini
    components/
        ... components which are part of the application
    chrome/
        ... chrome which is part of the application
    ... additional application files such as icons, etc
    myapplicationname.exe (This is the &quot;stub executable&quot;... you should copy and rename this file from xulrunner-stub.exe in your XULRunner installation.)
    xulrunner/
        ... copy xulrunner/ to this directory</code></pre><p>When deploying with XULRunner 2.0 and above do the following:</p>
<pre><code>Move chrome.manifest to the root directory, and adjust resource paths inside chrome.manifest accordingly

With XULRunner 9.0 or 10.0 you may need to copy &quot;mozutils.dll&quot; and/or &quot;mozcrt19.dll&quot; from the xulrunner directory to the root directory. This should be fixed with XULRunner 11.0

With XULRunner 11.0 you may need to copy &quot;gkmedias.dll&quot; from the xulrunner directory to the root directory</code></pre><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>linux/windows：<br>xulrunner <path_to_app>/application.ini</p>
<p>使用firefox:<br>firefox -app path/to/application.ini</p>
<h3 id="全屏-fullscreen"><a href="#全屏-fullscreen" class="headerlink" title="全屏/fullscreen"></a>全屏/fullscreen</h3><p>xul 26 可支持全屏，但默认没有打开，mybrowser例子可以在about:config中搜索full-screen打开。<br>相关选项：<br>full-screen-api.enabled;true<br>full-screen-api.allow-trusted-requests-only;true<br>full-screen-api.approval-required;true<br>full-screen-api.content-only;false<br>full-screen-api.pointer-lock.enabled;true</p>
<p>一般只需要改 full-screen-api.enabled 一项。</p>
<p>不过窗口管理似乎需要自己实现，mybrowser例子的全屏只是占满整个viewport。</p>
<h3 id="给-xulrunner-安装扩展"><a href="#给-xulrunner-安装扩展" class="headerlink" title="给 xulrunner 安装扩展"></a>给 xulrunner 安装扩展</h3><ul>
<li>FF 扩展的兼容性<br><a href="http://stackoverflow.com/questions/18588542/run-firefox-extensions-in-xulrunner" target="_blank" rel="noopener">http://stackoverflow.com/questions/18588542/run-firefox-extensions-in-xulrunner</a><br>Existing extensions may run, with or without modifications in such a xulrunner app. Well, likely with modifications, as most extensions use APIs specific to Firefox or Thunderbird or …</li>
</ul>
<p>The add-on SDK is not generally isn’t a good fit for generic xulrunner apps: It is too much tailered against Firefox specifically.<br><a href="http://stackoverflow.com/questions/8334415/adding-add-on-bar-to-a-custom-xulrunner-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/8334415/adding-add-on-bar-to-a-custom-xulrunner-application</a></p>
<ul>
<li><p>将扩展安装到 xulrunner 本身中<br>在 xulrunner 目录下建立如下子目录<br>distribution/bundles/&lt;扩展的名字&gt;<br>然后将扩展的文件放到&lt;扩展的名字&gt;下面，让install.rdf、chrome.manifest等文件位于&lt;扩展的名字&gt;目录下；如果是xpi文件则要解压。<br>&lt;扩展的名字&gt; 应该可以随便取。</p>
</li>
<li><p>将扩展安装到 xulrunner app 中<br>在 xulrunner 应用的目录下建立如下子目录：<br>extensions/&lt;扩展的名字&gt;<br>将扩展的文件放到&lt;扩展的名字&gt;下面，让install.rdf、chrome.manifest等文件位于&lt;扩展的名字&gt;目录下。<br>或者将扩展的xpi文件直接放到extensions/下面，例如<br>extensions/&lt;扩展的名字&gt;.xpi<br>注意 &lt;扩展的名字&gt; 不可随便取，应当等于 install.rdf 中的 em:id 的值。</p>
</li>
<li><p>Extension Manager<br><a href="https://developer.mozilla.org/en-US/docs/XULRunner_tips#Extension_Manager" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XULRunner_tips#Extension_Manager</a></p>
</li>
<li><p>扩展的更新<br><a href="http://stackoverflow.com/questions/12055985/updating-extensions-in-a-xulrunner-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/12055985/updating-extensions-in-a-xulrunner-application</a><br>可以设置自动更新扩展</p>
</li>
</ul>
<h3 id="XUL-语法和控件"><a href="#XUL-语法和控件" class="headerlink" title="XUL 语法和控件"></a>XUL 语法和控件</h3><ul>
<li>样式表<?xml-stylesheet href="chrome://global/skin" type="text/css"?>
这个引用的是默认样式表。如果要自定义，可以在自定义样式表中引入，例如<br>in xul:<?xml-stylesheet href="chrome://basicapp/skin/main.css" type="text/css"?>
in basicapp/skin/main.css:<br>@import url(chrome://global/skin/);</li>
</ul>
<p>html 样式表是怎样的？</p>
<ul>
<li><p>namespace<br>xmlns:xul =”<a href="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;" target="_blank" rel="noopener">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</a><br>xmlns:html=”<a href="http://www.w3.org/1999/xhtml&quot;" target="_blank" rel="noopener">http://www.w3.org/1999/xhtml&quot;</a><br>注意 xul 中允许混合 html标签。</p>
</li>
<li><p>window<br>这是顶层元素<br>&lt;xul:window title     =”&amp;mybrowser.title;”</p>
<pre><code>xmlns:xul =&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;
xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;
id        =&quot;mybrowser&quot;
width     =&quot;800&quot;
height    =&quot;600&quot;&gt;</code></pre></li>
<li><p>script<br>&lt;xul:script type=”application/javascript”</p>
<pre><code>src=&quot;chrome://myapp/content/mybrowser.js&quot; /&gt;</code></pre><p>html script 可以吗？</p>
</li>
<li><p>browser 组件<br>&lt;xul:browser flex=”1”</p>
<pre><code>id  =&quot;browser&quot;
src =&quot;&quot;
type=&quot;content-primary&quot; /&gt;</code></pre></li>
</ul>
<h2 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h2><p><a href="http://kb.mozillazine.org/Starting_your_Mozilla_application_with_a_specified_profile#Bypassing_the_Profile_Manager" target="_blank" rel="noopener">http://kb.mozillazine.org/Starting_your_Mozilla_application_with_a_specified_profile#Bypassing_the_Profile_Manager</a></p>
<p>启动profile管理器来选择一个profile：<br>  <xul_app> -P<br>直接选择指定的 profile 名字：<br>  <xul_app> -P profileName<br>直接选择指定的 profile 路径。如果是个空目录，则会在该目录中创建新 profile。<br>  <xul_app> -profile path_to_profile</p>
<p><xul_app> 可以是 firefox，xulrunner，xulrunner-stub 等。</p>
<p><xul_app> 最终是调用 XRE_main(argc, argv, …) 函数，以上参数都是传给这个函数的。<br>以编程的方式增加 XRE_main() 的参数也可以实现自定义 profile 路径，例如 duanyao/xulrunner-stub。</p>
<p>另一个自定义 profile 路径的方法是使用 nsIDirectoryServiceProvider，自定义 “ProfD”。geckofx 采用此方法。</p>
<h2 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h2><h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><p>从 FF 43 起，扩展将被要求有数字签名才能运行。<br>普通版的 FF 没有可以关闭签名验证的选项，而 developer edition 可以通过修改 xpinstall.signatures.required 偏好来关闭签名验证。<br>签名的方法见[Add-ons/Extension Signing]。</p>
<h3 id="Comparing-Extension-Toolchains"><a href="#Comparing-Extension-Toolchains" class="headerlink" title="Comparing_Extension_Toolchains"></a>Comparing_Extension_Toolchains</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Comparing_Extension_Toolchains" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Comparing_Extension_Toolchains</a></p>
<p>There are three common methods of developing extensions: the Add-on SDK, manually bootstrapped restartless extensions, and legacy, overlay-based restartful extensions.</p>
<h3 id="传统-extention"><a href="#传统-extention" class="headerlink" title="传统 extention"></a>传统 extention</h3><p>Building_an_Extension<br>  <a href="https://developer.mozilla.org/en-US/docs/Building_an_Extension" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Building_an_Extension</a></p>
<p>Getting_Started_with_Firefox_Extensions<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/Getting_Started_with_Firefox_Extensions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/Getting_Started_with_Firefox_Extensions</a></p>
<p>The_Essentials_of_an_Extension<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/The_Essentials_of_an_Extension" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/The_Essentials_of_an_Extension</a><br>  install.rdf</p>
<p>Setting_up_extension_development_environment<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Setting_up_extension_development_environment" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Setting_up_extension_development_environment</a></p>
<p>Install_Manifests (intall.rdf)<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Install_Manifests" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Install_Manifests</a></p>
<p>Chrome_Registration (chrome.manifest)<br>  <a href="https://developer.mozilla.org/en-US/docs/Chrome_Registration" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Chrome_Registration</a></p>
<h3 id="设置开发环境"><a href="#设置开发环境" class="headerlink" title="设置开发环境"></a>设置开发环境</h3><ul>
<li>新建开发 profile<br>firefox -no-remote -P dev</li>
</ul>
<p>-no-remote 是必要的，这样可以同时运行多个ff进程。</p>
<ul>
<li>链接开发中的扩展到 profile<br>定位到刚才创建的 profile 下的 extensions 目录，创建一个文本文件，名字是你的 extension 的 id （在install.rdf中），<br>内容是到你的 extension 的全路径，而且要以 /或\结尾。</li>
</ul>
<h3 id="Bootstrapped-extensions"><a href="#Bootstrapped-extensions" class="headerlink" title="Bootstrapped extensions"></a>Bootstrapped extensions</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Bootstrapped_extensions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Bootstrapped_extensions</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Extensions/bootstrap.js" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Extensions/bootstrap.js</a></p>
<p><a href="http://www.oxymoronical.com/blog/2011/01/Playing-with-windows-in-restartless-bootstrapped-extensions" target="_blank" rel="noopener">http://www.oxymoronical.com/blog/2011/01/Playing-with-windows-in-restartless-bootstrapped-extensions</a></p>
<h3 id="Add-on-SDK"><a href="#Add-on-SDK" class="headerlink" title="Add-on SDK"></a>Add-on SDK</h3><p>The Add-on SDK consists of two things:</p>
<pre><code>a command-line tool to help test and package extensions
a set of JavaScript APIs, built into Firefox, to create extensions, including APIs to build user interfaces, to interact with the browser and to interact with web content</code></pre><p><a href="https://developer.mozilla.org/en-US/Add-ons/SDK" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/cfx" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/cfx</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Add_a_Menu_Item_to_Firefox" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Add_a_Menu_Item_to_Firefox</a></p>
<ul>
<li>command line tool<br>If you give –profiledir a path to a nonexistent profile, cfx will create a profile there for you. So you just have to make up a path and name the first time, and keep using it:</li>
</ul>
<p>cfx run –profiledir=”~/addon-dev/profiles/boogaloo”</p>
<ul>
<li>resource<br>属于扩展的资源放在data/目录下，其url的解析要使用<br>self.data.url() 函数，例如：<br>var self = require(“sdk/self”);<br>var url = self.data.url(“content.htm”);<br>得到的结果类似：<br>resource://jid1-mf8k5xsb2s4vng-at-jetpack/hello/data/content.htm</li>
</ul>
<p>注意 resource: 协议下的文档默认是没有特权的。</p>
<ul>
<li><p>High/Low-Level APIs<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs</a></p>
</li>
<li><p>package.json<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/package_json" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/package_json</a></p>
</li>
<li><p>chrome<br>chrome.manifest 文件默认是没有的，也没有可以用 chrome: 协议访问的资源。<br>可以在工程根目录下自行建立这些文件，例如<br>chrome.manifest<br>chrome/<br>content/<br>locale/<br>skin/</p>
</li>
</ul>
<p>chrome.manifest 的内容是：<br>content  hello  chrome/content/<br>…</p>
<p>注意，chrome 目录的名字是固定的，否则 SDK 认不出来（其它情况下不要求）。</p>
<ul>
<li>io_file<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_file" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_file</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_byte-streams" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_byte-streams</a></li>
</ul>
<p>功能不是很强，不适合高效地处理二进制文件。</p>
<h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><p><a href="https://developer.mozilla.org/en/extension_versioning,_update_and_compatibility" target="_blank" rel="noopener">https://developer.mozilla.org/en/extension_versioning,_update_and_compatibility</a></p>
<h3 id="打包和安装"><a href="#打包和安装" class="headerlink" title="打包和安装"></a>打包和安装</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Extension_Packaging" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Extension_Packaging</a></p>
<p>An XPI (XPInstall) file is simply a ZIP file containing the extension files, with the install.rdf file at the root of the ZIP. Users can download and install XPI files off a website or from a local file, by opening it or dragging it into the Extension Manager window.</p>
<p>Install extension files directly</p>
<p>If you know the location of the application (if you are installing an extension as part of the application installer, for example), you can install the extension files directly to <appdir>/extensions/<extensionID>. The extension will be found automatically by the extension manager the next time the application is launched.</p>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Extension_Frequently_Asked_Questions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Extension_Frequently_Asked_Questions</a></p>
<h2 id="特殊协议chrome-和resource"><a href="#特殊协议chrome-和resource" class="headerlink" title="特殊协议chrome:和resource:"></a>特殊协议chrome:和resource:</h2><p>参考：<br><a href="https://developer.mozilla.org/en-US/docs/Chrome_Registration" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Chrome_Registration</a><br><a href="https://developer.mozilla.org/en-US/docs/XUL/Tutorial/The_Chrome_URL" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/Tutorial/The_Chrome_URL</a></p>
<p>两者都可以用 chrome.manifest 文件来注册</p>
<h3 id="chrome"><a href="#chrome" class="headerlink" title="chrome"></a>chrome</h3><p>content</p>
<p>A content package is registered with the line</p>
<p>content packagename uri/to/files/ [flags]</p>
<p>This will register a location to use when resolving the URI chrome://packagename/content/…. The URI may be absolute or relative to the location of the manifest file. Note: it must end with a ‘/‘.</p>
<p>注意包名（packagename）只能用小写字母，否则会引起大小写不一致的问题，因为<br>FF 会在读取 src/href 等 WebIDL 属性时将包名部分都转化为小写。参考：<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=132183" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=132183</a></p>
<p>chrome 协议下的页面有特权，但是不可以访问 DOM storage。详见 DOM Storage。</p>
<h3 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h3><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><ul>
<li>chrome.manifest 注册法<br>在 chrome.manifest 文件中，Aliases can be created using the resource instruction:</li>
</ul>
<p>resource aliasname uri/to/files/ [flags]</p>
<p>This will create a mapping for resource://<aliasname>/ URIs to the path given.</p>
<p>当前目录的写法是 ‘./‘。</p>
<p>chrome.manifest 也可以动态注册、删除，即利用 nsIComponentManager<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIComponentManager" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIComponentManager</a></p>
<p>addBootstrappedManifestLocation((in nsILocalFile aLocation)<br>  Loads a “bootstrapped” chrome.manifest file from the specified directory or XPI file. A “bootstrapped” chrome manifest supports some of the instructions allowed in a regular chrome manifest, see the Chrome Registration documentation for details.</p>
<p>void removeBootstrappedManifestLocation(in interface nsILocalFile aLocation);</p>
<p>在 JS 中，可以用 Components.manager 获得实例。<br>在 geckofx 中，可以通过 Xpcom.ComponentManager 属性得到实例。</p>
<ul>
<li>resource 动态注册法<br>也可以在js代码中注册 resource alias<br>参考 <a href="https://developer.mozilla.org/en/Using_JavaScript_code_modules#Programmatically_adding_aliases" target="_blank" rel="noopener">https://developer.mozilla.org/en/Using_JavaScript_code_modules#Programmatically_adding_aliases</a><br>中 Extending resource: URLs 一节。</li>
</ul>
<p>这个方法也可以注册本地磁盘目录为 resource alias。</p>
<p>用于 bootstrap addon 时（参考 <a href="http://starkravingfinkle.org/blog/2011/01/restartless-add-ons-more-resources/）：" target="_blank" rel="noopener">http://starkravingfinkle.org/blog/2011/01/restartless-add-ons-more-resources/）：</a></p>
<p>function startup(aData, aReason) {<br>  let resource = Services.io.getProtocolHandler(“resource”).QueryInterface(Ci.nsIResProtocolHandler);<br>  let alias = Services.io.newFileURI(aData.installPath);<br>  if (!aData.installPath.isDirectory())<br>    alias = Services.io.newURI(“jar:” + alias.spec + “!/“, null, null);<br>  resource.setSubstitution(“myaddonpackage”, alias);<br>  …<br>}</p>
<p>function shutdown(aData, aReason) {<br>  if (aReason == APP_SHUTDOWN) return;</p>
<p>  let resource = Services.io.getProtocolHandler(“resource”).QueryInterface(Ci.nsIResProtocolHandler);<br>  resource.setSubstitution(“myaddonpackage”, null);<br>  …</p>
<p>The isDirectory check is needed because it is possible for add-ons to be installed in folders or XPI bundles, which require the jar: URI syntax. The code adds a resource alias, after which you can use URIs like this:</p>
<p>resource://myaddonpackage/images/someimage.png<br>resource://myaddonpackage/content/somescript.js</p>
<p>注：可以注册多个 resource: 别名。</p>
<ul>
<li><p>限制<br>resource: 映射的路径似乎必须在 addon 的根目录下，否则虽然能注册成功，但访问会失败，xhr访问的时候得到onerror事件，但没有写出原因。</p>
</li>
<li><p>addon-sdk<br>注意：addon-sdk开发的扩展不用 chrome.manifest 注册，即使在 chrome.manifest 写了 resource 指令也是无效的。<br>参考：<a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide</a><br><a href="https://blog.mozilla.org/addons/2012/01/11/sdk-1-4-known-issue-with-hard-coding-resource-uris/" target="_blank" rel="noopener">https://blog.mozilla.org/addons/2012/01/11/sdk-1-4-known-issue-with-hard-coding-resource-uris/</a><br>addon-sdk 的资源总是在 data 目录下，构建的时候复制到 resources 目录下。<br>addon-sdk 采用动态注册法。</p>
</li>
<li><p>权限<br>resource 协议下的页面没有特权，但是可以访问 DOM storage。详见 DOM Storage。<br>There are no security restrictions preventing web content from including content at resource: URIs, so take care what you make visible there.<br>[似乎是说，任意的web页面也可以访问 resource: URIs，所以不要放敏感内容在这里]</p>
</li>
</ul>
<h2 id="manifest-的其他特性"><a href="#manifest-的其他特性" class="headerlink" title="manifest 的其他特性"></a>manifest 的其他特性</h2><h3 id="chrome-1"><a href="#chrome-1" class="headerlink" title="chrome"></a>chrome</h3><p>chrome path_to_manifest<br>chrome 指令可以用来引入另一个 .manifest 文件，这个文件就不一定要叫 chrome.manifest 了。例如<br>  chrome components.manifest</p>
<h3 id="locale"><a href="#locale" class="headerlink" title="locale"></a>locale</h3><p>  locale branding zh-CN zh-CN/locale/branding/</p>
<h3 id="override"><a href="#override" class="headerlink" title="override"></a>override</h3><p>用来覆盖一个之前（如在omni.ja中）定义的文件，例如<br>  override chrome://global/locale/dom/dom.properties zh-CN/locale/global/dom/dom.properties</p>
<h3 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces"></a>interfaces</h3><p>用来引入 JS 的 XPCOM 接口定义文件（.xpt），它决定了 Components.interfaces 的内容。<br>  interfaces interfaces.xpt</p>
<h3 id="使用-jar-协议"><a href="#使用-jar-协议" class="headerlink" title="使用 jar 协议"></a>使用 jar 协议</h3><p>manifest 也可以引用位于 zip 包中的位置，这需要在路径部分使用 jar 协议，例如：<br>  content devtools jar:devtools.zip!/chrome/devtools/content/</p>
<p>“jar:” 后面跟上 zip 文件的相对路径，”!” 后面跟上 zip 内部的路径。<br>jar 协议适用于 content, resource, locale 等指令，但似乎不适用 chrome 和 interfaces 指令。</p>
<h2 id="XULRunner-net绑定"><a href="#XULRunner-net绑定" class="headerlink" title="XULRunner .net绑定"></a>XULRunner .net绑定</h2><h3 id="geckofx"><a href="#geckofx" class="headerlink" title="geckofx"></a>geckofx</h3><ul>
<li>源码<br>源码库在此：<a href="https://bitbucket.org/geckofx" target="_blank" rel="noopener">https://bitbucket.org/geckofx</a><br>最新版：<a href="https://bitbucket.org/geckofx/geckofx-29.0" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0</a></li>
</ul>
<p>已经包含以前的版本，可以导出版本历史：<br>hg log &gt; log.txt<br>然后查找版本号“13.0”之类的tag，然后用hg转到该版本：<br>hg update v13.0-0.1</p>
<ul>
<li>编译</li>
</ul>
<p>下载XULRunner发行版，解压到PutXulRunnerFolderHere中。<br>注意geckofx的版本要和xulrunner一致，它没有向下兼容性。</p>
<p>VS /monodevelpe直接编译即可。运行GeckoFxTest工程。</p>
<ul>
<li>profile 目录<br>默认的是在 local application data directory下，例如<br>C:\Users\duanyao\AppData\Local\Geckofx\DefaultProfile<br>可以通过 Xpcom.ProfileDirectory 设置和读取。</li>
</ul>
<ul>
<li>注册xulrunner应用、扩展<br>geckofx 不会像 xulrunner 可执行程序那样自动注册 xulrunner 应用及其扩展。<br>如果 xulrunner 自带扩展，则扩展仍要逐一注册，不会自动注册。<br>注册至少包括以下3个步骤（顺序应该没关系）：</li>
</ul>
<ul>
<li><p>注册 chrome: 协议映射<br>仍用 chrome.manifest 文件来定义映射，然后调用：<br>Xpcom.ComponentManager.AddBootstrappedManifestLocation(chromeDir)<br>chromeDir 指向 chrome.manifest 文件所在的目录。</p>
</li>
<li><p>注册 XPCOM 组件<br>仍用 chrome.manifest 文件登记组件。<br>Xpcom.ComponentRegistrar.AutoRegister(chromeFile);<br>chromeFile 指向 chrome.manifest 文件（不是目录）。</p>
</li>
<li><p>注册 preference<br>GeckoPreferences.Load(preffile);<br>preffile 指向包含 pref 调用的 js 文件。</p>
</li>
</ul>
<p>注意，这个方法是有副作用的：将preffile设置为用户的pref文件，这样，当用户通过 about:config 修改偏好后，会把用户设置的偏好都写入该文件。<br>不过，通过 GeckoPreferences.User[] 设置的偏好则不会触发写入，但写入时会包括GeckoPreferences.User[]设置的值。<br>为了避免覆盖 preffile，可以多次调用 GeckoPreferences.Load，在最后一次传入一个临时文件。<br>GeckoPreferences.Load 最终调用 xpcom 接口 nsIPrefService::ReadUserPrefs()，ReadUserPrefs 的这个行为可能是bug。<br>nsIPrefService::ReadUserPrefs() 的实现在：<br><a href="http://mxr.mozilla.org/mozilla-central/source/modules/libpref/src/Preferences.cpp#581" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/modules/libpref/src/Preferences.cpp#581</a><br>  ReadAndOwnUserPrefFile(aFile); //这应该是原因所在，故意的。<br>虽然文档上说可以给 nsIPrefService::ReadUserPrefs() 传入 null，将读取默认的 pref.js，但实际上会抛出异常。我们注意到在geckofx的profile目录下，没有pref.js，这可能是geckofx的bug。<br>所以，为了避免麻烦，在geckofx上不要通过 about:config 修改偏好。</p>
<ul>
<li>窗口</li>
</ul>
<ul>
<li>创建隐藏窗口<br>AppShellService.CreateHiddenWindow() </li>
</ul>
<ul>
<li>mozilla IDL 到 C# 的翻译器 IDLImp or IDLImporter<br><a href="https://bitbucket.org/geckofx/idlimp" target="_blank" rel="noopener">https://bitbucket.org/geckofx/idlimp</a><br>如果要使用自定义的 XPCOM 组件，可以用这个工具生成 C# 接口。不过好像有一些错误。</li>
</ul>
<h3 id="OpenGeckoSharp"><a href="#OpenGeckoSharp" class="headerlink" title="OpenGeckoSharp"></a>OpenGeckoSharp</h3><p><a href="https://github.com/quantum1423/OpenGeckoSharp" target="_blank" rel="noopener">https://github.com/quantum1423/OpenGeckoSharp</a></p>
<h2 id="JSM"><a href="#JSM" class="headerlink" title="JSM"></a>JSM</h2><p>Using_JavaScript_code_modules <a href="https://developer.mozilla.org/en/Using_JavaScript_code_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en/Using_JavaScript_code_modules</a><br>通过Javascript code modules在XUL文件之间使用全局变量  <a href="http://blog.csdn.net/forumz/article/details/5719678" target="_blank" rel="noopener">http://blog.csdn.net/forumz/article/details/5719678</a></p>
<p>var EXPORTED_SYMBOLS = [“foo”, “bar”];<br>function foo() {<br>  return “foo”;<br>}<br>var bar = {<br>  name : “bar”,<br>  size : “3”<br>};<br>var dummy = “dummy”;</p>
<p>注意：对于 xulrunner 应用，如果修改了 jsm 文件，则必需修改 application.ini 中的 BuildID，否则实际加载的总是旧版本！</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Services.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Services.jsm</a></p>
<p>Services.jsm<br>In This Article</p>
<p>The Services.jsm JavaScript code module offers a wide assortment of lazy getters that simplify the process of obtaining references to commonly used services.</p>
<h3 id="使用-CommonJS-模块"><a href="#使用-CommonJS-模块" class="headerlink" title="使用 CommonJS 模块"></a>使用 CommonJS 模块</h3><p>// import require() into your scope.<br>const { require } = Cu.import(“resource://gre/modules/commonjs/toolkit/require.js”, {})<br>// import the SDK’s base64 module<br>var base64 = require(“sdk/base64”);<br>base64.encode(“hello”); // “aGVsbG8=”<br>// import my module<br>var myModule = require(“resource://path/to/my/module.js”);</p>
<h2 id="preference"><a href="#preference" class="headerlink" title="preference"></a>preference</h2><p><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Preferences" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Preferences</a><br><a href="http://stackoverflow.com/questions/3796084/about-config-preferences-and-js" target="_blank" rel="noopener">http://stackoverflow.com/questions/3796084/about-config-preferences-and-js</a></p>
<p>// Get the “accessibility.” branch<br>var prefs = Components.classes[“@mozilla.org/preferences-service;1”]<br>                    .getService(Components.interfaces.nsIPrefService).getBranch(“accessibility.”);</p>
<p>// prefs is an nsIPrefBranch.<br>// Look in the above section for examples of getting one.<br>var value = prefs.getBoolPref(“typeaheadfind”); // get a pref (accessibility.typeaheadfind)<br>prefs.setBoolPref(“typeaheadfind”, !value); // set a pref (accessibility.typeaheadfind)</p>
<p>preference 条目的文档<br><a href="http://kb.mozillazine.org/About%3aconfig_entries" target="_blank" rel="noopener">http://kb.mozillazine.org/About%3aconfig_entries</a></p>
<p>defaults/preferences/prefs.js 不支持编程结构，参考<br>  <a href="https://developer.mozilla.org/en-US/docs/Default_Preferences" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Default_Preferences</a></p>
<p>保存 prefs<br>var prefService = Components.classes[“@mozilla.org/preferences-service;1”]<br>                               .getService(Components.interfaces.nsIPrefService);<br>prefService.savePrefFile(null);</p>
<h2 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h2><p>File I/O<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O</a></p>
<p>nsIFile<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIFile" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIFile</a></p>
<p>FileUtils.jsm<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/FileUtils.jsm?redirectlocale=en-US&amp;redirectslug=JavaScript_code_modules%2FFileUtils.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/FileUtils.jsm?redirectlocale=en-US&amp;redirectslug=JavaScript_code_modules%2FFileUtils.jsm</a></p>
<ul>
<li>OS.File<br><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File</a></li>
</ul>
<p>OS.File is a new API designed for efficient, off-main thread, manipulation of files by privileged JavaScript code. This API is intended to replace, in time, most XPCOM-based manipulation of files (nsIFile, subsets of nsIIOService, etc.) by JavaScript code.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.File_for_the_main_thread" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.File_for_the_main_thread</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/OSFile.jsm/OS.File.DirectoryIterator_for_the_main_thread" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/OSFile.jsm/OS.File.DirectoryIterator_for_the_main_thread</a><br><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.Path" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.Path</a></p>
<p>XUL环境下的文件 IO 用这个库应该就足够了，不需要再与 sream 打交道。</p>
<p>OS.File.copy(sourcePath, destPath) 函数可以用于复制文件，不过似乎存在bug，在复制完成前promise就会完成：<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1166027" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1166027</a></p>
<p>一些有用的路径：<br>  OS.Constants.Path.profileDir profile 的路径。如果在 application.ini 中设置了 Profile=MyAppData，则 OS.Constants.Path.profileDir 为 $HOME/.MyAppData/xxx.default。<br>  tmpDir 临时目录<br>  homeDir 用户主目录</p>
<ul>
<li>特殊路径<br>var iop = Components.classes[“@mozilla.org/file/directory_service;1”]<pre><code>.getService(Components.interfaces.nsIProperties);</code></pre>var dir = iop.get(“ProfD”, Components.interfaces.nsIFile);</li>
</ul>
<p>其中 ProfD 可以替换为：<br>CurProcD     Current working directory (usually the application’s installation directory).<br>ProfD     The profile directory.<br>Home     The user’s home directory (for example, /home/username).<br>更多的值可以参考：<br><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O</a></p>
<ul>
<li><p>HTML5 File API<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/File" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/File</a><br>Gecko notes</p>
<p>  In Gecko, you can use this(File) API from chrome code. See Using the DOM File API in chrome code for details.<br>  Starting in Gecko 6.0 (Firefox 6.0 / Thunderbird 6.0 / SeaMonkey 2.3), privileged code (such as extensions) can pass an nsIFile object to the DOM File constructor to specify the file to reference.<br>  Starting in Gecko 8.0 (Firefox 8.0 / Thunderbird 8.0 / SeaMonkey 2.5), you can use new File to create File objects from XPCOM component code instead of having to instantiate the nsIDOMFile object directly.</p>
</li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Extensions/Using_the_DOM_File_API_in_chrome_code" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Extensions/Using_the_DOM_File_API_in_chrome_code</a></p>
<p>不过，看来这种用法只适于读文件，而不是写文件。</p>
<p>在特权代码中，File.mozFullPath 属性表示 File 对象的全路径。</p>
<ul>
<li><p>Channel<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChannel" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChannel</a><br>This interface allows clients to construct ‘GET’ requests for specific protocols, and manage them in a uniform way. </p>
</li>
<li><p>Stream<br>Binary Stream<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryOutputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryOutputStream</a><br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryInputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryInputStream</a></p>
</li>
</ul>
<p>Stream_Guide<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide</a><br>ScriptableInputStream<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIScriptableInputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIScriptableInputStream</a></p>
<ul>
<li><p>NetUtil<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/NetUtil.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/NetUtil.jsm</a></p>
<p>asyncFetch()</p>
</li>
</ul>
<p>The asyncFetch() method opens an input source, asynchronously, and gives an nsIInputStream containing the data obtained to the callback provided. The callback may then consume data from the input stream passed to the callback.</p>
<p>readInputStreamToString()</p>
<h2 id="DOM-Storage"><a href="#DOM-Storage" class="headerlink" title="DOM Storage"></a>DOM Storage</h2><p>chrome: 协议代码中无法使用 localStorage/sessionStorage 等。尽管这些对象是存在的，但访问它们会出现异常。参考：<br>Can’t access localStorage from chrome:// <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495747" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=495747</a> 未来可能会解决。</p>
<p>注意，也无法将 localStorage 替换为自定义实现，赋值无效。<br>可能的变通是：</p>
<ol>
<li><p>使用 resource: 协议代码。但这种代码没有特权。参考<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=562646" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=562646</a></p>
</li>
<li><p>1 另一个变体是，使用http等协议，但是拦截请求。</p>
</li>
<li><p>将自定义实现绑定到另一个名字，例如 xxxLocalStorage。<br>具体的，可以使用 XPCOM 获得一个绑定到普通域的 localStorage，然后绑定到 xxxLocalStorage。参考<br><a href="http://stackoverflow.com/questions/20195541/html-5-local-storage-in-xul-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/20195541/html-5-local-storage-in-xul-application</a></p>
</li>
</ol>
<p>var url = “<a href="http://example.com&quot;" target="_blank" rel="noopener">http://example.com&quot;</a>;<br>var ios = Components.classes[“@mozilla.org/network/io-service;1”]<br>          .getService(Components.interfaces.nsIIOService);<br>var ssm = Components.classes[“@mozilla.org/scriptsecuritymanager;1”]<br>          .getService(Components.interfaces.nsIScriptSecurityManager);<br>var dsm = Components.classes[“@mozilla.org/dom/storagemanager;1”]<br>          .getService(Components.interfaces.nsIDOMStorageManager);</p>
<p>var uri = ios.newURI(url, “”, null);<br>var principal = ssm.getCodebasePrincipal(uri);<br>var storage = dsm.getLocalStorageForPrincipal(principal, “”);</p>
<p>storage.setItem(“chromekey”, “chromevalue”);</p>
<h2 id="Javascript-集成"><a href="#Javascript-集成" class="headerlink" title="Javascript 集成"></a>Javascript 集成</h2><p>XPConnect<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/XPConnect" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/XPConnect</a></p>
<p>mozIJSSubScriptLoader<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIJSSubScriptLoader" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIJSSubScriptLoader</a><br>This interface can be used from privileged JavaScript to load and run JavaScript code from the given URL at runtime.<br>var mozIJSSubScriptLoader = Components.classes[“@mozilla.org/moz/jssubscript-loader;1”]<br>                            .getService(Components.interfaces.mozIJSSubScriptLoader);</p>
<h3 id="geckofx-js-and-native-interop"><a href="#geckofx-js-and-native-interop" class="headerlink" title="geckofx js and native interop"></a>geckofx js and native interop</h3><p>D:\project\geckofx-29.0.hg\Geckofx-Core\AutoJSContext.cs<br>D:\project\geckofx-29.0.hg\Geckofx-Core\JQuery\JQueryExecutor.cs<br>D:\project\geckofx-29.0.hg\Geckofx-Core\Interop\SpiderMonkey\SpiderMonkey.cs</p>
<p>D:\project\geckofx-29.0.hg\GeckofxUnitTests\GeckoWebBrowserTests.cs<br>D:\project\geckofx-29.0.hg\GeckofxUnitTests\XPConnectTests.cs<br>D:\project\geckofx-29.0.hg\GeckofxUnitTests\XpComTests.cs</p>
<pre><code>public void EvaluateScript_SimpleJavascript_ScriptExecutesAndReturnsExpectedResult()
{
    browser.TestLoadHtml(&quot;&quot;);

    using (AutoJSContext context = new AutoJSContext(browser.Window.JSContext))
    {                
        string result;
        Assert.IsTrue(context.EvaluateScript(&quot;3 + 2;&quot;, out result));
        Assert.AreEqual(5, Int32.Parse(result));

        Assert.IsTrue(context.EvaluateScript(&quot;&apos;hello&apos; + &apos; &apos; + &apos;world&apos;;&quot;, out result));
        Assert.AreEqual(&quot;hello world&quot;, result);
    }                
}</code></pre><p>var instance = Xpcom.CreateInstance<nsISupports>(“@mozilla.org/byte-buffer;1”);</p>
<h2 id="页面加载状态监视和错误处理"><a href="#页面加载状态监视和错误处理" class="headerlink" title="页面加载状态监视和错误处理"></a>页面加载状态监视和错误处理</h2><p><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIWebProgressListener" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIWebProgressListener</a></p>
<p>LOCATION_CHANGE_ERROR_PAGE This flag indicates that aWebProgress redirected from the requested document to an internal page to show error status, such as about:neterror, about:certerror and so on. </p>
<h3 id="geckofx-1"><a href="#geckofx-1" class="headerlink" title="geckofx"></a>geckofx</h3><p>GeckoWebBrowser 有以下.net事件：<br>browser.Navigating<br>  开始导航到某个页面。注意这个事件也会在页面内导航、子框架（frame）导航时产生。<br>  GeckoNavigatingEventArgs.DomWindowTopLevel表示是否是顶层窗口的导航事件, GeckoNavigatingEventArgs.DomWindow 为事件相关的窗口。<br>  这时可以取消导航，GeckoNavigatingEventArgs 是 CancelEventArgs 的子类。<br>browser.Navigated<br>  导航结束，页面将开始解析（如果是新页面）。注意这个事件也会在错误页面、页面内导航、子框架（frame）导航时产生。<br>  （1）如果是新页面，这时JS上下文已经创建，可以注入和执行JS（AutoJSContext.EvaluateScript）；但页面本身尚未解析，html中的JS都还没有开始执行，<br>  因此这是注入跨语言交互代码的理想时机。<br>  （2）如果加载页面时发生网络错误，并且启用了内置错误页面（设置偏好 browser.xul.error_pages.enabled = true），则 GeckoNavigatedEventArgs.IsErrorPage == true；但HTTP错误（4xx, 5xx）不会反映在这里（TODO 如何检测）。顺提，如果没有启用了内置错误页面，则网络错误会通过对话框报告，详见PromptService。<br>  （3）GeckoNavigatedEventArgs.IsSameDocument 表示结局是否仍为原来的文档（即页面内跳转）；GeckoNavigatedEventArgs.DomWindowTopLevel 表示是否是顶层窗口的导航事件，<br>    GeckoNavigatedEventArgs.DomWindow 为事件相关的窗口。<br>browser.Load<br>  类似于 js window.onload 事件，不过会在 js window.onload 事件之前执行。所以如果有要在网页加载完后做处理，更好的时机是 DocumentCompleted 事件。<br>browser.ReadyStateChange<br>  等效于 JS 中的 document 的 readystatechange 事件，可以通过 browser.Window.Document.ReadyState:string 查询状态，有interactive, complete等。<br>browser.DocumentCompleted<br>  新页面、无网络错误时，在 Load 和 JS load 事件之后触发。<br>  如果要对加载完的页面做修改，这是个合适的地方。<br>  GeckoDocumentCompletedEventArgs 与 GeckoNavigatedEventArgs 类似，注意区分错误页面（无此参数）、页面内导航、子框架导航，HTTP错误。<br>  注意，如果有网络错误，并加载了错误页面，这个事件会在 Navigated 事件之前发生。</p>
<p>总结一下网络错误、并加载了错误页面时的事件：</p>
<p>使用服务器上关闭的端口时，此方法被调用<br>void nsIWebProgressListener.OnStatusChange(nsIWebProgress aWebProgress, nsIRequest aRequest, int aStatus, string aMessage)<br>aMessage    aStatus<br>Looking up <a href="http://www.baidu.com…">www.baidu.com…</a>   -2142568445<br>Connecting to <a href="http://www.baidu.com…">www.baidu.com…</a>    -2142568441</p>
<p>void nsIWebProgressListener.OnStateChange(nsIWebProgress aWebProgress, nsIRequest aRequest, uint aStateFlags, int aStatus)</p>
<p>PromptService : nsIPromptService2,nsIPrompt</p>
<h2 id="Clipboard"><a href="#Clipboard" class="headerlink" title="Clipboard"></a>Clipboard</h2><p><a href="https://developer.mozilla.org/en-US/docs/Using_the_Clipboard" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Clipboard</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Jetpack/docs/System/Clipboard" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Jetpack/docs/System/Clipboard</a></p>
<h2 id="Debugging-调试"><a href="#Debugging-调试" class="headerlink" title="Debugging/调试"></a>Debugging/调试</h2><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></p>
<h3 id="prefs"><a href="#prefs" class="headerlink" title="prefs"></a>prefs</h3><p>/* debugging prefs */<br>pref(“browser.dom.window.dump.enabled”, true);<br>pref(“javascript.options.showInConsole”, true);<br>pref(“javascript.options.strict”, true);<br>pref(“nglayout.debug.disable_xul_cache”, true);<br>pref(“nglayout.debug.disable_xul_fastload”, true);</p>
<p>也可以打开 about:config 来设置。</p>
<h3 id="本地控制台"><a href="#本地控制台" class="headerlink" title="本地控制台"></a>本地控制台</h3><p>也就是window.dump()方法，打印到操作系统控制台。默认情况下，dump没有启用，要设置偏好：<br>pref(“browser.dom.window.dump.enabled”, true);</p>
<p>在windows上，GUI程序默认没有控制台，要采用 -console 参数来启动 FF/xulrunner 才可以打开控制台。<br>此外，windows 的控制台默认编码不是UTF-8，中文系统上是 GBK，这会导致 dump 输出的中文乱码。</p>
<p>启动控制台编码  重定向文件编码 控制台编码 控制台是否乱码<br>utf8    utf8  gbk 是<br>gbk utf8    gbk 是</p>
<h3 id="debug-server"><a href="#debug-server" class="headerlink" title="debug server"></a>debug server</h3><p>参考<br>[1] <a href="https://developer.mozilla.org/en-US/docs/Tools/Remote_Debugging/Debugging_Firefox_Desktop" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Tools/Remote_Debugging/Debugging_Firefox_Desktop</a><br>[2]（37+已过时） <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></p>
<p>怎样跟踪 firefox 中调试服务代码的变化？</p>
<ul>
<li>调试服务的源码是 devtools 的一部分，在 devtools/ 目录下；发布后则在 omni.ja!/modules/devtools 中。</li>
<li>可以在 mxr 搜索源码中的关键字：start-debugger-server（启动调试服务的命令行参数）, DebuggerServer, 6000 (调试服务的默认端口), &quot;devtools&quot;, debugger 等。</li>
</ul>
<p>在xul应用中，要打开DebuggerServer[2]（这个方法对 37+ 就不适用了）：<br>Components.utils.import(‘resource://gre/modules/devtools/dbg-server.jsm’);<br>if (!DebuggerServer.initialized) {<br>  DebuggerServer.init();<br>  DebuggerServer.addBrowserActors(null);<br>}<br>DebuggerServer.openListener(6000);<br>并设置属性允许远程调试：<br>pref(“devtools.debugger.remote-enabled”, true);</p>
<p>对于geckofx来说，每个进程只需要运行这个过程一次即可，不需要在每个窗口中运行。</p>
<p>然后用ff的 web开发者-&gt;连接 来进行远程调试。</p>
<p>远程调试 firefox 37+ 时，用<br>firefox.exe -P a_profile -no-remote -start-debugger-server 6101<br>启动被调试进程，设定允许chrome调试和远程调试，然后用另一个 firefox 实例连接调试。</p>
<p>或者，在浏览器中打开 chrome://browser/content/browser.xul 直接调试。</p>
<p>对于 xulrunner 37+，可以参考 firefox 的代码：</p>
<p>function startDebugNew() {<br>//<a href="http://mxr.mozilla.org/mozilla-central/search?string=start-debugger-server" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/search?string=start-debugger-server</a><br>//<a href="http://mxr.mozilla.org/mozilla-central/source/browser/devtools/devtools-clhandler.js#28" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/browser/devtools/devtools-clhandler.js#28</a><br>    var portOrPath = 6101;<br>    let { DevToolsLoader } =<br>      Cu.import(“resource://gre/modules/devtools/Loader.jsm”, {});</p>
<pre><code>try {
  // Create a separate loader instance, so that we can be sure to receive
  // a separate instance of the DebuggingServer from the rest of the
  // devtools.  This allows us to safely use the tools against even the
  // actors and DebuggingServer itself, especially since we can mark
  // serverLoader as invisible to the debugger (unlike the usual loader
  // settings).
  let serverLoader = new DevToolsLoader();
  serverLoader.invisibleToDebugger = true;
  serverLoader.main(&quot;devtools/server/main&quot;);
  let debuggerServer = serverLoader.DebuggerServer;
  debuggerServer.init();
  debuggerServer.addBrowserActors();
  debuggerServer.allowChromeProcess = true;

  let listener = debuggerServer.createListener();
  listener.portOrPath = portOrPath;
  listener.open();
  dump(&quot;startDebugNew:Started debugger server on &quot; + portOrPath + &quot;\n&quot;);
} catch(e) {
  dump(&quot;startDebugNew:Unable to start debugger server on &quot; + portOrPath + &quot;: &quot; + e);
}</code></pre><p>}</p>
<p>对于 xulrunner 45+ （实际上是firefox 45+ 伪装的），xulrunner 的 omni.ja 缺少了</p>
<h3 id="JavaScript-Console"><a href="#JavaScript-Console" class="headerlink" title="JavaScript Console"></a>JavaScript Console</h3><p>To enable the JS console, start XULRunner with the -jsconsole argument.<br>Note: If you are not using the stub executable to launch the application, the -jsconsole argument is after the application.ini argument: e.g. xulrunner.exe /path/to/application.ini -jsconsole</p>
<p>By default the JS console only shows errors from web content. To show errors in chrome JavaScript, the pref pref(“javascript.options.showInConsole”, true) must be set.</p>
<p>不过，console.log/error 输出的信息似乎无法显示在 JavaScript Console 中，eval也无法访问执行上下文中的对象，只有未捕获异常才会显示出来。</p>
<h3 id="本地js调试器"><a href="#本地js调试器" class="headerlink" title="本地js调试器"></a>本地js调试器</h3><ul>
<li>Venkman<br>这个扩展可以弹出一个gui调试器，不过需要在应用中去调用 Venkman 的函数，因此有特权代码可以启动它。<br>安装到 xulrunner 中的办法参考本文”给 xulrunner 安装扩展“一节。<br>按照此处的指引安装 Venkman 是可以的（注意装到xulrunner目录下），注意Troubleshooting一节。<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></li>
</ul>
<h3 id="mozrepl"><a href="#mozrepl" class="headerlink" title="mozrepl"></a>mozrepl</h3><p><a href="https://github.com/bard/mozrepl/" target="_blank" rel="noopener">https://github.com/bard/mozrepl/</a> – 原版<br><a href="https://github.com/duanyao/mozrepl" target="_blank" rel="noopener">https://github.com/duanyao/mozrepl</a> – 打补丁适配 geckofx 的版本</p>
<p>这个扩展可以安装到FF、xulrunner app 或 xulrunner 本身当中。运行时，它在被调试的进程中开启一个telnet服务（端口4242），用telnet客户端连结上去以后可以执行js表达式和语句。<br>不过，它目前似乎在 geckofx 中跑不起来。</p>
<p>安装到 xulrunner 中的办法参考本文”给 xulrunner 安装扩展“一节。</p>
<p>运行 app 时，追加 -repl 参数即可启动 mozrepl。<br>如果要自动启动，设置 pref extensions.mozrepl.autoStart = true（mozrepl/defaults/preferences/mozrepl.js中）。</p>
<p>连接：<br>localhost 4242</p>
<p>在Windows上，如果没有 telnet 命令，可以安装 netcat 来代替：<br><a href="http://code.google.com/p/yesanshare/downloads/detail?name=nc111nt.zip&amp;can=2&amp;q=" target="_blank" rel="noopener">http://code.google.com/p/yesanshare/downloads/detail?name=nc111nt.zip&amp;can=2&amp;q=</a><br>安装 nc.exe 到 path 中，然后<br>nc localhost 4242</p>
<p>命令参考：<br><a href="https://github.com/bard/mozrepl/wiki/Tutorial" target="_blank" rel="noopener">https://github.com/bard/mozrepl/wiki/Tutorial</a></p>
<ul>
<li>geckofx 适配<br>在.net代码中，首先要按照geckofx一节中”注册xulrunner应用、扩展“的描述注册 mozrepl，然后启动服务器：<br>var mozrepl = Xpcom.CreateInstance&lt;MozRepl.nsIMozRepl&gt;(“@hyperstruct.net/mozlab/mozrepl;1”);<br>mozrepl.Start(4242, true | false);</li>
</ul>
<p>geckofx 的一个问题是 nsIWindowMediator 没有包含任何窗口，所以要查询 nsIWindowWatcher 来代替，详见：<br><a href="https://github.com/duanyao/mozrepl" target="_blank" rel="noopener">https://github.com/duanyao/mozrepl</a></p>
<ul>
<li>代码分析<br>mozrepl 监听 profile-after-change 事件（似乎会在程序启动时触发），如果设置了 autoStart = true，则启动服务器。</li>
</ul>
<p>profile-after-change 监听是在 chrome.manifest 中注册的，参考：<br><a href="http://stackoverflow.com/questions/3169852/how-to-listen-to-profile-after-change-in-xpcom-component-for-ff4" target="_blank" rel="noopener">http://stackoverflow.com/questions/3169852/how-to-listen-to-profile-after-change-in-xpcom-component-for-ff4</a><br>监听的实现代码在 mozrepl/chrome/content/server.js:observe</p>
<p>服务器是个 XPCOM 组件。<br>接口：nsIMozRepl（MozRepl.idl）<br>实现：mozrepl/chrome/content/server.js<br>CONTRACT_ID = ‘@hyperstruct.net/mozlab/mozrepl;1’<br>CLASS_ID = 57f4284b-1f9b-4990-8525-9ed5cbb23e01<br>启动、停止服务器的方法是<br>void start(in short port, in boolean loopbackOnly);<br>void stop();</p>
<h3 id="本地代码调试"><a href="#本地代码调试" class="headerlink" title="本地代码调试"></a>本地代码调试</h3><p>VS 中设置 Mozilla symbol server<br><a href="https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_symbol_server" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_symbol_server</a></p>
<p>对于 xulrunner 设置 symbol server<br><a href="http://symbols.mozilla.org/xulrunner" target="_blank" rel="noopener">http://symbols.mozilla.org/xulrunner</a></p>
<p>并且只允许加载下面的符号，以免太慢<br>xul.dll<br>mozjs.dll<br>mozglue.dll</p>
<p>以及 Mozilla source server<br><a href="https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_source_server" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_source_server</a></p>
<p>也可以下载源码包，解压后，当用VS调试时点击调用栈，VS会询问源文件的位置，选择解压后的源文件即可。<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Source_Code/Downloading_Source_Archives" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Source_Code/Downloading_Source_Archives</a></p>
<h2 id="拦截网络请求"><a href="#拦截网络请求" class="headerlink" title="拦截网络请求"></a>拦截网络请求</h2><p>Firefox 扩展可以拦截网络请求和回复，因此可以用特殊的http url表示模拟的本地文件系统。<br>参考：<br>  <a href="http://stackoverflow.com/questions/2141469/create-firefox-addon-to-watch-and-modify-xhr-requests-reponses" target="_blank" rel="noopener">http://stackoverflow.com/questions/2141469/create-firefox-addon-to-watch-and-modify-xhr-requests-reponses</a><br>  <a href="http://www.softwareishard.com/blog/firebug/nsitraceablechannel-intercept-http-traffic/" target="_blank" rel="noopener">http://www.softwareishard.com/blog/firebug/nsitraceablechannel-intercept-http-traffic/</a><br>  <a href="http://stackoverflow.com/questions/7222577/firefox-extension-cancel-requests-and-emit-fake-responses" target="_blank" rel="noopener">http://stackoverflow.com/questions/7222577/firefox-extension-cancel-requests-and-emit-fake-responses</a><br>  <a href="https://developer.mozilla.org/en-US/docs/XUL/School_tutorial/Intercepting_Page_Loads" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/School_tutorial/Intercepting_Page_Loads</a><br>  <a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a> http-on-opening-request</p>
<ul>
<li><p>The Easy Way: Load Events<br>监听全局浏览器对象 gBrowser 的 “load” 事件。这个事件类似 web 中的 load 事件，是针对tab中的主文档或iframe中的文档的。<br>可以趁机修改DOM，但是不能在DOM构建前取消或修改响应。</p>
</li>
<li><p>HTTP Observers<br>对每个http请求都发出事件。允许在请求发出前修改头，或者取消请求，或者在收到响应后修改响应。<br>使用 nsITraceableChannel，可以在收到响应后修改内容，然后再传递给原来的发起者。<br>相关文档：<br><a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a><br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/NsITraceableChannel" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/NsITraceableChannel</a><br>但是，看起来请求还是会发到原来请求的url，并不能做成完全合成的请求/响应。</p>
</li>
<li><p>WebProgressListeners<br>针对每个 xul browser 实例（也就是浏览器tab），每个tab打开关闭的时候要添加删除监听器。</p>
</li>
<li><p>XPCOM Solutions<br>Document Loader Service<br>相当于全局 Web Progress Listener.<br>nsIDocumentLoader is nothing but a global Web Progress Listener. You can create an XPCOM component that extends nsIWebProgressListener and use the addProgressListener method in the service to include it. </p>
</li>
</ul>
<p>Content Policy<br>只能用于取消请求。</p>
<h2 id="自定义协议处理器"><a href="#自定义协议处理器" class="headerlink" title="自定义协议处理器"></a>自定义协议处理器</h2><p>Firefox 扩展可以添加自定义协议处理器。<br>  <a href="http://mike.kaply.com/2011/01/18/writing-a-firefox-protocol-handler/" target="_blank" rel="noopener">http://mike.kaply.com/2011/01/18/writing-a-firefox-protocol-handler/</a><br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIProtocolHandler" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIProtocolHandler</a></p>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><p><a href="https://developer.mozilla.org/en-US/docs/Displaying_web_content_in_an_extension_without_security_issues" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Displaying_web_content_in_an_extension_without_security_issues</a></p>
<p><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages</a></p>
<h3 id="同源规则"><a href="#同源规则" class="headerlink" title="同源规则"></a>同源规则</h3><p>mozilla 平台似乎没有 chrome 那样的命令行或API可以关掉同源规则。参考：<br><a href="http://stackoverflow.com/questions/17711924/disable-cross-domain-web-security-in-firefox" target="_blank" rel="noopener">http://stackoverflow.com/questions/17711924/disable-cross-domain-web-security-in-firefox</a><br><a href="http://stackoverflow.com/questions/17088609/disable-firefox-same-origin-policy" target="_blank" rel="noopener">http://stackoverflow.com/questions/17088609/disable-firefox-same-origin-policy</a><br><a href="http://stackoverflow.com/questions/330427/can-i-disable-sop-same-origin-policy-on-any-browser-for-development" target="_blank" rel="noopener">http://stackoverflow.com/questions/330427/can-i-disable-sop-same-origin-policy-on-any-browser-for-development</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Same-origin_policy_for_file:_URIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Same-origin_policy_for_file:_URIs</a></p>
<p>Force CORS Firefox Extension<br><a href="http://www-jo.se/f.pfleger/forcecors" target="_blank" rel="noopener">http://www-jo.se/f.pfleger/forcecors</a></p>
<p>过去的FF，可以修改 profile 目录下的 prefs.js，加入<br>user_pref(“capability.principal.myapp.id”, “file:///D:/project/MyHTML/xhrtest.html”);<br>user_pref(“capability.principal.myapp.granted”, “UniversalBrowserRead”);<br>注意 about:config 不显示这类配置。<br>但是看起来这个特性被删除了，不起作用，而且FF关闭时会删除这样的配置。</p>
<p>总结起来就是，最近的FF（28+），不支持放开非特权页面的特权，只有 chrome: 协议的页面能绕开同源限制。参考：<br><a href="https://developer.mozilla.org/en-US/docs/Bypassing_Security_Restrictions_and_Signing_Code" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Bypassing_Security_Restrictions_and_Signing_Code</a></p>
<h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>navigator.mozTCPSocket 或者 navigator.TCPSocket 是可以用于浏览器环境的 TCP Socket 实现。<br>W3C正在讨论中，目前只有 mozilla 实现了，只能在特权代码或者特权 web app 中使用。<br>在 xulrunner 或桌面 firefox 中，目前（40）需要设置 dom.mozTCPSocket.enabled = true 来启用（<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1079648）。" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1079648）。</a></p>
<h2 id="mozilla-跨不同权限页面的交互"><a href="#mozilla-跨不同权限页面的交互" class="headerlink" title="mozilla 跨不同权限页面的交互"></a>mozilla 跨不同权限页面的交互</h2><h3 id="frame-嵌入"><a href="#frame-嵌入" class="headerlink" title="frame 嵌入"></a>frame 嵌入</h3><p>特权页面中可以嵌入非特权页面，但反过来不行，只会显示一个空白页。</p>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><p>给非特权页面的 WebIDL 添加的扩展方法，特权页面并不能有效访问，可能是因为安全限制：<br><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages</a><br>Gecko prevents chrome to access custom object properties added by the content, because that can create security holes.<br>Never invoke the web page’s JavaScript functions from your extension - doing this increases the chance of creating a security hole, where a malicious web page can trick the browser to run its code with extended privileges (just like your extension) with, for example, the ability to delete local files.</p>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><ul>
<li>web message<br>特权页面可以给非特权页面发送 web message；但从非特权页面发给特权页面似乎没有效果。</li>
</ul>
<h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><h3 id="dbus"><a href="#dbus" class="headerlink" title="dbus"></a>dbus</h3><ul>
<li><p>mozjs-dbus<br><a href="https://github.com/codebutler/mozjs-dbus/wiki" target="_blank" rel="noopener">https://github.com/codebutler/mozjs-dbus/wiki</a><br>makes it possible for Mozilla/Javascript-based applications and extensions to interoperable with<br>D-Bus, which allows for deep integration with the Linux desktop.<br>代码相当老了（5年）。</p>
</li>
<li><p>Browser DBus Bridge<br><a href="http://sandbox.movial.com/wiki/index.php/Browser_DBus_Bridge" target="_blank" rel="noopener">http://sandbox.movial.com/wiki/index.php/Browser_DBus_Bridge</a><br>The Browser D-Bus Bridge is a JavaScript D-Bus bindings implementation for web browsers. The Bridge allows privileged JavaScript code to talk to the D-Bus, both session and system bus (if not prohibited by the D-Bus configuration).</p>
</li>
</ul>
<p>The bridge currently supports Gecko-based and WebKit-based browsers. Each of these have their own implementation of the Bridge due to technical differences in the integration, but support the same API on the JavaScript side.<br>代码相当老了。</p>
<ul>
<li>D-Bus and other Linux desktop integration improvements, DBuzilla<br><a href="http://zenit.senecac.on.ca/wiki/index.php/D-Bus_and_other_Linux_desktop_integration_improvements" target="_blank" rel="noopener">http://zenit.senecac.on.ca/wiki/index.php/D-Bus_and_other_Linux_desktop_integration_improvements</a><br>代码相当老了（7年）。</li>
</ul>
<h2 id="嵌入"><a href="#嵌入" class="headerlink" title="嵌入"></a>嵌入</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/API_overview" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/API_overview</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/Roll_your_own_browser" target="_blank" rel="noopener">Roll your own browser: An embedding how-to</a> on MDN. (out dated)</p>
<p>将Mozilla源码里的内嵌Gecko示例winEmbed工程移植到VC (1.9)<br>  <a href="http://blog.csdn.net/mzlogin/article/details/7292310" target="_blank" rel="noopener">http://blog.csdn.net/mzlogin/article/details/7292310</a></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><ul>
<li>nsIWebBrowser</li>
</ul>
<p>This is the primary interface to the WebBrowser component.</p>
<ul>
<li><p>nsIWebBrowserSetup<br>SETUP_IS_CHROME_WRAPPER=7<br>Boolean. Marks whether the browser is a chrome wrapper. A value of PR_TRUE means the browser is a chrome wrapper. The default value is PR_FALSE. </p>
</li>
<li><p>nsIWebBrowserChrome</p>
</li>
</ul>
<p>This interface provides access to the window containing an nsWebBrowser instance.</p>
<ul>
<li><p>nsIChromeRegistry<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChromeRegistry" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChromeRegistry</a></p>
</li>
<li><p>nsIXULAppInfo<br>In XULRunner applications nsIXULAppInfo obtains app-specific information from application.ini.<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIXULAppInfo" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIXULAppInfo</a></p>
</li>
<li><p>nsIXULRuntime<br>Provides information about the XUL runtime to allow extensions and XUL applications to determine information about the XUL runtime. </p>
</li>
<li><p>nsIAppShell<br>Interface for the native event system layer. This interface is designed to be used on the main application thread only. </p>
</li>
<li><p>nsIAppStartup<br>This interface is intended to be used as application startup service. It also helps in quitting applications as well. </p>
</li>
<li><p>nsIAppShellService<br>Provides the AppShellService. </p>
</li>
<li><p>nsIFile/nsILocalFile<br>创建<br>var localFile = Components.classes[“@mozilla.org/file/local;1”]</p>
<pre><code>.createInstance(Components.interfaces.nsILocalFile);</code></pre><p>或者<br>Components.utils.import(“resource://gre/modules/FileUtils.jsm”);</p>
</li>
</ul>
<p>var file = new FileUtils.File(“/home”);</p>
<p>初始化<br>localFile.initWithPath(in AString filePath);<br>  js 中直接传入string，geckofx中传入nsAString对象。</p>
<h3 id="应用的解析"><a href="#应用的解析" class="headerlink" title="应用的解析"></a>应用的解析</h3><ul>
<li>application.ini 的解析<br>browser/app/nsBrowserApp.cpp 或者<br>xulrunner/app/nsXULRunnerApp.cpp</li>
</ul>
<p><a href="http://mxr.mozilla.org/mozilla-central/source/xulrunner/app/nsXULRunnerApp.cpp" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/xulrunner/app/nsXULRunnerApp.cpp</a></p>
<p>277   nsCOMPtr<nsIFile> appDataLF;<br>278   rv = XRE_GetFileFromPath(appDataFile, getter_AddRefs(appDataLF));<br>279   if (NS_FAILED(rv)) {<br>280     Output(true, “Error: unrecognized application.ini path.\n”);<br>281     return 2;<br>282   }<br>283<br>284   AutoAppData appData(appDataLF);<br>285   if (!appData) {<br>286     Output(true, “Error: couldn’t parse application.ini.\n”);<br>287     return 2;<br>288   }<br>290   return XRE_main(argc, argv, appData, 0);</p>
<p>解析代码的实现在<br><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/CreateAppData.cpp#15" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/CreateAppData.cpp#15</a></p>
<p>nsresult XRE_CreateAppData(nsIFile* aINIFile, nsXREAppData **aAppData)</p>
<p>xul 应用入口函数是 XRE_main<br><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#4227" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#4227</a><br> XRE_main(int argc, char* argv[], const nsXREAppData* aAppData, uint32_t aFlags)</p>
<p><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2719" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2719</a><br>2718 // Encapsulates startup and shutdown state for XRE_main<br>2719 class XREMain</p>
<ul>
<li>chrome.manifest 的解析<br><a href="http://mxr.mozilla.org/mozilla-central/source/xpcom/build/nsXULAppAPI.h#263" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/xpcom/build/nsXULAppAPI.h#263</a><br>240 /<em>*<br>241  * Register XPCOM components found in an array of files/directories.<br>242  * This method may be called at any time before or after XRE_main or<br>243  * XRE_InitEmbedding.<br>244  *<br>245  * @param aFiles An array of files or directories.<br>246  * @param aFileCount the number of items in the aFiles array.<br>247  * @note appdir/components is registered automatically.<br>248  *<br>249  * NS_COMPONENT_LOCATION specifies a location to search for binary XPCOM<br>250  * components as well as component/chrome manifest files.<br>251  *<br>252  * NS_SKIN_LOCATION specifies a location to search for chrome manifest files<br>253  * which are only allowed to register only skin packages and style overlays.<br>254  */<br>255 enum NSLocationType<br>256 {<br>257   NS_COMPONENT_LOCATION,<br>258   NS_SKIN_LOCATION,<br>259   NS_BOOTSTRAPPED_LOCATION<br>260 };<br>261<br>262 XRE_API(nsresult,<br>263         XRE_AddManifestLocation, (NSLocationType aType,<br>264                                   nsIFile</em> aLocation))</li>
</ul>
<p>另一个可能的方法是 nsIComponentManager.addBootstrappedManifestLocation((in nsILocalFile aLocation)<br>geckofx 中的代码例子：<br>            var chromeDir = Xpcom.CreateInstance<nsILocalFile> (“@mozilla.org/file/local;1”);<br>            chromeDir.InitWithPath (new nsAString (“D:\project\MBEditor.js.git\mozApp”));<br>            Xpcom.ComponentManager.AddBootstrappedManifestLocation (chromeDir);</p>
<h2 id="JS-引擎：SpiderMonkey"><a href="#JS-引擎：SpiderMonkey" class="headerlink" title="JS 引擎：SpiderMonkey"></a>JS 引擎：SpiderMonkey</h2><p><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_User_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_User_Guide</a></p>
<h3 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h3><p>JS_AddRoot/JS_RemoveRoot<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_AddRoot" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_AddRoot</a><br>The JS_Add*Root and functions add a C/C++ variable to the garbage collector’s root set, the set of variables used as starting points each time the collector checks to see what memory is reachable. The garbage collector aggressively collects and recycles memory that it deems unreachable, so roots are often necessary to protect data from being prematurely collected.</p>
<h3 id="mozjs-函数签名"><a href="#mozjs-函数签名" class="headerlink" title="mozjs 函数签名"></a>mozjs 函数签名</h3><p>?JS_EvaluateUCScript@@YA_NPAUJSContext@@V?$Handle@PAVJSObject@@@JS@@PB_WIPBDIV?$MutableHandle@VValue@JS@@@3@@Z<br>?JS_ExecuteScript@@YA_NPAUJSContext@@PAVJSObject@@PAVJSScript@@PAVValue@JS@@@Z</p>
<p>bool JS_EvaluateUCScript(struct JSContext *,class JS::Handle&lt;class JSObject *&gt;,wchar_t const *,unsigned int,char const *,unsigned int,class JS::MutableHandle<class JS::Value>)<br>bool JS_ExecuteScript(struct JSContext *,class JSObject *,class JSScript *,class JS::Value *)</p>
<p>DomMessageEventArgs</p>
<p>internal string ConvertValueToString(JsVal value)<br><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars</a></p>
<p>wchar_t const * JS_GetStringCharsZAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsZAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>wchar_t const * JS_GetStringCharsZ(struct JSContext *,class JSString *)<br>?JS_GetStringCharsZ@@YAPB_WPAUJSContext@@PAVJSString@@@Z</p>
<p>wchar_t const * JS_GetStringCharsAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>unsigned int JS_GetStringLength(class JSString *)<br>?JS_GetStringLength@@YAIPAVJSString@@@Z</p>
<p>?JS_EvaluateUCScript@@YA_NPAUJSContext@@V?$Handle@PAVJSObject@@@JS@@PB_WIPBDIV?$MutableHandle@VValue@JS@@@3@@Z<br>?JS_ExecuteScript@@YA_NPAUJSContext@@PAVJSObject@@PAVJSScript@@PAVValue@JS@@@Z</p>
<p>bool JS_EvaluateUCScript(struct JSContext *,class JS::Handle&lt;class JSObject *&gt;,wchar_t const *,unsigned int,char const *,unsigned int,class JS::MutableHandle<class JS::Value>)<br>bool JS_ExecuteScript(struct JSContext *,class JSObject *,class JSScript *,class JS::Value *)</p>
<p>DomMessageEventArgs</p>
<p>internal string ConvertValueToString(JsVal value)<br><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars</a></p>
<p>wchar_t const * JS_GetStringCharsZAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsZAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>wchar_t const * JS_GetStringCharsZ(struct JSContext *,class JSString *)<br>?JS_GetStringCharsZ@@YAPB_WPAUJSContext@@PAVJSString@@@Z</p>
<p>wchar_t const * JS_GetStringCharsAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>unsigned int JS_GetStringLength(class JSString *)<br>?JS_GetStringLength@@YAIPAVJSString@@@Z</p>
<h2 id="omni"><a href="#omni" class="headerlink" title="omni"></a>omni</h2><p>omni.ja 文件是个特殊的 zip 文件（windows explorer 可打开，7zip不行），里面包含moz平台的界面的xul/css/js代码，包括调试器(devtools)等。</p>
<p>omni.ja 这个文件名有特殊意义。与 xul.dll (或.so) 同一目录的 omni.ja 会被 xul.dll 自动加载；<br>与 xul 应用的 application.ini 同一目录的 omni.ja 也会被自动加载。</p>
<p>加载 omni.ja 时，会通过其内部根目录下的 chrome.manifest 来注册。</p>
<p>如果要修改、调试 xulrunner/firefox 的 omni.ja 的代码，可以将它解压在其所在的目录，再把它改名/删除。<br>正确的压缩命令：zip -qr9XD omni.ja *</p>
<p>firefox 除了在顶层目录（xul.dll所在的目录）有一个 omni.ja，还在 browser/ 目录下有一个 omni.ja。前者与 xulrunner 的相同，后者是只有 firefox 需要的文件。</p>
<p>参考：<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29" target="_blank" rel="noopener">About omni.ja (formerly omni.jar)</a><br><a href="https://blog.mozilla.org/mwu/2010/08/13/omnijar-how-does-it-work/" target="_blank" rel="noopener">Omnijar. How does it work?</a><br><a href="https://blog.mozilla.org/tglek/2010/09/14/firefox-4-jar-jar-jar/" target="_blank" rel="noopener">Firefox 4: jar jar jar</a></p>
<h2 id="本地化（中文化）-i18n"><a href="#本地化（中文化）-i18n" class="headerlink" title="本地化（中文化） i18n"></a>本地化（中文化） i18n</h2><p>xulrunner 的发行版没有中文版，所以有些界面，如错误页面，是英文的。<br>界面相关的资源在 omni.ja 文件中，这是个特殊的zip文件，参考<br><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29</a></p>
<p>可以用中文版 firefox 的 omni.ja 文件来替换，从而将 xulrunner 改为中文版。要注意选择与 xulrunner 版本号相同的 firefox。</p>
<p>geckofx 中，js alert/prompt 等对话框还是有英文，因为用了自定义的对话框。<br>解决办法是修改自定义对话框中的文字，或者用xulrunner本身的对话框。参考：<br>GeckoWebBrowser.UseCustomPrompt() 和 d:\Geckofx-Winforms\PromptService.cs<br><a href="http://localhost" target="_blank" rel="noopener">http://localhost</a><br>javascript:confirm(‘hh’)</p>
<h2 id="下载-TODO"><a href="#下载-TODO" class="headerlink" title="下载 TODO"></a>下载 TODO</h2><h2 id="插件-plugin"><a href="#插件-plugin" class="headerlink" title="插件/plugin"></a>插件/plugin</h2><h3 id="禁用个别插件"><a href="#禁用个别插件" class="headerlink" title="禁用个别插件"></a>禁用个别插件</h3><p><a href="http://serverfault.com/questions/340195/disable-certain-firefox-plugins-system-wide-by-default" target="_blank" rel="noopener">http://serverfault.com/questions/340195/disable-certain-firefox-plugins-system-wide-by-default</a><br>Disable Certain Firefox Plugins System-wide by Default</p>
<p>The plugins’ settings are now integrated partially in about:config as of Firefox 22, and fully in 23+. The key names are plugin.state.* where * denotes the internal naming scheme used by Firefox for the discovered plugins. The values (integer) are 0 for disabled (Never Activate in Firefox Tools (Alt + T) &gt; Add-ons &gt; Plugins), 1 for click-to-play (Ask to Activate), and 2 for enabled (Always Activate). Firefox 22 has 0 and 2, and 23+ includes all the three states. The state Ask to Activate (1) is triggered after toggling plugins.click_to_play to true in about:config.</p>
<p>One way to get the correct names used by Firefox is from a reference/IT PC. Toggle the default states of all the discovered plugins (Firefox Tools (Alt + T) &gt; Add-ons &gt; Plugins) once, to reveal the corresponding plugin.state.* keys in about:config.</p>
<p>VLC:<br>plugin.state.npvlc</p>
<p>Acrobat:<br>plugin.state.nppdf<br>注意这不影响 pdf.js。</p>
<p>Java:<br>plugin.state.java</p>
<p>Flash:<br>plugin.state.flash</p>
<p>Silverlight:<br>plugin.state.npctrl</p>
<p>在禁用后：<br>object标签如果有替代内容，则显示替代内容；如果没有，firefox 显示一个黑色窗口写着“此插件已被禁用”，xulrunner/geckofx只有一个黑窗，没有提示（可能是bug）。</p>
<h3 id="禁用全部插件"><a href="#禁用全部插件" class="headerlink" title="禁用全部插件"></a>禁用全部插件</h3><p>“plugin.disable” = true </p>
<h2 id="下载和未知内容的处理"><a href="#下载和未知内容的处理" class="headerlink" title="下载和未知内容的处理"></a>下载和未知内容的处理</h2><p>当触发a[download] 或未知类型的链接时，浏览器一般会弹出对话框提示是否用其它应用程序打开，或者下载保存链接。<br>但xulrunner应用、geckofx则有一些麻烦，有时候会出错（firefox28, xulrunner 29）。</p>
<h2 id="web控制台"><a href="#web控制台" class="headerlink" title="web控制台"></a>web控制台</h2><p>有时firefox的控制台显示“Web 控制台的日志记录API (console.log, console.info, console.warn, console.error) 已被此页面的脚本禁用。”<br>网页中的console.log是输出不了信息的。这可能是因为某些扩展的问题。尝试禁用一些扩展，看看问题是否解决了。参考：<br>Firefox的Web控制台禁用？<a href="http://codego.net/382392/" target="_blank" rel="noopener">http://codego.net/382392/</a></p>
<h2 id="内存使用，内存泄露-（memory-usage-amp-leak）"><a href="#内存使用，内存泄露-（memory-usage-amp-leak）" class="headerlink" title="内存使用，内存泄露 （memory usage &amp; leak）"></a>内存使用，内存泄露 （memory usage &amp; leak）</h2><p>A better about:memory: stage 1.75<br>  <a href="https://blog.mozilla.org/nnethercote/2011/05/23/a-better-aboutmemory-stage-1-75/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2011/05/23/a-better-aboutmemory-stage-1-75/</a></p>
<p>How to read Firefox “about:memory” correctly?<br>  <a href="http://stackoverflow.com/questions/7146108/how-to-read-firefox-aboutmemory-correctly" target="_blank" rel="noopener">http://stackoverflow.com/questions/7146108/how-to-read-firefox-aboutmemory-correctly</a></p>
<p>Zombie compartments<br>  <a href="https://developer.mozilla.org/en-US/docs/Zombie_compartments" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Zombie_compartments</a></p>
<p>Per-class JS object and shape measurements in Firefox’s about:memory<br>  <a href="https://blog.mozilla.org/nnethercote/2014/08/29/per-class-js-object-and-shape-measurements-in-firefoxs-aboutmemory/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2014/08/29/per-class-js-object-and-shape-measurements-in-firefoxs-aboutmemory/</a></p>
<p>MemShrink’s 3rd birthday<br>  <a href="https://blog.mozilla.org/nnethercote/2014/06/16/memshrinks-3rd-birthday/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2014/06/16/memshrinks-3rd-birthday/</a></p>
<p>MemShrink progress<br>  <a href="https://blog.mozilla.org/nnethercote/category/aboutcompartments/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/category/aboutcompartments/</a></p>
<p>Firefox 15 plugs the add-on leaks<br>  <a href="https://blog.mozilla.org/nnethercote/2012/07/19/firefox-15-plugs-the-add-on-leaks/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2012/07/19/firefox-15-plugs-the-add-on-leaks/</a></p>
<p>Leak Monitor Extension<br>  <a href="http://dbaron.org/mozilla/leak-monitor/" target="_blank" rel="noopener">http://dbaron.org/mozilla/leak-monitor/</a></p>
<p>Firefox memory leak detection tool<br>  <a href="http://www.squarefree.com/2006/01/13/memory-leak-detection-tool/" target="_blank" rel="noopener">http://www.squarefree.com/2006/01/13/memory-leak-detection-tool/</a></p>
<p>Please file good memory leak bugs<br>  <a href="http://dbaron.org/log/2006-01#e20060110a" target="_blank" rel="noopener">http://dbaron.org/log/2006-01#e20060110a</a></p>
<p>System-wide memory measurement for Firefox OS<br>  <a href="https://blog.mozilla.org/nnethercote/2013/12/17/system-wide-memory-measurement-for-firefox-os/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2013/12/17/system-wide-memory-measurement-for-firefox-os/</a></p>
<h3 id="ghost-windows"><a href="#ghost-windows" class="headerlink" title="ghost-windows"></a>ghost-windows</h3><p>What is a “ghost window”?<br>  <a href="http://forum.palemoon.org/viewtopic.php?f=26&amp;t=3476" target="_blank" rel="noopener">http://forum.palemoon.org/viewtopic.php?f=26&amp;t=3476</a></p>
<p>Report number of ghost windows in telemetry<br>  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=737857" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=737857</a></p>
<h2 id="直接执行特权js代码"><a href="#直接执行特权js代码" class="headerlink" title="直接执行特权js代码"></a>直接执行特权js代码</h2><p>TODO<br>geckofx 中，不创建 browser 对象，直接创建 AutoJSContext:<br> new AutoJSContext()<br> new AutoJSContext(GlobalJSContextHolder.BackstageJSContext)<br>但这样的代码都没有特权，找不到 Components 对象。</p>
<h2 id="综合代码片段"><a href="#综合代码片段" class="headerlink" title="综合代码片段"></a>综合代码片段</h2><p>Code_snippets/Miscellaneous<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Miscellaneous" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Miscellaneous</a><br>包括：<br>  Saving an arbitrary URL to a local file<br>  Operating system detection</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="UcWORK统一桌面系统"><a href="#UcWORK统一桌面系统" class="headerlink" title="UcWORK统一桌面系统"></a>UcWORK统一桌面系统</h3><p><a href="http://www.qqtech.com/ucwork.htm" target="_blank" rel="noopener">http://www.qqtech.com/ucwork.htm</a></p>
<pre><code>UcWORK基于桌面应用的设计思想，采用mozilla技术框架，并进行多方面的扩展实现，UcWork是主平台/框架，其它应用可嵌入到UcWork中，这是我们的主推目标。此种情况是“我为主，人为辅”。
客户或代理商(第三方)可以在界面和服务器层扩展应用。界面和服务层通过UcBUS(即DBUS)交互。在服务层，UcWork除提供DBus接口外，还可提供面向服务层的API接口，供第三方服务层开发调用。</code></pre><h3 id="XULApp-StarterKit"><a href="#XULApp-StarterKit" class="headerlink" title="XULApp StarterKit"></a>XULApp StarterKit</h3><p><a href="https://github.com/racklin/xulapp-starterkit" target="_blank" rel="noopener">https://github.com/racklin/xulapp-starterkit</a></p>
<p>XULApp StarterKit is a generic framework for XULRunner applications, like Rich Client Platform .</p>
<p>It provides the “plumbing” that, before, every developer had to write themselves—saving state, connecting actions to menu items, toolbar items and keyboard shortcuts; window management, add-ons mechanism, update mechanism and so on.</p>
<h2 id="链接-内容处理方式"><a href="#链接-内容处理方式" class="headerlink" title="链接/内容处理方式"></a>链接/内容处理方式</h2><p>Document Loading - From Load Start to Finding a Handler<br>  <a href="http://www-archive.mozilla.org/docs/docshell/uri-load-start.html" target="_blank" rel="noopener">http://www-archive.mozilla.org/docs/docshell/uri-load-start.html</a><br>  <a href="https://developer.mozilla.org/en-US/docs/Document_Loading_-_From_Load_Start_to_Finding_a_Handler" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Document_Loading_-_From_Load_Start_to_Finding_a_Handler</a></p>
<p>nsIContentPolicy<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy</a><br>Interface for content policy mechanism. Implementations of this interface can be used to control loading of various types of out-of-line content, or processing of certain types of inline content</p>
<p>nsILinkHandler<br>  an internal interface used for link clicks</p>
<p>nsIURIContentListener<br>  this gives embedders a chance to abort the load if this URI type is something they want to handle in the embedding app.<br>  <a href="http://www-archive.mozilla.org/projects/embedding/embedapiref/embedapi67.html#1086464" target="_blank" rel="noopener">http://www-archive.mozilla.org/projects/embedding/embedapiref/embedapi67.html#1086464</a><br>  onStartURIOpen() Gives the original content listener first crack at stopping a load before it happens.<br>  doContent() Notifies the content listener to hook up an nsIStreamListener capable of consuming the data stream.<br>  canHandleContent() Indicates whether the content listener is capable of handling the content. </p>
<p>NS_CONTENT_LISTENER_CATEGORYMANAGER_ENTRY of category manager</p>
<p>nsIStreamListener</p>
<p>nsIExternalHelperAppService<br>  <a href="https://developer.mozilla.org/en-US/docs/Helper_Apps_%28and_a_bit_of_Save_As%29" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Helper_Apps_%28and_a_bit_of_Save_As%29</a></p>
<p>  nsIHelperAppLauncher</p>
<p>  nsExternalAppHandler details</p>
<pre><code>Implements nsIStreamListener.
Gets notifications from Necko as the data comes in.
Four primary tasks:
    Sets up temporary file and instantiate the nsIHelperAppLauncherDialog in OnStartRequest.
    Puts the data in the file as OnDataAvailable notifications come in.
    Knows how to launch a helper application on the data based on the nsIMIMEInfo.
    Knows how to save the data to disk at a given location if the user decides to do so. </code></pre><h2 id="下载download"><a href="#下载download" class="headerlink" title="下载download"></a>下载download</h2><p>nsIDownloader<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloader" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloader</a></p>
<p>Downloads.jsm<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Downloads.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Downloads.jsm</a></p>
<p>nsIDownloadManager<br>  <a href="https://bitbucket.org/geckofx/geckofx-29.0/issue/73/download-completed-event-the-right-way" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0/issue/73/download-completed-event-the-right-way</a></p>
<p>Gecko.LauncherDialog.Download<br>  <a href="https://bitbucket.org/geckofx/geckofx-29.0/issue/34/how-to-download-files-using-this-engine" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0/issue/34/how-to-download-files-using-this-engine</a></p>
<p>base/mozglue/GeckoLoader.java.in:80:    private static void setupDownloadEnviron<br>ment(Context context)</p>
<p>base/updater/UpdateService.java:212:        int autoDownloadPolicy = getAutoDown<br>loadPolicy();</p>
<p>chrome/content/downloads.js:90:  handleClickEvent: function dl_handleClickEvent(<br>aDownload) {</p>
<h2 id="gecko-事件"><a href="#gecko-事件" class="headerlink" title="gecko 事件"></a>gecko 事件</h2><p><a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a></p>
<h2 id="特殊协议"><a href="#特殊协议" class="headerlink" title="特殊协议"></a>特殊协议</h2><h3 id="jar-协议"><a href="#jar-协议" class="headerlink" title="jar 协议"></a>jar 协议</h3><p>与 java 的 jar 协议没什么区别。语法是 jar:sub-url!/path-to/file-in-zip<br>注意’!’之后的路径总是以’/‘开头，不管zip中的实际条目名是否以’/‘开头。<br>jar协议的效果与file、http等没有本质的不同。不过，目前播放音视频时有个限制：未播放的部分不能seek，而且也不一定能正确显示总时长。<br>在android版mozilla上，点击jar协议引用的非web文件，例如.doc，也无法调动外部程序来打开（这应该是个bug）。</p>
<h2 id="新的嵌入-API"><a href="#新的嵌入-API" class="headerlink" title="+ 新的嵌入 API"></a>+ 新的嵌入 API</h2><p><a href="https://wiki.mozilla.org/Embedding/IPCLiteAPI" target="_blank" rel="noopener">https://wiki.mozilla.org/Embedding/IPCLiteAPI</a></p>
<h2 id="外部进程的创建和管理"><a href="#外部进程的创建和管理" class="headerlink" title="外部进程的创建和管理"></a>外部进程的创建和管理</h2><p>gecko 实现了一套与 node.js child_process 兼容的 API：</p>
<p><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process</a></p>
<p>// Import SDK Stuff<br>var COMMONJS_URI = ‘resource://gre/modules/commonjs’;<br>var { require } = Components.utils.import(COMMONJS_URI + ‘/toolkit/require.js’, {});<br>var child_process = require(‘sdk/system/child_process’);</p>
<p>//var ls = child_process.spawn(‘ls’, [‘.’]);<br>var ls = child_process.spawn(‘D:\software\UnxUtils\usr\local\wbin\ls.exe’, [‘D:\‘], {encoding: ‘GBK’});<br>//var ls = child_process.spawn(‘C:\Windows\System32\ipconfig.exe’, {encoding: null}); // null 得到的是按字节值直接转化的字符串</p>
<p>//ls.stdout.setEncoding(‘GBK’); //stdout.setEncoding() 目前无效<br>ls.stdout.on(‘data’, function (data) {<br>  console.log(‘stdout(‘ + data.length + ‘): ‘, data);<br>});</p>
<p>ls.stderr.on(‘data’, function (data) {<br>  console.log(‘stderr: ‘ + data);<br>});</p>
<p>ls.on(‘close’, function (code) {<br>  console.log(‘child process exited with code ‘ + code);<br>});</p>
<p>ls.on(‘error’, function (err) {<br>  console.log(‘child process error ‘, err);<br>});</p>
<p>实现代码的位置在<br>omni.jar!\modules\commonjs\sdk\system/child_process.js<br>omni.jar!\jsloader\resource\gre\modules\commonjs\sdk\system/child_process.js</p>
<p>stdout.setEncoding() 目前无效。<br>child_process.spawn(cmd, args, {encoding: ‘GBK’}) 在 Firefox 46 上有效，但 52a2 上无效。<br>也不能向 stdin 写入非ASCII字符。<br>参考：<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1180409" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1180409</a></p>
<h2 id="JS-Ctypes"><a href="#JS-Ctypes" class="headerlink" title="JS-Ctypes"></a>JS-Ctypes</h2><p>JS 直接调用 C api.<br>js-ctypes allows application and extension code to call back and forth to native code written in C. C++ support is limited, see bug 505907 for full support. Unlike binary XPCOM components, It allows developers to ship a single binary for use with multiple versions of Firefox.</p>
<p>二进制数据优化-Harmony typed objects (nés binary data)<br>  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=578700" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=578700</a><br>  <a href="http://wiki.ecmascript.org/doku.php?id=harmony:typed_objects" target="_blank" rel="noopener">http://wiki.ecmascript.org/doku.php?id=harmony:typed_objects</a><br>  <a href="https://github.com/Yoric/js-js-ctypes" target="_blank" rel="noopener">https://github.com/Yoric/js-js-ctypes</a></p>
<p>ChromeWorker<br>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/ChromeWorker" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/ChromeWorker</a><br>  If you’re developing privileged code, and would like to create a worker that can use js-ctypes to perform calls to native code, you can do so by using ChromeWorker instead of the standard Worker object. </p>
<h2 id="web-app"><a href="#web-app" class="headerlink" title="web app"></a>web app</h2><p>mozilla web app 是运行于 firefox OS, 桌面 firefox，移动 firefox 的 web app，三者具有大致统一的规范。<br>mozilla web app 是基于 web 标准的，再加上一些希望成为 web 标准的扩展 api。因此与firefox扩展和xulrunner应用不同，不能使用mozilla特有的底层API，包括XPCOM。<br>事实上，mozilla web app 与 chrome web app 在概念上很相似，互相移植也比较容易。</p>
<h3 id="packaged-app"><a href="#packaged-app" class="headerlink" title="packaged app"></a>packaged app</h3><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>web app 目前似乎只能通过http安装，如果通过file安装会产生invalid url错误。</p>
<h3 id="desktop-web-app"><a href="#desktop-web-app" class="headerlink" title="desktop web app"></a>desktop web app</h3><p>安装后会产生一个类似普通应用程序的入口，在windows上就是一个exe文件，例如<br>“C:\Users\duanyao\AppData\Roaming\xhrcontenttypetest-facc7b2fa7338eec4c5fd305b78b8e71\xhr content type test.exe”<br>并且也提供了反安装程序。</p>
<h3 id="android-web-app"><a href="#android-web-app" class="headerlink" title="android web app"></a>android web app</h3><p>出了从 firefox 中安装，也可以将web app打包为 apk，详见“Open Web Apps for Android”。</p>
<p>mozilla-apk-cli<br>  npm install -g mozilla-apk-cli<br>  mozilla-apk-cli ./www my_test_app.apk<br>  mozilla-apk-cli is only for testing and debugging your new Android app locally.</p>
<h3 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h3><p>Writing your first Firefox OS app<br>  <a href="http://www.adobe.com/devnet/html5/articles/writing-your-first-firefox-os-app.html" target="_blank" rel="noopener">http://www.adobe.com/devnet/html5/articles/writing-your-first-firefox-os-app.html</a><br>Getting Started with Firefox OS: Hosted and Packaged Apps<br>  <a href="http://www.sitepoint.com/getting-started-with-firefox-os-hosted-and-packaged-apps/" target="_blank" rel="noopener">http://www.sitepoint.com/getting-started-with-firefox-os-hosted-and-packaged-apps/</a><br>Packaged apps<br>  <a href="https://developer.mozilla.org/en-US/Marketplace/Options/Packaged_apps" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Marketplace/Options/Packaged_apps</a><br>Open Web Apps for Android<br>  <a href="https://developer.mozilla.org/en-US/Marketplace/Options/Open_web_apps_for_android" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Marketplace/Options/Open_web_apps_for_android</a></p>
<h2 id="firefox-html"><a href="#firefox-html" class="headerlink" title="firefox.html"></a>firefox.html</h2><p>  Firefox.html is an experiment: trying to re-implement the Firefox UI in HTML.<br>  <a href="https://github.com/paulrouget/firefox.html" target="_blank" rel="noopener">https://github.com/paulrouget/firefox.html</a></p>
<h2 id="GeckoView"><a href="#GeckoView" class="headerlink" title="GeckoView"></a>GeckoView</h2><p><a href="http://ftp.mozilla.org/pub/mozilla.org/mobile/nightly/latest-mozilla-central-android/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/mobile/nightly/latest-mozilla-central-android/</a></p>
<p>未特别指出时包为 org.mozilla.gecko</p>
<h3 id="GeckoView-1"><a href="#GeckoView-1" class="headerlink" title="GeckoView"></a>GeckoView</h3><p>mobile/android/base/GeckoView.java</p>
<p>public Browser addBrowser(String url)<br>public void removeBrowser(Browser browser)<br>public void setCurrentBrowser(Browser browser)<br>public Browser getCurrentBrowser()<br>public List<Browser> getBrowsers()<br>public void setChromeDelegate(ChromeDelegate chrome)<br>public void setContentDelegate(ContentDelegate content)<br>public static void setGeckoInterface(final BaseGeckoInterface geckoInterface)<br>public static GeckoAppShell.GeckoInterface getGeckoInterface()</p>
<p>GeckoView.Browser</p>
<p>public void loadUrl(String url)<br>public void reload()<br>public void stop()<br>public boolean canGoBack()<br>public void goBack()<br>public boolean canGoForward()<br>public void goForward()</p>
<h3 id="interface-GeckoView-ContentDelegate"><a href="#interface-GeckoView-ContentDelegate" class="headerlink" title="interface GeckoView.ContentDelegate"></a>interface GeckoView.ContentDelegate</h3><p>默认空实现 GeckoViewContent<br>onPageStart<br>onPageStop<br>onPageShow<br>onReceivedTitle</p>
<h3 id="interface-GeckoView-ChromeDelegate"><a href="#interface-GeckoView-ChromeDelegate" class="headerlink" title="interface GeckoView.ChromeDelegate"></a>interface GeckoView.ChromeDelegate</h3><p>默认实现 GeckoViewChrome<br>onReady<br>onAlert<br>onPrompt<br>onConfirm<br>onDebugRequest</p>
<h3 id="GeckoAppShell"><a href="#GeckoAppShell" class="headerlink" title="GeckoAppShell"></a>GeckoAppShell</h3><p>mobile/android/base/GeckoAppShell.java</p>
<p>//Adds a listener for a gecko event. This method is thread-safe and may be called at any time.<br>public static void registerEventListener(String event, GeckoEventListener listener)<br>public static void unregisterEventListener(String event, GeckoEventListener listener)</p>
<pre><code>GeckoAppShell.registerEventListener(&quot;Gecko:Ready&quot;, this);
GeckoAppShell.registerEventListener(&quot;Content:StateChange&quot;, this);
GeckoAppShell.registerEventListener(&quot;Content:LoadError&quot;, this);
GeckoAppShell.registerEventListener(&quot;Content:PageShow&quot;, this);
GeckoAppShell.registerEventListener(&quot;DOMTitleChanged&quot;, this);
GeckoAppShell.registerEventListener(&quot;Link:Favicon&quot;, this);
GeckoAppShell.registerEventListener(&quot;Prompt:Show&quot;, this);
GeckoAppShell.registerEventListener(&quot;Prompt:ShowTop&quot;, this);</code></pre><p>base/Tabs.java:87:        registerEventListener(“Session:RestoreEnd”);<br>base/Tabs.java:88:        registerEventListener(“SessionHistory:New”);<br>base/Tabs.java:89:        registerEventListener(“SessionHistory:Back”);<br>base/Tabs.java:90:        registerEventListener(“SessionHistory:Forward”);<br>base/Tabs.java:91:        registerEventListener(“SessionHistory:Goto”);<br>base/Tabs.java:92:        registerEventListener(“SessionHistory:Purge”);<br>base/Tabs.java:93:        registerEventListener(“Tab:Added”);<br>base/Tabs.java:94:        registerEventListener(“Tab:Close”);<br>base/Tabs.java:95:        registerEventListener(“Tab:Select”);<br>base/Tabs.java:96:        registerEventListener(“Content:LocationChange”);<br>base/Tabs.java:97:        registerEventListener(“Content:SecurityChange”);<br>base/Tabs.java:98:        registerEventListener(“Content:ReaderEnabled”);<br>base/Tabs.java:99:        registerEventListener(“Content:StateChange”);<br>base/Tabs.java:100:        registerEventListener(“Content:LoadError”);<br>base/Tabs.java:101:        registerEventListener(“Content:PageShow”);<br>base/Tabs.java:102:        registerEventListener(“DOMContentLoaded”);<br>base/Tabs.java:103:        registerEventListener(“DOMTitleChanged”);<br>base/Tabs.java:104:        registerEventListener(“Link:Favicon”);<br>base/Tabs.java:105:        registerEventListener(“Link:Feed”);<br>base/Tabs.java:106:        registerEventListener(“Link:OpenSearch”);<br>base/Tabs.java:107:        registerEventListener(“DesktopMode:Changed”);<br>base/Tabs.java:108:        registerEventListener(“Tab:ViewportMetadata”);</p>
<p>base/GeckoApp.java:1517:        registerEventListener(“log”);<br>base/GeckoApp.java:1518:        registerEventListener(“Reader:ListCountRequest”);<br>base/GeckoApp.java:1519:        registerEventListener(“Reader:ListStatusRequest”);<br>base/GeckoApp.java:1520:        registerEventListener(“Reader:Added”);<br>base/GeckoApp.java:1521:        registerEventListener(“Reader:Removed”);<br>base/GeckoApp.java:1522:        registerEventListener(“Reader:Share”);<br>base/GeckoApp.java:1523:        registerEventListener(“Reader:FaviconRequest”);<br>base/GeckoApp.java:1524:        registerEventListener(“onCameraCapture”);<br>base/GeckoApp.java:1525:        registerEventListener(“Menu:Add”);<br>base/GeckoApp.java:1526:        registerEventListener(“Menu:Remove”);<br>base/GeckoApp.java:1527:        registerEventListener(“Menu:Update”);<br>base/GeckoApp.java:1528:        registerEventListener(“Gecko:Ready”);<br>base/GeckoApp.java:1529:        registerEventListener(“Gecko:DelayedStartup”);<br>base/GeckoApp.java:1530:        registerEventListener(“Toast:Show”);<br>base/GeckoApp.java:1531:        registerEventListener(“DOMFullScreen:Start”);<br>base/GeckoApp.java:1532:        registerEventListener(“DOMFullScreen:Stop”);<br>base/GeckoApp.java:1533:        registerEventListener(“ToggleChrome:Hide”);<br>base/GeckoApp.java:1534:        registerEventListener(“ToggleChrome:Show”);<br>base/GeckoApp.java:1535:        registerEventListener(“ToggleChrome:Focus”);<br>base/GeckoApp.java:1536:        registerEventListener(“Permissions:Data”);<br>base/GeckoApp.java:1537:        registerEventListener(“Session:StatePurged”);<br>base/GeckoApp.java:1538:        registerEventListener(“Bookmark:Insert”);<br>base/GeckoApp.java:1539:        registerEventListener(“Accessibility:Event”);<br>base/GeckoApp.java:1540:        registerEventListener(“Accessibility:Ready”);<br>base/GeckoApp.java:1541:        registerEventListener(“Shortcut:Remove”);<br>base/GeckoApp.java:1542:        registerEventListener(“Share:Text”);<br>base/GeckoApp.java:1543:        registerEventListener(“Share:Image”);<br>base/GeckoApp.java:1544:        registerEventListener(“Image:SetAs”);<br>base/GeckoApp.java:1545:        registerEventListener(“Sanitize:ClearHistory”);<br>base/GeckoApp.java:1546:        registerEventListener(“Update:Check”);<br>base/GeckoApp.java:1547:        registerEventListener(“Update:Download”);<br>base/GeckoApp.java:1548:        registerEventListener(“Update:Install”);<br>base/GeckoApp.java:1549:        registerEventListener(“PrivateBrowsing:Data”);<br>base/GeckoApp.java:1550:        registerEventListener(“Contact:Add”);<br>base/GeckoApp.java:1551:        registerEventListener(“Intent:Open”);<br>base/GeckoApp.java:1552:        registerEventListener(“Intent:GetHandlers”);<br>base/GeckoApp.java:1553:        registerEventListener(“Locale:Set”);<br>base/GeckoApp.java:1554:        registerEventListener(“NativeApp:IsDebuggable”);<br>base/GeckoApp.java:1555:        registerEventListener(“SystemUI:Visibility”);</p>
<h3 id="click"><a href="#click" class="headerlink" title="click"></a>click</h3><p>chrome/content/browser.js:1709:    Services.obs.addObserver(this, “PageActions:C<br>licked”, false);<br>chrome/content/browser.js:1710:    Services.obs.addObserver(this, “PageActions:L<br>ongClicked”, false);</p>
<h3 id="components-HelperAppDialog-js"><a href="#components-HelperAppDialog-js" class="headerlink" title="components/HelperAppDialog.js"></a>components/HelperAppDialog.js</h3><h3 id="HelperApps"><a href="#HelperApps" class="headerlink" title="HelperApps"></a>HelperApps</h3><p>mobile/android/chrome/content/HelperApps.js<br><a href="https://hg.mozilla.org/integration/fx-team/rev/dd3dd64aa432" target="_blank" rel="noopener">https://hg.mozilla.org/integration/fx-team/rev/dd3dd64aa432</a><br>  getAppsForUri</p>
<h3 id="PrefsHelper"><a href="#PrefsHelper" class="headerlink" title="PrefsHelper"></a>PrefsHelper</h3><h2 id="内存管理-GC-CC"><a href="#内存管理-GC-CC" class="headerlink" title="内存管理/GC/CC"></a>内存管理/GC/CC</h2><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.forceGC" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.forceGC</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.schedulePreciseGC" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.schedulePreciseGC</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Interfacing_with_the_XPCOM_cycle_collector" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Interfacing_with_the_XPCOM_cycle_collector</a></p>
<p>触发 CC:<br>var domWindowUtils = window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)<br>                     .getInterface(Components.interfaces.nsIDOMWindowUtils);<br>domWindowUtils.cycleCollect()</p>
<p>触发 JS GC:<br>异步：<br>Components.utils.schedulePreciseGC(function(){})<br>同步：<br>Components.utils.forceGC()</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2017/01/13/XULRunner-Gecko-Firefox/" data-id="ckb7ljdy9004blis6blsz8kpn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Firefox/" rel="tag">Firefox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/XUL/" rel="tag">XUL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/XULRunner/" rel="tag">XULRunner</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-webpack-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/01/10/webpack-note/" class="article-date">
  <time datetime="2017-01-10T07:40:44.000Z" itemprop="datePublished">2017-01-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/01/10/webpack-note/">&#39;webpack-note&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是-webpack？"><a href="#什么是-webpack？" class="headerlink" title="什么是 webpack？"></a>什么是 webpack？</h1><p>webpack是近期最火的一款模块加载器兼打包工具，它能把各种资源，例如JS（含JSX）、coffee、样式（含less/sass）、图片等都作为模块来使用和处理。<br>我们可以直接使用 require(XXX) 的形式来引入各模块，即使它们可能需要经过编译（比如JSX和sass），但我们无须在上面花费太多心思，因为 webpack 有着各种健全的加载器（loader）在默默处理这些事情，这块我们后续会提到。<br>你可以不打算将其用在你的项目上，但没有理由不去掌握它，因为以近期 Github 上各大主流的（React相关）项目来说，它们仓库上所展示的示例已经是基于 webpack 来开发的，比如 React-Boostrap 和 Redux。<br>webpack的官网是 <a href="http://webpack.github.io/" target="_blank" rel="noopener">http://webpack.github.io/</a> ，文档地址是 <a href="http://webpack.github.io/docs/" target="_blank" rel="noopener">http://webpack.github.io/docs/</a> ，想对其进行更详细了解的可以点进去瞧一瞧。</p>
<h1 id="webpack-的优势"><a href="#webpack-的优势" class="headerlink" title="webpack 的优势"></a>webpack 的优势</h1><p>其优势主要可以归类为如下几个：</p>
<ol>
<li>webpack 是以 commonJS 的形式来书写脚本滴，但对 AMD/CMD 的支持也很全面，方便旧项目进行代码迁移。</li>
<li>能被模块化的不仅仅是 JS 了。</li>
<li>开发便捷，能替代部分 grunt/gulp 的工作，比如打包、压缩混淆、图片转base64等。</li>
<li>扩展性强，插件机制完善，特别是支持 React 热插拔（见 react-hot-loader ）的功能让人眼前一亮。<br>我们谈谈第一点。以 AMD/CMD 模式来说，鉴于模块是异步加载的，所以我们常规需要使用 define 函数来帮我们搞回调：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'package/lib'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">lib</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        lib.log(<span class="string">'hello world!'</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        foo: foo</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
另外为了可以兼容 commonJS 的写法，我们也可以将 define 这么写：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">require, exports, module</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> someModule = <span class="built_in">require</span>(<span class="string">"someModule"</span>);</span><br><span class="line">    <span class="keyword">var</span> anotherModule = <span class="built_in">require</span>(<span class="string">"anotherModule"</span>);    </span><br><span class="line"> </span><br><span class="line">    someModule.doTehAwesome();</span><br><span class="line">    anotherModule.doMoarAwesome();</span><br><span class="line"> </span><br><span class="line">    exports.asplode = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        someModule.doTehAwesome();</span><br><span class="line">        anotherModule.doMoarAwesome();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
然而对 webpack 来说，我们可以直接在上面书写 commonJS 形式的语法，无须任何 define （毕竟最终模块都打包在一起，webpack 也会最终自动加上自己的加载器）：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var someModule &#x3D; require(&quot;someModule&quot;);</span><br><span class="line">    var anotherModule &#x3D; require(&quot;anotherModule&quot;);    </span><br><span class="line"> </span><br><span class="line">    someModule.doTehAwesome();</span><br><span class="line">    anotherModule.doMoarAwesome();</span><br><span class="line"> </span><br><span class="line">    exports.asplode &#x3D; function ()&#123;</span><br><span class="line">        someModule.doTehAwesome();</span><br><span class="line">        anotherModule.doMoarAwesome();</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
这样撸码自然更简单，跟回调神马的说 byebye~<br>不过即使你保留了之前 define 的写法也是可以滴，毕竟 webpack 的兼容性相当出色，方便你旧项目的模块直接迁移过来。<h1 id="安装和配置"><a href="#安装和配置" class="headerlink" title="安装和配置"></a>安装和配置</h1>一. 安装<br>我们常规直接使用 npm 的形式来安装：<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install webpack -g</span><br></pre></td></tr></table></figure>
当然如果常规项目还是把依赖写入 package.json 包去更人性化：<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br><span class="line">$ npm install webpack --save-dev</span><br></pre></td></tr></table></figure>
二. 配置<br>每个项目下都必须配置有一个 webpack.config.js ，它的作用如同常规的 gulpfile.js/Gruntfile.js ，就是一个配置项，告诉 webpack 它需要做什么。<br>我们看看下方的示例：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> commonsPlugin = <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//插件项</span></span><br><span class="line">    plugins: [commonsPlugin],</span><br><span class="line">    <span class="comment">//页面入口文件配置</span></span><br><span class="line">    entry: &#123;</span><br><span class="line">        index : <span class="string">'./src/js/page/index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//入口文件输出配置</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">'dist/js/page'</span>,</span><br><span class="line">        filename: <span class="string">'[name].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//加载器配置</span></span><br><span class="line">        loaders: [</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">'jsx-loader?harmony'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192'</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//其它解决方案配置</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        root: <span class="string">'E:/github/flux-example/src'</span>, <span class="comment">//绝对路径</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</span><br><span class="line">        alias: &#123;</span><br><span class="line">            AppStore : <span class="string">'js/stores/AppStores.js'</span>,</span><br><span class="line">            ActionType : <span class="string">'js/actions/ActionType.js'</span>,</span><br><span class="line">            AppAction : <span class="string">'js/actions/AppAction.js'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
⑴ plugins 是插件项，这里我们使用了一个 CommonsChunkPlugin 的插件，它用于提取多个入口文件的公共脚本部分，然后生成一个 common.js 来方便多页面之间进行复用。<br>⑵ entry 是页面入口文件配置，output 是对应输出项配置（即入口文件最终要生成什么名字的文件、存放到哪里），其语法大致为：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        page1: <span class="string">"./page1"</span>,</span><br><span class="line">        <span class="comment">//支持数组形式，将加载数组中的所有模块，但以最后一个模块作为输出</span></span><br><span class="line">        page2: [<span class="string">"./entry1"</span>, <span class="string">"./entry2"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="string">"dist/js/page"</span>,</span><br><span class="line">        filename: <span class="string">"[name].bundle.js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
该段代码最终会生成一个 page1.bundle.js 和 page2.bundle.js，并存放到 ./dist/js/page 文件夹下。<br>⑶ module.loaders 是最关键的一块配置。它告知 webpack 每一种文件都需要使用什么加载器来处理：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//加载器配置</span></span><br><span class="line">        loaders: [</span><br><span class="line">            <span class="comment">//.css 文件使用 style-loader 和 css-loader 来处理</span></span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">'style-loader!css-loader'</span> &#125;,</span><br><span class="line">            <span class="comment">//.js 文件使用 jsx-loader 来编译处理</span></span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js$/</span>, <span class="attr">loader</span>: <span class="string">'jsx-loader?harmony'</span> &#125;,</span><br><span class="line">            <span class="comment">//.scss 文件使用 style-loader、css-loader 和 sass-loader 来编译处理</span></span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>, <span class="attr">loader</span>: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</span><br><span class="line">            <span class="comment">//图片文件使用 url-loader 来处理，小于8kb的直接转为base64</span></span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192'</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
如上，”-loader”其实是可以省略不写的，多个loader之间用“!”连接起来。<br>注意所有的加载器都需要通过 npm 来加载，并建议查阅它们对应的 readme 来看看如何使用。<br>拿最后一个 url-loader 来说，它会将样式中引用到的图片转为模块来处理，使用该加载器需要先进行安装：<br>npm install url-loader -save-dev<br>配置信息的参数“?limit=8192”表示将所有小于8kb的图片都转为base64形式（其实应该说超过8kb的才使用 url-loader 来映射到文件，否则转为data url形式）。<br>⑷ 最后是 resolve 配置，这块很好理解，直接写注释了：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">        <span class="comment">//查找module的话从这里开始查找</span></span><br><span class="line">        root: <span class="string">'E:/github/flux-example/src'</span>, <span class="comment">//绝对路径</span></span><br><span class="line">        <span class="comment">//自动扩展文件后缀名，意味着我们require模块可以省略不写后缀名</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.scss'</span>],</span><br><span class="line">        <span class="comment">//模块别名定义，方便后续直接引用别名，无须多写长长的地址</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">            AppStore : <span class="string">'js/stores/AppStores.js'</span>,<span class="comment">//后续直接 require('AppStore') 即可</span></span><br><span class="line">            ActionType : <span class="string">'js/actions/ActionType.js'</span>,</span><br><span class="line">            AppAction : <span class="string">'js/actions/AppAction.js'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
关于 webpack.config.js 更详尽的配置可以参考这里。<br>运行 webpack<br>webpack 的执行也很简单，直接执行<br>$ webpack –display-error-details<br>即可，后面的参数“–display-error-details”是推荐加上的，方便出错时能查阅更详尽的信息（比如 webpack 寻找模块的过程），从而更好定位到问题。<br>其他主要的参数有：<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ webpack --config XXX.js   /<span class="regexp">/使用另一份配置文件（比如webpack.config2.js）来打包</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">$ webpack --watch   /</span><span class="regexp">/监听变动并自动打包</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">$ webpack -p    /</span><span class="regexp">/压缩混淆脚本，这个非常非常重要！</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">$ webpack -d    /</span><span class="regexp">/生成map映射文件，告知哪些模块被最终打包到哪里了</span></span><br></pre></td></tr></table></figure>
其中的 -p 是很重要的参数，曾经一个未压缩的 700kb 的文件，压缩后直接降到 180kb（主要是样式这块一句就独占一行脚本，导致未压缩脚本变得很大）。<br>模块引入<br>上面唠嗑了那么多配置和执行方法，下面开始说说寻常页面和脚本怎么使用呗。<br>一. HTML<br>直接在页面引入 webpack 最终生成的页面脚本即可，不用再写什么 data-main 或 seajs.use 了：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/js/page/common.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/js/page/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
可以看到我们连样式都不用引入，毕竟脚本执行时会动态生成<strong>&lt;style&gt;</strong>并标签打到head里。</li>
</ol>
<p>二. JS<br>各脚本模块可以直接使用 commonJS 来书写，并可以直接引入未经编译的模块，比如 JSX、sass、coffee等（只要你在 webpack.config.js 里配置好了对应的加载器）。<br>我们再看看编译前的页面入口文件（index.js）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'../../css/reset.scss'</span>); <span class="comment">//加载初始化样式</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../../css/allComponent.scss'</span>); <span class="comment">//加载组件样式</span></span><br><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"><span class="keyword">var</span> AppWrap = <span class="built_in">require</span>(<span class="string">'../component/AppWrap'</span>); <span class="comment">//加载组件</span></span><br><span class="line"><span class="keyword">var</span> createRedux = <span class="built_in">require</span>(<span class="string">'redux'</span>).createRedux;</span><br><span class="line"><span class="keyword">var</span> Provider = <span class="built_in">require</span>(<span class="string">'redux/react'</span>).Provider;</span><br><span class="line"><span class="keyword">var</span> stores = <span class="built_in">require</span>(<span class="string">'AppStore'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> redux = createRedux(stores);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> App = React.createClass(&#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Provider redux=&#123;redux&#125;&gt;</span><br><span class="line">                &#123;<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">AppWrap</span> /&gt;</span></span>; &#125;&#125;</span><br><span class="line">            &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">React.render(</span></span><br><span class="line"><span class="regexp">    &lt;App /</span>&gt;, <span class="built_in">document</span>.body</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>一切就是这么简单么么哒~ 后续各种有的没的，webpack 都会帮你进行处理。<br>其他<br>至此我们已经基本上手了 webpack 的使用，下面是补充一些有用的技巧。<br>一. shimming<br>在 AMD/CMD 中，我们需要对不符合规范的模块（比如一些直接返回全局变量的插件）进行 shim 处理，这时候我们需要使用 exports-loader 来帮忙：<br>{ test: require.resolve(“./src/js/tool/swipe.js”),  loader: “exports?swipe”}<br>之后在脚本中需要引用该模块的时候，这么简单地来使用就可以了：<br>require(‘./tool/swipe.js’);<br>swipe();<br>二. 自定义公共模块提取<br>在文章开始我们使用了 CommonsChunkPlugin 插件来提取多个页面之间的公共模块，并将该模块打包为 common.js 。<br>但有时候我们希望能更加个性化一些，我们可以这样配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CommonsChunkPlugin = <span class="built_in">require</span>(<span class="string">"webpack/lib/optimize/CommonsChunkPlugin"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        p1: <span class="string">"./page1"</span>,</span><br><span class="line">        p2: <span class="string">"./page2"</span>,</span><br><span class="line">        p3: <span class="string">"./page3"</span>,</span><br><span class="line">        ap1: <span class="string">"./admin/page1"</span>,</span><br><span class="line">        ap2: <span class="string">"./admin/page2"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"[name].js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CommonsChunkPlugin(<span class="string">"admin-commons.js"</span>, [<span class="string">"ap1"</span>, <span class="string">"ap2"</span>]),</span><br><span class="line">        <span class="keyword">new</span> CommonsChunkPlugin(<span class="string">"commons.js"</span>, [<span class="string">"p1"</span>, <span class="string">"p2"</span>, <span class="string">"admin-commons.js"</span>])</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// &lt;script&gt;s required:</span></span><br><span class="line"><span class="comment">// page1.html: commons.js, p1.js</span></span><br><span class="line"><span class="comment">// page2.html: commons.js, p2.js</span></span><br><span class="line"><span class="comment">// page3.html: p3.js</span></span><br><span class="line"><span class="comment">// admin-page1.html: commons.js, admin-commons.js, ap1.js</span></span><br><span class="line"><span class="comment">// admin-page2.html: commons.js, admin-commons.js, ap2.js</span></span><br></pre></td></tr></table></figure>

<p>三. 独立打包样式文件<br>有时候可能希望项目的样式能不要被打包到脚本中，而是独立出来作为.css，然后在页面中以<strong>&lt;link&gt;</strong>标签引入。这时候我们需要 extract-text-webpack-plugin 来帮忙：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line">    <span class="keyword">var</span> commonsPlugin = <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">'common.js'</span>);</span><br><span class="line">    <span class="keyword">var</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">        plugins: [commonsPlugin, <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"[name].css"</span>)],</span><br><span class="line">        entry: &#123;</span><br><span class="line">        <span class="comment">//...省略其它配置</span></span><br></pre></td></tr></table></figure>
<p>最终 webpack 执行后会乖乖地把样式文件提取出来：</p>
<p>四. 使用CDN/远程文件<br>有时候我们希望某些模块走CDN并以&lt;script&gt;的形式挂载到页面上来加载，但又希望能在 webpack 的模块中使用上。<br>这时候我们可以在配置文件里使用 externals 属性来帮忙：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    externals: &#123;</span><br><span class="line">        <span class="comment">// require("jquery") 是引用自外部模块的</span></span><br><span class="line">        <span class="comment">// 对应全局变量 jQuery</span></span><br><span class="line">        <span class="string">"jquery"</span>: <span class="string">"jQuery"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要留意的是，得确保 CDN 文件必须在 webpack 打包文件引入之前先引入。<br>我们倒也可以使用 script.js 在脚本中来加载我们的模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var $script &#x3D; require(&quot;scriptjs&quot;);</span><br><span class="line">$script(&quot;&#x2F;&#x2F;ajax.googleapis.com&#x2F;ajax&#x2F;libs&#x2F;jquery&#x2F;2.0.0&#x2F;jquery.min.js&quot;, function() &#123;</span><br><span class="line">  $(&#39;body&#39;).html(&#39;It works!&#39;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>五. 与 grunt/gulp 配合<br>以 gulp 为示例，我们可以这样混搭：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">"webpack"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// run webpack</span></span><br><span class="line">    webpack(&#123;</span><br><span class="line">        <span class="comment">// configuration</span></span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> <span class="keyword">new</span> gutil.PluginError(<span class="string">"webpack"</span>, err);</span><br><span class="line">        gutil.log(<span class="string">"[webpack]"</span>, stats.toString(&#123;</span><br><span class="line">            <span class="comment">// output options</span></span><br><span class="line">        &#125;));</span><br><span class="line">        callback();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然我们只需要把配置写到 webpack({ … }) 中去即可，无须再写 webpack.config.js 了。<br>更多参照信息请参阅：<a href="http://webpack.github.io/docs/usage-with-grunt.html" target="_blank" rel="noopener">grunt配置</a> / <a href="http://webpack.github.io/docs/usage-with-gulp.html" target="_blank" rel="noopener">gulp配置</a> 。<br>六. React 相关<br>⑴ 推荐使用 npm install react 的形式来安装并引用 React 模块，而不是直接使用编译后的 react.js，这样最终编译出来的 React 部分的脚本会减少 10-20 kb左右的大小。<br>⑵ <a href="https://github.com/gaearon/react-hot-loader" target="_blank" rel="noopener">react-hot-loader</a> 是一款非常好用的 React 热插拔的加载插件，通过它可以实现修改-运行同步的效果，配合 <a href="http://webpack.github.io/docs/webpack-dev-server.html" target="_blank" rel="noopener">webpack-dev-server</a> 使用更佳！<br>基于 webpack 的入门指引就到这里，希望本文能对你有所帮助，你也可以参考下述的文章来入门：<br><a href="http://www.w2bc.com/article/101955" target="_blank" rel="noopener">webpack入门指谜</a><br><a href="https://github.com/petehunt/webpack-howto" target="_blank" rel="noopener">webpack-howto</a><br>共勉~<br>原文：<br><a href="http://www.w2bc.com/Article/50764" target="_blank" rel="noopener">http://www.w2bc.com/Article/50764</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2017/01/10/webpack-note/" data-id="ckb7ljdxo0029lis6d7ft5j0z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-electron-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/30/electron-note/" class="article-date">
  <time datetime="2016-11-30T08:54:47.000Z" itemprop="datePublished">2016-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/30/electron-note/">electron-note</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="electron框架笔记"><a href="#electron框架笔记" class="headerlink" title="electron框架笔记"></a>electron框架笔记</h1><ol>
<li><p>Electron支持的平台</p>
<ul>
<li>OS X</li>
<li>Windows</li>
<li>Linux</li>
</ul>
</li>
<li><p>标准的electron app包含的结构<br>window 或是 linux 中<br>electron/resource/app<br>|_package.json<br>|_main.js<br>|_index.html</p>
</li>
<li><p>electron 程序打包<br>一般使用asar进行打包，electron中包含两种API<br>Node.js和Chromium提供的Web API</p>
</li>
<li><p>使用Native Node模块</p>
<ul>
<li>electron-rebuild</li>
<li>使用npm</li>
<li>使用node-gyp</li>
</ul>
</li>
<li><p>测试主进程<br>window下面的DevTools只能测试渲染进程，为了测试朱经常也可以使用–debug或–debug-brk分支，node-inspector也可以使用</p>
</li>
<li><p>electron 简述<br>electron可以让你使用javascript来创建桌面应用，可以将其理解为Node.js的一个变体，它提供了丰富的运行时访问Native的API接口。<br>但是electron并不是一个GUI库，相反的，electron使用web页面作为它的GUI，所以可以将它看做是一个小的Chromium浏览器。<br>在Electron中运行package.json和main脚本的进程成为主进程，可以在主进程中通过创建Web页面来显示GUI。<br>electron使用Chromium的多进程机制来渲染页面，每个页面拥有一个自己的进程，该进程成为渲染进程。<br>在electron中用户可以通过Node.js的API跨过网页运行的沙箱去访问更为底层的系统应用。<br>主进程通过使用BrowserWindow实例创建页面，每个BrowserWindow都是在自己的渲染进程中运行。<br>当一个BrowserWindow实例被销毁的时候对应的渲染进程也被销毁了。<br>主进程管理着所有的网页和它们对应的渲染进程，每个渲染进程只关心自己的网页。<br>渲染进程若是想访问GUI操作，需要向主进程发出请求。<br>在electron中主进程和渲染进程之间有几种交互方式：ipcRenderer和ipcMain来发送messages。</p>
</li>
<li><p>一个简单完整的electron app<br>package.json文件的格式和Node的模块是一样的，main.js是app启动脚本，将会运行在主进程中。<br>如果main没有出现在package.json中，electron将会尝试装载index.js<br>main.js需要创建window界面并处理系统事件运行electron程序：<br>可以先用npm装上electron-prebuilt，进入app的root目录。<br>执行 <strong>electron .</strong>。</p>
</li>
<li><p>桌面环境的整合<br>关于Notification通知：<br>HTML5的API只能是在渲染进程中使用，Windows，Linux和OS X中都支持通知机制。<br>其他的功能看具体的桌面环境进行相应的配置</p>
</li>
<li><p>在线和离线事件监测<br>electron主进程中并不能利用HTML5中的navigator对象进行事件探测，但是可以利用electron中的交互工具将事件监测结果反馈给主进程。<br>使用ipcMain和ipcRender进行事件信息的传递</p>
</li>
<li><p>electron中API概要<br>electron支持所有的Node.js的内建模块，也支持第三方的node模块，包括native模块。<br>electron同时提供了额外的native内建模块可以用于开发原生的桌面应用。<br>一些模块只能在主进程中使用，一些模块只能是在渲染进程中使用，而有一些是通用的模块。<br>规则为：如果模块是GUI或是和底层系统相关的就是只能在主进程中使用。<br>主进程就是main.js而渲染进程是在index.html中运行。     </p>
</li>
<li><p>进程对象<br>进程process对象和一般的node区别在于：<br>process.type 进程的类型可以是browser或是renderer<br>process.version[‘electron’] electron的版本<br>process.version[‘chome’] Chromium的版本<br>process.resourcesPath Javascript脚本文件的路径<br>process.mas 构建Mac应用商店时值为true，其他的为undefined。</p>
</li>
<li><p>事件<br>当electron装载内部初始化脚本的时候，页面和主脚本文件就开始装载<br>此时会触发事件。</p>
</li>
<li><p>electron支持的Chromium命令行开关<br>–client-certificate=path<br>–ignore-connections-limit=domains<br>–disable-http-cache<br>–remote-debugging-port=port<br>–js-flags=flags<br>–proxy-server=address:port<br>–proxy-bypass-list=hosts<br>–proxy-pac-url=url<br>–no-proxy-server<br>–host-rules=rules<br>–host-resolver-rules=runles<br>…</p>
</li>
<li><p>环境变量<br>export ELECTRON_ENABLE_LOGGING=true<br>ELECTRON_RUN_AS_NODE<br>ELECTRON_ENABLE_LOGGING</p>
</li>
<li><p>定址DOM元素<br>File对象：<br>DOM的File接口通过HTML5的API提供了用户操作native文件的方法。<br>electron增加了path属性接口可以直接访问文件的真实路径<br>标签：<br>webview标签在electron app中植入额外的内容，和iframe不同的是webview运行在一个独立的进程中，它并不具有和你的页面相同的权限，所有app和它的交互都是异步进行的，这使得app在使用植入内容的时候更加安全。<br>window.open函数：<br>当调用window.open的时候会在页面中新创建一个窗口，默认情况下创建的BrowserWindow将会继承父类窗口的options。</p>
</li>
<li><p>主进程的模块<br>1)app模块：<br>负责控制应用程序的生命周期如<br>const app = require(‘electron’).app;<br>app.on(‘window-all-closed’, function(){<br>app.quit();<br>});<br>app对象可以发出以下事件：<br>will-finish-launching<br>当程序完成基本的启动，类似于ready事件。启动crash事件监听或是自动更新。大多数情况下，需要在ready事件中处理更多的事情。<br>ready<br>electron完成初始化<br>window-all-closed<br>当所有的窗口都已经关闭的时候触发，只有在当程序将要推退出的时候触发。当用户调用app.quit()的时候，electron会关闭所有的窗口并<br>发出will-quit事件，此时便不会发出window-all-clised事件。<br>before-quit<br>当程序开始关闭窗口的时候发出,调用event.prevertDefault()将会阻止默认的行为。<br>will-quit<br>当窗口都已经关闭，程序即将退出的时候发出该事件。<br>quit<br>程序退出<br>…<br>2)autoUpdater模块<br>该模块提供了Squirrel自动更新框架一个接口<br>3)BrowserWindow模块<br>可以用于创建一个新的浏览器窗口<br>4)contentTracing模块<br>用来收集Chromium内容模块产生的跟踪信息。<br>5)dialog模块<br>用来显示原生系统对话框，比如打开文件对话框<br>6)globalShortcut模块<br>用来注册和注销全局的键盘快捷方式。<br>7)ipcMain模块<br>该模块是EventEmitter的一个实例对象，在主进程中使用，可以发送同步或是异步的message和渲染进程 进行交互。<br>8)Menu模块<br>用来创建一个原生的菜单，比如上下文菜单。<br>9)MenuItem模块<br>用来往菜单中添加菜单子项。<br>10)powerMonitor模块<br>用来显示电池电量变化，只能是在主进程中使用，而且只能是在ready事件已经发出的情况下。<br>11)powerSaveBlocker模块<br>用来阻止系统进入省电模式，休眠模式。<br>12)protocol模块<br>用来注册一个定制的协议或是声明使用一个已经存在的协议<br>13)session模块<br>用来创建新的Session对象，保存本地对象等操作。<br>14)webContents模块<br>这是一个EventEmitter，负责渲染和控制一个网页，是一个BrowserWindow的属性。<br>15)Tray模块<br>一个Tray代表着一个操作系统通知区域的一个icon，通常情况下是和一个上下文菜单绑定的。</p>
</li>
<li><p>渲染进程的模块<br>1)desktopCapturer模块<br>用来获取可用的资源，可以用getUserMedia来获取。<br>2)ipcRenderer对象<br>是一个EventEmitter对象的实例，提供了一些方法可以用来和主进程之间进行message交互。<br>3)remote模块<br>提供了一个简单的跨进程之间通信的方法。GUI相关的模块只能是在主进程中使用像是dialog和menu等，如果想要在渲染进程中使用就需要使用ipc机制向主进程申请。remote模块有点像是java中的RMI<br>4)webFrame模块<br>用来定制当前网页的渲染。</p>
</li>
<li><p>两个进程共同的模块<br>1)clipboard模块<br>提供了执行复制和粘贴操作的方法。<br>2)crashReporter模块<br>发送程序的奔溃报告。<br>3)nativeImage模块<br>在electron中获取图片可以通过文件的路径或是使用nativeImage对象。<br>4)screen模块<br>这是一个EventEmitter，保存了关于屏幕的所有相关信息，像是大小，显示，指针位置等等。直到ready事件触发之后才能使用。<br>5)shell模块<br>同了和桌面整合相关的函数。</p>
</li>
<li><p>开发electron相关知识<br>1)代码格式<br>可以通过运行npm run lint来显示利用cpplint或是eslint获取到的代码风格。<br>javascript中：<br>文件不要使用空行结尾<br>文件必须包含-而不是下划线_<br>const和let的使用<br>function中=&gt;返回值的声明<br>字符串的模板使用，不在使用+，注意$的使用<br>API的名称中更倾向于使用setter和getter而不是JQuery中<br>的直接.text之类的用法。<br>2)源码目录结构<br>Electron<br>├── atom - C++ 源码.<br>| ├── app - 系统程序入口.<br>| ├── browser - 包含了主窗口，UI和所有主进程相关的东西<br>| |<br>| | ├── ui - 为不同的平台实现不用的UI界面.<br>| | | ├── cocoa - Cocoa指定源码.<br>| | | ├── gtk - GTK+ 指定源码.<br>| | | └── win - Windows GUI指定源码.<br>| | ├── api - 主进程API的实现.<br>| | ├── net - 网络相关代码.<br>| | ├── mac - Mac指定Objective-C源代码.<br>| | └── resources - icon，平台相关的文件等等.<br>| ├── renderer - 运行在渲染进程的代码.<br>| | └── api - 渲染进程中API的实现代码.<br>| └── common - 主进程和渲染进程共同使用的代码,包括一些函数工具，以及整合node的信息到Chromium的message loop中。<br>| └── api - 通用的API实现，以及electron内建模块的实现<br>|<br>├── chromium_src - 从Chromium中拷贝的源代码.<br>├── default_app - electron默认显示的页面<br>|<br>├── docs - 文档文件.<br>├── lib - JavaScript的源代码.<br>| ├── browser - Javascript主进程初始化代码.<br>| | └── api - Javascript API实现代码.<br>| ├── common - JavaScript通用的代码<br>| | └── api - Javascript通用API实现代码.<br>| └── renderer - Javascript渲染进程初始化代码.<br>| └── api - Javascript渲染进程API实现代码.<br>├── spec - 自动化测试.<br>├── atom.gyp - electron的构建规则.<br>└── common.gypi - 其他的设置和像是node组件或是breakpad组件的构建规则.</p>
<p>其他的文件夹：<br>script - 构建，打包，测试相关的脚本文件<br>tools - gyp文件的帮助脚本，不能被用户直接调用的.<br>vendor - 第三方依赖库源码.<br>node_modules - 构建的时候需要使用的第三方node模块.<br>out - ninja输出的临时文件目录.<br>dist - 在创建distribution的时候生成的临时目录.<br>external_binaries - 下载的第三方不支持gyp的二进制框架.</p>
</li>
<li><p>构建系统<br>1)electron利用gyp来生成项目，利用ninja来构建项目。项目的配置信息是在.gyp或是.gypi文件中。<br>gyp文件包含electron项目的构建规则：<br>atom.gyp定义了electron本身如何构建<br>common.gyp调整Node的构建配置以适应Chromium<br>vendor/brightray/brightray.gyp定义了brightray如何创建包含了链接Chromium的默认配置<br>vendor/brightray/brightray.gypi包含了通用的构建配置<br>2)组件的构建<br>由于Chromium是一个大工程，链接的时候需要很长的事件，所以Chromium引进了组件构建：将每个组件作为一个独立的共享库，使得链接的时候文件大小和执行速度得到提升。<br>在electron中如果是Debug构建的话，二进制文件会链接到Chromium的共享库版本以提升链接速度。如果是Release构建的话，二进制文件会链接到静态共享库中以获得最佳文件大小和执行效率。<br>3)项目的两个阶段生成方式<br>Release和Debug构建，可以链接不同的库。electron使用的是R和D作为对应的标示。<br><a href="http://www.2cto.com/kf/201604/499352.html" target="_blank" rel="noopener">‘electron笔记原地址’</a>    </p>
</li>
</ol>
<h1 id="调试electron"><a href="#调试electron" class="headerlink" title="调试electron"></a>调试electron</h1><p>原文<br><a href="http://floatincode.net/post/debugging-electron-application-with-visual-studio-code" target="_blank" rel="noopener">http://floatincode.net/post/debugging-electron-application-with-visual-studio-code</a></p>
<p>首先需要配置visual studio code的launch.json文件</p>
<p>如原文所示需要配置一个Attach对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">  &quot;configurations&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;启动扩展&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;extensionHost&quot;,</span><br><span class="line">      &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">      &quot;runtimeExecutable&quot;: &quot;$&#123;execPath&#125;&quot;,</span><br><span class="line">      &quot;args&quot;: [</span><br><span class="line">        &quot;--extensionDevelopmentPath&#x3D;$&#123;workspaceRoot&#125;&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;sourceMaps&quot;: true,</span><br><span class="line">      &quot;outFiles&quot;: [</span><br><span class="line">        &quot;$&#123;workspaceRoot&#125;&#x2F;out&#x2F;**&#x2F;*.js&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;preLaunchTask&quot;: &quot;npm&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 下面是重点</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Attach&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;node&quot;,</span><br><span class="line">      &quot;request&quot;: &quot;attach&quot;,</span><br><span class="line">      &quot;port&quot;: 56654,</span><br><span class="line">      &quot;sourceMaps&quot;: false,</span><br><span class="line">      &quot;outDir&quot;: null,</span><br><span class="line">      &quot;localRoot&quot;: &quot;$&#123;workspaceRoot&#125;&quot;,</span><br><span class="line">      &quot;remoteRoot&quot;: null,</span><br><span class="line">      &quot;address&quot;: &quot;localhost&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在运行electron path/to/app –debug=port</p>
<p>本项目根为hulianketang,在此目录下输入cmd命令<br>electron ./src –debug=56654</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/30/electron-note/" data-id="ckb7ljdxa001dlis65ehd8zjt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-debug-gruntfile-task" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/18/how-to-debug-gruntfile-task/" class="article-date">
  <time datetime="2016-11-18T02:31:22.000Z" itemprop="datePublished">2016-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/18/how-to-debug-gruntfile-task/">how-to-debug-gruntfile-task</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Node-Debug"><a href="#Node-Debug" class="headerlink" title="Node Debug"></a>Node Debug</h1><p>关于node的调试有多种方式<br>第一种：node 内建调试<br>如执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node debug *.js</span><br></pre></td></tr></table></figure>
<p>*(星号)表示文件路径/文件名</p>
<p>help commands：<br>Commands:<br>    run (r),<br>    cont (c),    继续执行<br>    next (n),    n - step next<br>    step (s),    s - step in<br>    out (o),     o - step out<br>    backtrace (bt) ,  显示当前执行框架的回溯<br>    setBreakpoint (sb),<br>      setBreakpoint() or sb() 在当前行设置断点<br>      setBreakpoint(1) or sb(1) 在指定行设置断点<br>      setBreakpoint(‘fn()’) or sb(…) 在函数第一句设置断点<br>      setBreakpoint (‘script.js’,1) or sb(..)  在 script.js 的第一行设置断点<br>    clearBreakpoint (cb),   清除断点<br>    watch,              watch(“my_expressin”) 开始监视一个表达式<br>    unwatch,            watch(“my_expressin”) 移除一个监视器<br>    watchers,           显示活动监视器<br>    repl,               在所调试的脚本的上下文中打开调试器的 repl 执行代码<br>    restart,            重新运行脚本<br>    kill,               终止脚本<br>    list,               list(5) 显示脚本源代码的5行上下文 前五后五<br>    scripts,            列出所有已加载的脚本<br>    breakOnException,<br>    breakpoints,<br>    version，           显示v8版本<br>    pause,              暂停执行代码（类似开发者工具中的暂停按钮）<br>    高级使用<br>    V8 调试器可以从两种方式启用和访问：以 –debug 命令行标志启动 Node；或者向已存在的 Node 进程发送 SIGUSR1 信号<br>    一旦一个进程进入了调试模式，它便可被 Node 调试器连接。调试器可以通过 pid 或 URI 来连接，语法是<br>    node debug -p <pid> - 通过 pid 连接进程<br>    node debug <URI> - 通过类似 localhost:5858 的 URI 连接进程</p>
<p>第二种：各大工具类<br>如eclipse，visualstudio都有辅助工具插件类。相关的资料请自行网上查找</p>
<p>第三种：基于chrome的调试器<br>强烈推荐<br>需要安装 <strong>node-inspector</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g node-inspector</span><br></pre></td></tr></table></figure>
<p>node-inspector是通过websocket方式来转向debug输入输出的。<br>因此，我们在调试前要先启动node-inspector来监听Nodejs的debug调试端口<br>默认情况下node-inspector的端口是8080，可以通过参数<strong>–web-port=[port]</strong>来设置端口。<br>在启动<strong>node-inpspector</strong>之后，我们可以通过<strong>–debug</strong>或<strong>–debug-brk</strong>来启动nodejs程序。<br>通过在浏览器输入http://[ip address]:8080/debug?port=5858<br>步骤：</p>
<ol>
<li>-&gt; 打开目录 输入cmd 进入控制台dos<br> 输入 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --debug-brk&#x3D;56666 example.js</span><br></pre></td></tr></table></figure>
 表示监听 通过56666端口监听 example.js<br>2 -&gt; 同1操作一样<br> 命令换成 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node-inspector &#x2F;&#x2F;默认情况为5858端口</span><br></pre></td></tr></table></figure>
 采用新的端口监听 对应56666端口<br> 用这个命令 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node-inspector -web-port 56666</span><br></pre></td></tr></table></figure>
<h1 id="Gruntfile-Debug"><a href="#Gruntfile-Debug" class="headerlink" title="Gruntfile Debug"></a>Gruntfile Debug</h1></li>
</ol>
<p>在gruntfile.js所在目录打开一个控制台窗口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node-inspector</span><br></pre></td></tr></table></figure>
<p>再打开一个控制台窗口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node-debug grunt ftp:JHZT</span><br></pre></td></tr></table></figure>
<p>ftp:JHZT是grunt 的一个<strong>task</strong>任务</p>
<p>在chrome输入<br><a href="http://127.0.0.1:8080/?port=5858" target="_blank" rel="noopener">http://127.0.0.1:8080/?port=5858</a> 会进入调试模式<br>需要注意的：为了便于调试，最好在Gruntfile.js文件中需要调试地方加入 <strong>debugger;</strong> 关键字</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/18/how-to-debug-gruntfile-task/" data-id="ckb7ljdxc001glis6am8y6imq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/debug/" rel="tag">debug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/grunt/" rel="tag">grunt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/gruntfile/" rel="tag">gruntfile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-use-counter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/14/how-to-use-counter/" class="article-date">
  <time datetime="2016-11-14T08:34:50.000Z" itemprop="datePublished">2016-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/14/how-to-use-counter/">how-to-use-counter</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="css计数器的三角关系"><a href="#css计数器的三角关系" class="headerlink" title="css计数器的三角关系"></a>css计数器的三角关系</h1><p>计数器 &lt;-&gt; 伪元素 &lt;-&gt; content属性<br>计数器的2个属性和1个方法</p>
<ol>
<li>counter-reset</li>
<li>counter-increment</li>
<li>counter()/counters()</li>
</ol>
<ul>
<li><p>counter-reset是计数器重置，计数器命名，设置默认值<br>如:</p>
<ul>
<li>.xxx{ counter-reset:counter-test; }<br>计数器名称是’counter-test’,默认值为0</li>
<li>.xxx{ counter-reset:counter-test 2;}<br>计数器名称是’counter-test’,设置默认值为2</li>
</ul>
</li>
<li><p>counter-increment<br>计数器增加默认值为1，可以设置为任意整数(负数亦可)<br>如：</p>
<ul>
<li>.counter1 { counter:apple; counter-increment:apple; }<br>.counter1:before { content:counter(apple) }<br>apple默认值为0,应用了样式counter1的元素第一个显示为1，如果还有第二个应用了<br>那么apple会增加1</li>
<li>.counter2 { counter:apple; counter-increment:apple 2; }<br>这里设置增量为2，即一次增加2</li>
</ul>
</li>
<li><p>counter()/counters()这个是方法</p>
<ul>
<li><p>counter()</p>
<ul>
<li>counter(name) name就是counter-reset的名称</li>
<li>counter(name,style) style支持的关键字是<strong>list-style-type</strong>的值<br>list-style-type<ul>
<li>disc</li>
<li>circle</li>
<li>square</li>
<li>decimal</li>
<li>lower-roman</li>
<li>upper-roman</li>
<li>lower-alpha </li>
<li>upper-alpha </li>
<li>none </li>
<li>armenian </li>
<li>cjk-ideographic </li>
<li>georgian </li>
<li>lower-greek </li>
<li>hebrew </li>
<li>hiragana </li>
<li>hiragana-iroha </li>
<li>katakana </li>
<li>katakana-iroha </li>
<li>lower-latin </li>
<li>upper-latin</li>
</ul>
</li>
</ul>
</li>
<li><p>counters() 主要用于counter的嵌套<br>css:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.reset &#123; padding-left: 20px; counter-reset: wangxiaoer; line-height: 1.6; color: #666; &#125;</span><br><span class="line">.counter:before &#123; <span class="attr">content</span>: counters(wangxiaoer, <span class="string">'-'</span>) <span class="string">'. '</span>; counter-increment: wangxiaoer; font-family: arial black; &#125;</span><br></pre></td></tr></table></figure>

<p>html:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reset"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小二</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reset"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小二的大儿子&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div class="counter"&gt;我是王小二的二儿子</span></span><br><span class="line"><span class="regexp">            &lt;div class="reset"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div class="counter"&gt;我是王小二的二儿子的大孙子&lt;/</span>div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小二的二儿子的二孙子&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div class="counter"&gt;我是王小二的二儿子的小孙子&lt;/</span>div&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小二的三儿子&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="counter"&gt;我是王小三&lt;/</span>div&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小四</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"reset"</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"counter"</span>&gt;我是王小四的大儿子&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<h1 id="CSS计数器与display-none"><a href="#CSS计数器与display-none" class="headerlink" title="CSS计数器与display:none"></a>CSS计数器与display:none</h1><p>一个元素，如果设置了counter-increment, 但是其display的属性值是none或者含有hidden属性（针对支持浏览器），则此计数值是不会增加的。<br>而visibility:hidden以及其他声明不会有此现象。</p>
</li>
</ul>
</li>
</ul>
<h1 id="CSS计数器实际应用"><a href="#CSS计数器实际应用" class="headerlink" title="CSS计数器实际应用"></a>CSS计数器实际应用</h1><p> ol ul等列表计数<br> html5幻灯片页面数量计数等</p>
<p><a href="http://www.zhangxinxu.com/wordpress/2014/08/css-counters-automatic-number-content/" target="_blank" rel="noopener">参照整理</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Lists_and_Counters/Using_CSS_counters" target="_blank" rel="noopener">Using Css counters</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/counter-reset" target="_blank" rel="noopener">counter-set</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/counter-increment" target="_blank" rel="noopener">counter-increment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/14/how-to-use-counter/" data-id="ckb7ljdxd001jlis6dutzfk18" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/counter/" rel="tag">counter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/css/" rel="tag">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E8%AE%A1%E6%95%B0%E5%99%A8/" rel="tag">计数器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-NextT-vendors-to-lib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/14/NextT-vendors-to-lib/" class="article-date">
  <time datetime="2016-11-14T07:34:04.000Z" itemprop="datePublished">2016-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/14/NextT-vendors-to-lib/">NextT-vendors-to-lib</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hexo-NextT-加载空白问题"><a href="#hexo-NextT-加载空白问题" class="headerlink" title="hexo NextT 加载空白问题"></a>hexo NextT 加载空白问题</h1><p><a href="https://github.com/iissnan/hexo-theme-next/issues/1214" target="_blank" rel="noopener">Detail: https://github.com/iissnan/hexo-theme-next/issues/1214</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/14/NextT-vendors-to-lib/" data-id="ckb7ljdwi0009lis6gymz0rxd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/NextT/" rel="tag">NextT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Theme/" rel="tag">Theme</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-window-postmessage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/09/window-postmessage/" class="article-date">
  <time datetime="2016-11-09T10:00:05.000Z" itemprop="datePublished">2016-11-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/09/window-postmessage/">window-postmessage</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h1><p>跨文档通信 API（Cross-document messaging）。</p>
<p>这个API为window对象新增了一个window.postMessage方法，允许跨窗口通信，不论这两个窗口是否同源。</p>
<p>举例来说，父窗口aaa.com向子窗口bbb.com发消息，调用postMessage方法就可以了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> top = <span class="built_in">window</span>.open(<span class="string">'http://bbb.com'</span>, <span class="string">'title'</span>);</span><br><span class="line">top.postMessage(<span class="string">'Hello World!'</span>, <span class="string">'http://bbb.com'</span>);</span><br></pre></td></tr></table></figure>

<p>postMessage方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源（origin），即“协议 + 域名 + 端口”。<br>也可以设为*，表示不限制域名，向所有窗口发送。</p>
<p>子窗口向父窗口发送消息的写法类似。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.opener.postMessage(<span class="string">'Nice to see you'</span>, <span class="string">'http://aaa.com'</span>);</span><br></pre></td></tr></table></figure>
<p>父窗口和子窗口都可以通过message事件，监听对方的消息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data);</span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><strong>message</strong>事件的事件对象<strong>event</strong>，提供以下三个属性</p>
<ul>
<li>event.source：发送消息的窗口</li>
<li>event.origin: 消息发向的网址</li>
<li>event.data: 消息内容</li>
</ul>
<p>下面的例子是，子窗口通过event.source属性引用父窗口，然后发送消息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, receiveMessage);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.source.postMessage(<span class="string">'Nice to see you!'</span>, <span class="string">'*'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码有几个地方需要注意。<br>首先，receiveMessage函数里面没有过滤信息的来源，任意网址发来的信息都会被处理。<br>其次，postMessage方法中指定的目标窗口的网址是一个星号，表示该信息可以向任意网址发送。<br>通常来说，这两种做法是不推荐的，因为不够安全，可能会被恶意利用。</p>
<p><strong>event.origin</strong>属性可以过滤不是发给本窗口的消息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, receiveMessage);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.origin !== <span class="string">'http://aaa.com'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (event.data === <span class="string">'Hello World'</span>) &#123;</span><br><span class="line">      event.source.postMessage(<span class="string">'Hello'</span>, event.origin);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="postmessage读取LocalStorage"><a href="#postmessage读取LocalStorage" class="headerlink" title="postmessage读取LocalStorage"></a>postmessage读取LocalStorage</h1><p>下面是一个例子，主窗口写入iframe子窗口的localStorage。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.origin !== <span class="string">'http://bbb.com'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> payload = <span class="built_in">JSON</span>.parse(e.data);</span><br><span class="line">  localStorage.setItem(payload.key, <span class="built_in">JSON</span>.stringify(payload.data));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面代码中，子窗口将父窗口发来的消息，写入自己的LocalStorage。</p>
<p>父窗口发送消息的代码如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> win = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'iframe'</span>)[<span class="number">0</span>].contentWindow;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">'Jack'</span> &#125;;</span><br><span class="line">win.postMessage(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">key</span>: <span class="string">'storage'</span>, <span class="attr">data</span>: obj&#125;), <span class="string">'http://bbb.com'</span>)</span><br></pre></td></tr></table></figure>

<p>加强版的子窗口接收消息的代码如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.origin !== <span class="string">'http://bbb.com'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">var</span> payload = <span class="built_in">JSON</span>.parse(e.data);</span><br><span class="line">  <span class="keyword">switch</span> (payload.method) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'set'</span>:</span><br><span class="line">      localStorage.setItem(payload.key, <span class="built_in">JSON</span>.stringify(payload.data));</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'get'</span>:</span><br><span class="line">      <span class="keyword">var</span> parent = <span class="built_in">window</span>.parent;</span><br><span class="line">      <span class="keyword">var</span> data = localStorage.getItem(payload.key);</span><br><span class="line">      parent.postMessage(data, <span class="string">'http://aaa.com'</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'remove'</span>:</span><br><span class="line">      localStorage.removeItem(payload.key);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>加强版的父窗口发送消息代码如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> win = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'iframe'</span>)[<span class="number">0</span>].contentWindow;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">'Jack'</span> &#125;;</span><br><span class="line"><span class="comment">// 存入对象</span></span><br><span class="line">win.postMessage(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">key</span>: <span class="string">'storage'</span>, <span class="attr">method</span>: <span class="string">'set'</span>, <span class="attr">data</span>: obj&#125;), <span class="string">'http://bbb.com'</span>);</span><br><span class="line"><span class="comment">// 读取对象</span></span><br><span class="line">win.postMessage(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">key</span>: <span class="string">'storage'</span>, <span class="attr">method</span>: <span class="string">"get"</span>&#125;), <span class="string">"*"</span>);</span><br><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (e.origin != <span class="string">'http://aaa.com'</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// "Jack"</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(e.data).name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>本文摘抄自 <a href="http://javascript.ruanyifeng.com/bom/same-origin.html" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/bom/same-origin.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/09/window-postmessage/" data-id="ckb7ljdxp002alis6dgbqgbmw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/h5API/" rel="tag">h5API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/message/" rel="tag">message</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/postmessage/" rel="tag">postmessage</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/web%E9%80%9A%E4%BF%A1/" rel="tag">web通信</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-jsonp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/11/09/jsonp/" class="article-date">
  <time datetime="2016-11-09T09:46:40.000Z" itemprop="datePublished">2016-11-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/11/09/jsonp/">jsonp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="jsonp介绍"><a href="#jsonp介绍" class="headerlink" title="jsonp介绍"></a>jsonp介绍</h1><p>JSONP是服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。<br>它的基本思想是，网页通过添加一个&lt;script&gt;元素，向服务器请求JSON数据，这种做法不受同源政策限制。<br>服务器收到请求后，将数据放在一个指定名字的回调函数里传回来。</p>
<p>首先，网页动态插入&lt;script&gt;元素，由它向跨源网址发出请求。</p>
<p>客户端代码（浏览器发送的请求）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createScriptTag</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">  script.setAttribute(<span class="string">"type"</span>,<span class="string">"text/javascript"</span>);</span><br><span class="line">  script.src = src;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  createScriptTag(<span class="string">'http://example.com?callback=foo'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'return server data: '</span> + data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面代码通过动态添加&lt;script&gt;元素，向服务器example.com发出请求。<br>注意，该请求的查询字符串有一个callback参数，用来指定回调函数的名字，这对于JSONP是必需的</p>
<p>服务器返回的代码如下<br>java：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">boolean jsonP = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">String</span> cb = request.getParameter(<span class="string">"callback"</span>);</span><br><span class="line"><span class="keyword">if</span> (cb != <span class="literal">null</span>) &#123;</span><br><span class="line">    jsonP = <span class="literal">true</span>;</span><br><span class="line">    response.setContentType(<span class="string">"text/javascript"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.setContentType(<span class="string">"application/x-json"</span>);</span><br><span class="line">&#125;</span><br><span class="line">Writer out = response.getWriter();</span><br><span class="line"><span class="keyword">if</span> (jsonP) &#123;</span><br><span class="line">    out.write(cb + <span class="string">"("</span>);</span><br><span class="line">&#125;</span><br><span class="line">out.print(dataBlock.toJsonString());</span><br><span class="line"><span class="keyword">if</span> (jsonP) &#123;</span><br><span class="line">    out.write(<span class="string">");"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$callback = $_REQUEST[<span class="string">'callback'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the output object.</span></span><br><span class="line">$output = array(<span class="string">'a'</span> =&gt; <span class="string">'Apple'</span>, <span class="string">'b'</span> =&gt; <span class="string">'Banana'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//start output</span></span><br><span class="line"><span class="keyword">if</span> ($callback) &#123;</span><br><span class="line">    header(<span class="string">'Content-Type: text/javascript'</span>);</span><br><span class="line">    echo $callback . <span class="string">'('</span> . json_encode($output) . <span class="string">');'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">'Content-Type: application/x-json'</span>);</span><br><span class="line">    echo json_encode($output);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>asp.net:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String jsonString &#x3D; &quot;&#123;success: true&#125;&quot;;</span><br><span class="line">String cb &#x3D; Request.Params.Get(&quot;callback&quot;);</span><br><span class="line">String responseString &#x3D; &quot;&quot;;</span><br><span class="line">if (!String.IsNullOrEmpty(cb)) &#123;</span><br><span class="line">    responseString &#x3D; cb + &quot;(&quot; + jsonString + &quot;)&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    responseString &#x3D; jsonString;</span><br><span class="line">&#125;</span><br><span class="line">Response.Write(responseString);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/11/09/jsonp/" data-id="ckb7ljdxd001klis62mu81l37" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/ajax/" rel="tag">ajax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/cros/" rel="tag">cros</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-typescript-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/10/14/typescript-note/" class="article-date">
  <time datetime="2016-10-14T06:45:21.000Z" itemprop="datePublished">2016-10-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/10/14/typescript-note/">typescript_note</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>typescript 入门</p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="tsc-命令行编译器"><a href="#tsc-命令行编译器" class="headerlink" title="tsc 命令行编译器"></a>tsc 命令行编译器</h3><ul>
<li><p>windows上的两个版本</p>
<p>一个是官方网站上下载的.msi安装包，一个是通过npm install -g typescript安装的版本。</p>
</li>
<li><p>多文件编译及合并</p>
<p>ts文件之间可以声明静态依赖关系，只要在文件头部给出引用的文件：<br>///<reference path='../core/UndoManager.ts'/><br>tsc可以自动寻找和编译依赖的文件，所以编译时可以只传入一个“根”ts文件，只要从这个文件出发能找到所有需要的文件。<br>要小心的是，如果这个引用声明中有任何语法错误，例如引号未闭合、少了结尾的’/‘等，编译器会悄悄的忽略这一行，从而产生难以理解的编译错误（也许是个bug）。<br>如果文件找不到，则编译器能给出正确的提示。<br>虽然一些js文件可以不加修改地作为ts文件编译，但是如果扩展名不改为.ts，则编译器会报错（也许是个bug）。</p>
</li>
<li><p>监视文件修改（参考[21]）</p>
<p>-watch 或 -w <file></p>
<p>注意只有npm版本支持此选项。如果windows安装了两个版本，则要从path环境变量中把msi版本的tsc排除掉。</p>
<p>当使用此选项时，tsc将不会退出。所以它只应该在调试的时候使用。</p>
<p>另一个办法是利用grunt的监视功能。参考”用grunt编译“。</p>
</li>
<li><p>sourcemap</p>
<p>–sourcemap选项<br>生成ts和js代码之间的映射关系，这样调试器、console.*、异常就能够定位到ts文件了。<br>参考：<a href="http://net.tutsplus.com/tutorials/tools-and-tips/source-maps-101/" target="_blank" rel="noopener">http://net.tutsplus.com/tutorials/tools-and-tips/source-maps-101/</a></p>
<p>chrome 的 dev tool 要打开 “enable source map” 选项。 Firefox 的 dev tool 要打开 “show original source” 选项。</p>
</li>
<li><p>declaration</p>
<p>–declaration 用于生成相应的环境声明文件。</p>
</li>
</ul>
<h3 id="tsc-工程文件-tsconfig-json-22"><a href="#tsc-工程文件-tsconfig-json-22" class="headerlink" title="tsc 工程文件 - tsconfig.json [22]"></a>tsc 工程文件 - tsconfig.json [22]</h3><p>例子[22]：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">        &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class="line">        &quot;noImplicitAny&quot;: true,</span><br><span class="line">        &quot;removeComments&quot;: true,</span><br><span class="line">        &quot;preserveConstEnums&quot;: true,</span><br><span class="line">        &quot;out&quot;: &quot;..&#x2F;..&#x2F;built&#x2F;local&#x2F;tsc.js&quot;,</span><br><span class="line">        &quot;sourceMap&quot;: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;files&quot;: [</span><br><span class="line">        &quot;core.ts&quot;,</span><br><span class="line">        &quot;sys.ts&quot;,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用grunt编译"><a href="#用grunt编译" class="headerlink" title="用grunt编译"></a>用grunt编译</h3><ul>
<li><p>grunt</p>
<p>npm install -g grunt-cli</p>
</li>
<li><p>package</p>
<p>在工程根目录下创建 package.json：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;projectName&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.1.0&quot;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;grunt&quot;: &quot;~0.4.1&quot;,</span><br><span class="line">    &quot;grunt-exec&quot;: &quot;~0.4.0&quot;,</span><br><span class="line">    &quot;grunt-contrib-watch&quot;: &quot;~0.3.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>grunt-exec 用于执行系统命令，我们用它来执行tsc。<br>尽管有一些grunt插件专门用于编译ts（grunt-typescript和grunt-type），但似乎并没有特别的优势，你也可以尝试。</p>
</li>
<li><p>Gruntfile.js<br>module.exports = function(grunt) {<br>grunt.loadNpmTasks(‘grunt-exec’);<br>grunt.loadNpmTasks(‘grunt-contrib-watch’);<br>grunt.initConfig({<br>exec: {<br>  ts: {</p>
<pre><code>command: &apos;tsc --sourcemap --target ES5 --out src/jsgen/main.ts.js src/main/main.ts&apos;,
stdout: true,
stderr: true</code></pre><p>  }<br>},<br>watch: {<br>  files: ‘src/<em>*/</em>.ts’,<br>  tasks: [‘exec:ts’]<br>},<br>});<br>}</p>
</li>
</ul>
<p>只编译的话，执行<br>grunt exec<br>要监视文件修改，自动编译的话，执行<br>grunt watch</p>
<p>参考：<br>  <a href="http://stackoverflow.com/questions/12725544/how-to-use-the-typescript-compiler-in-the-watch-output-files-mode-tsc-w-on" target="_blank" rel="noopener">http://stackoverflow.com/questions/12725544/how-to-use-the-typescript-compiler-in-the-watch-output-files-mode-tsc-w-on</a></p>
<h3 id="atom-typescript-23"><a href="#atom-typescript-23" class="headerlink" title="atom typescript [23]"></a>atom typescript [23]</h3><p>这是 atom 编辑器的一个扩展，可以支持 TS 的自动完成、跳转、重构等。以下简称ATS。</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>apm install atom-typescript</p>
<p>其它推荐的扩展（<a href="https://atom.io/packages/）：" target="_blank" rel="noopener">https://atom.io/packages/）：</a><br>line-ending-converter<br>linter-htmlhint<br>atom-beautify<br>jsdoc: Control-Shift-d to add comment templates<br>save-session</p>
<h4 id="命令-快捷键"><a href="#命令-快捷键" class="headerlink" title="命令/快捷键"></a>命令/快捷键</h4><p>跳转到声明：f12<br>查找引用：shift+f12<br>重命名符号：f2<br>格式化代码：ctrl+alt+l。如果有选中，则只格式化选中部分。<br>Symbols View: ctrl+r<br>引用文件：输入 “ref” + tab</p>
<h4 id="工程配置"><a href="#工程配置" class="headerlink" title="工程配置"></a>工程配置</h4><p>使用 tsconfig.json，ats 相关的选项有（部分）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;compileOnSave&quot;: false,</span><br><span class="line">    &quot;formatCodeOptions&quot;: &#123;</span><br><span class="line">        &quot;indentSize&quot;: 2,</span><br><span class="line">        &quot;tabSize&quot;: 3,</span><br><span class="line">        &quot;newLineCharacter&quot;: &quot;\r\n&quot;,</span><br><span class="line">        &quot;convertTabsToSpaces&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="VS-2012"><a href="#VS-2012" class="headerlink" title="VS 2012"></a>VS 2012</h3><p>目前（0.8.3）仅当作代码编辑器就好，编译和调试还不好用。<br>使用命令行编译，用浏览器调试。</p>
<ul>
<li>设置编译目标为ES5<br>如果代码里使用了ES5特性，则应该这样做，否则编辑器会提示语法错误。<br>现在(0.8.3)不能在GUI中设置，要修改vs工程文件，将<br><TypeScriptTarget>ES3</TypeScriptTarget><br>都改为<br><TypeScriptTarget>ES5</TypeScriptTarget></li>
</ul>
<h3 id="sublime-text2-sublime-typescript-插件"><a href="#sublime-text2-sublime-typescript-插件" class="headerlink" title="sublime text2 + sublime-typescript 插件"></a>sublime text2 + sublime-typescript 插件</h3><p>插件主页：<br>  <a href="https://github.com/raph-amiard/sublime-typescript" target="_blank" rel="noopener">https://github.com/raph-amiard/sublime-typescript</a><br>在sublime的插件目录（linux下是 ~/.config/sublime-text-2/Packages）中运行<br>  git clone <a href="https://github.com/raph-amiard/sublime-typescript" target="_blank" rel="noopener">https://github.com/raph-amiard/sublime-typescript</a><br>然后重启sublime。<br>如果状态栏上一直显示“Loading typescript plugin”，而 ~/.config/sublime-text-2/Packages/sublime-typescript/lib/typescript/ts.zip<br>的大小一直很小（下载完后应是4MB左右），这说明下载ts源码出问题了。打开<br>~/.config/sublime-text-2/Packages/sublime-typescript/core/install.py<br>找到形如 TYPESCRIPT_SOURCE_LINK = …<br>的行，将后面的url下载下来，应该是个zip，解压到<br>~/.config/sublime-text-2/Packages/sublime-typescript/lib/typescript/<br>下面，应该有<br>~/.config/sublime-text-2/Packages/sublime-typescript/lib/typescript/bin<br>等目录。<br>然后重启sublime。打开控制台（view菜单），这时应该没有错误了。</p>
<h3 id="浏览器中调试"><a href="#浏览器中调试" class="headerlink" title="浏览器中调试"></a>浏览器中调试</h3><p>编译时tsc需要使用–sourcemap选项，这样会生成.map文件。<br>用chrome调试ts代码需要保证开发工具设置中“enable source map”选项选中了（默认未选中）。<br>参考：<a href="http://stackoverflow.com/questions/13569192/typescript-source-map-files-dont-work-with-chrome" target="_blank" rel="noopener">http://stackoverflow.com/questions/13569192/typescript-source-map-files-dont-work-with-chrome</a><br>  <a href="http://www.aaron-powell.com/web/typescript-source-maps" target="_blank" rel="noopener">http://www.aaron-powell.com/web/typescript-source-maps</a></p>
<p>firefox(22)和IE(10)目前尚未支持 sourcemap，所以只能调试生成的js文件。<br>  firefox的进度：<a href="https://wiki.mozilla.org/DevTools/Features/SourceMap" target="_blank" rel="noopener">https://wiki.mozilla.org/DevTools/Features/SourceMap</a></p>
<h3 id="浏览器中即时编译"><a href="#浏览器中即时编译" class="headerlink" title="浏览器中即时编译"></a>浏览器中即时编译</h3><p>  TypeScript Compile automatically transforms your TypeScript code into JavaScript on the fly<br>  <a href="https://github.com/niutech/typescript-compile" target="_blank" rel="noopener">https://github.com/niutech/typescript-compile</a></p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>  TypeScript Language Specification.pdf<br>  Known breaking changes between 0.8 and 0.9 | <a href="https://typescript.codeplex.com/wikipage?title=Known%20breaking%20changes%20between%200.8%20and%200.9" target="_blank" rel="noopener">https://typescript.codeplex.com/wikipage?title=Known%20breaking%20changes%20between%200.8%20and%200.9</a></p>
<h3 id="类型指定和简单类型"><a href="#类型指定和简单类型" class="headerlink" title="类型指定和简单类型"></a>类型指定和简单类型</h3><p>对于一般变量、函数参数、对象属性，可在变量名后面加冒号（:）并跟上类型表达式；<br>对于一般函数、类和接口的方法的返回值，则是在参数表之后加上 ‘：’ 并跟上类型表达式。</p>
<p>例如：<br>  var a:number = 2;<br>  function vote(candidate: string)：string { … }<br>  var reports: string[] = [];</p>
<p>类型表达式有内置的、自定义的、推导的。内置类型包括 any, number, string，bool（这是0.8的，0.9改为boolean）, void这几个也是保留字。<br>其中any的含义是“任何类型”，void仅用于函数返回类型。<br>自定义类型包括：函数类型、对象类型（也就是接口类型）等，后面逐一描述。<br>一般对象的类型是Object，一般函数的类型是Function，这两个都是接口。<br>推导类型主要是数组类型，语法是 typename[]，与java类似。</p>
<p>另一种指定类型的方式是让编译器通过初始化表达式进行类型推断，例如<br>  var i=0; //i具有类型number<br>  var a=null; //var a:any<br>  var b=undefined; //var a:any<br>  var c={x:0, y:null}; //var c:{x:number; y:any;}<br>  function squr(i:number) { return i*i; } // 返回类型可省略，因为从return语句的类型可以推断出来</p>
<p>如果变量没有被指定类型，则其类型视为any。除了any类型，对其它类型的使用在编译时都要受到类型检查，这与强类型语言类似。</p>
<p>null和undefined虽然也是类型，但不能用于类型指定，只能作为字面量使用。<br>值null兼容于任何类型，除了void和undefined类型，也就是说这是合法的：<br>  var b:bool = null;<br>值undefined兼容于任何类型，包括void。</p>
<h3 id="环境声明-（Ambient-declare）"><a href="#环境声明-（Ambient-declare）" class="headerlink" title="环境声明 （Ambient declare）"></a>环境声明 （Ambient declare）</h3><p>使用 declare 关键字：<br>  declare var document; //浏览器document对象<br>  declare var $; //jqurey对象<br>环境声明可用于声明不是由ts实现的结构，例如js类库、浏览器内置对象等。<br>由于使用未声明变量在ts中是编译错误，所以这是必要的。</p>
<ul>
<li><p>接口的环境声明<br>与一般的接口声明没有区别。declare修饰符是可选的。<br>但是只声明接口，客户代码无法使用new操作符。</p>
</li>
<li><p>类的环境声明<br>如果希望使用 new SomeClass(…)，而SomeClass是js实现的，那么需要用类的环境声明，接口是不够的，例如：</p>
</li>
</ul>
<p>module m{<br>declare export class {<br>  field1:type1;<br>  constructor(…);<br>  func();<br>}<br>}</p>
<p>也就是说，方法体用”;”代替，属性不要初始化。declare是可选的。如果类不在模块中，模块声明和export是不需要的（如果有，则是语法错误）。</p>
<ul>
<li><p>常用js库的环境声明文件<br><a href="https://github.com/borisyankov/DefinitelyTyped" target="_blank" rel="noopener">https://github.com/borisyankov/DefinitelyTyped</a><br><a href="https://github.com/Diullei/tsd" target="_blank" rel="noopener">https://github.com/Diullei/tsd</a></p>
<p>安装tsd：<br>npm install -g tsd<br>进入希望放置d.ts文件的目录，安装想要的库：<br>tsd install qunit</p>
</li>
</ul>
<h3 id="函数类型表达式"><a href="#函数类型表达式" class="headerlink" title="函数类型表达式"></a>函数类型表达式</h3><ul>
<li><p>一般语法<br>函数类型表达式的一般形式是：<br>(param:paremType,param2:paremType2…) =&gt; returnType<br>TODO：返回类型可以省略吗？<br>例如：</p>
<p>function vote(candidate: string, callback: (result: string) =&gt; any) {<br>// …<br>}</p>
</li>
</ul>
<p>参数callback的类型就是一个函数类型 (result: string) =&gt; any</p>
<ul>
<li>注意<br>与函数相关的语法结构有3种：<br>（1）函数类型表达式。就是上面讲的。<br>（2）函数声明。给出函数签名，但没有函数体。<br>（3）函数定义。给出函数签名和函数体。<br>函数类型和函数声明、函数实现的语法上的区别，主要在于返回类型的声明上，前者用箭头，后者用冒号。<br>为什么有这样的区别？因为类型指定表达式中已经有了冒号，所以函数类型表达式要避免在同一层次上使用冒号。<br>在对象类型/接口（详见对象类型/接口）中，可以看到这样的函数声明：<br>funcName(param:paremType,param2:paremType2…):returnType</li>
</ul>
<h3 id="对象类型表达式（匿名接口）"><a href="#对象类型表达式（匿名接口）" class="headerlink" title="对象类型表达式（匿名接口）"></a>对象类型表达式（匿名接口）</h3><p>一般形式是：<br>  {<br>    fieldName:fieldType;<br>    fieldName2:fieldType2;<br>    method1(paramName:paramType…):returnType;<br>    method2：(paramName:paramType…)=&gt;returnType;<br>    …<br>  }</p>
<p>注意字段之间是分号分割的，而不是像对象字面量的属性那样用逗号分隔，这是两者的关键区别。<br>对象类型中的字段可以被声明为可选的，只需在fieldName后加上问号。<br>如果字段的类型是函数（称为方法），则采用“字段名、参数表、冒号、返回类型”的形式，如同method1那样;<br>或者采用“字段名、冒号、函数类型表达式”的形式，如method2；这两种形式是等效的。<br>注意，方法前不要加function关键字。<br>对象类型中的字段可以被声明为可选的，只需在fieldName后加上问号。</p>
<p>例子：<br>  var MakePoint: () =&gt; {<br>    x: number; y: number;<br>  };<br>意思是，变量MakePoint的类型是个函数，该返回值的类型是个对象，该对象有x、y两个number类型的字段。</p>
<p>如果对象本身还是个函数，则可以声明一个匿名函数字段，也就是<br>{<br>  (param:paremType,…):returnType;<br>  …<br>}<br>如果对象类型只有匿名函数字段，则等效于一个函数类型声明。</p>
<p>ts允许对象类型加入多个同名函数字段，只要它们有不同的参数表，也就是说支持函数重载。</p>
<p>如果一个对象提供了比一个对象类型更多的字段，并不会被认为类型不符合。</p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>如果给对象类型命名以便复用，就是接口，语法如下：<br>  interface IterfaceName {fieldName:fieldType; fieldName2:fieldType2;… }<br>interface也是关键字。<br>然后可以将IterfaceName用作类型表达式。</p>
<ul>
<li>例子<br>例1：<br>interface Friend {<br>  name: string;<br>  favoriteColor?: string;<br>}<br>function add(friend: Friend) {<br>  var name = friend.name;<br>}<br>add({ name: “Fred” }); // Ok<br>add({ favoriteColor: “blue” }); // Error, name required<br>add({ name: “Jill”, favoriteColor: “green” }); // Ok</li>
</ul>
<p>例2：<br>  interface JQuery {<br>    text(content: string);<br>  }<br>  interface JQueryStatic {<br>    get(url: string, callback: (data: string) =&gt; any);<br>    (query: string): JQuery;<br>    (ready: () =&gt; any): any;<br>  }<br>  declare var $: JQueryStatic;<br>  $.get(“<a href="http://mysite.org/divContent&quot;" target="_blank" rel="noopener">http://mysite.org/divContent&quot;</a>,<br>    function (data: string) {<br>      $(“div”).text(data);<br>    }<br>  );</p>
<h3 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h3><ul>
<li><p>返回类型推断<br>function mul(a: number, b: number) {<br>  return a * b;<br>}<br>ts推断mul的返回类型是number。</p>
</li>
<li><p>实参的形参类型推断<br>如果$.get被声明为类型：<br>(url:string, (data:string)=&gt;any)=&gt;any<br>则<br>$.get(“<a href="http://mysite.org/divContent&quot;" target="_blank" rel="noopener">http://mysite.org/divContent&quot;</a>,<br>function (data) {<br>  $(“div”).text(data); // TypeScript infers data is a string<br>}<br>);</p>
</li>
<li><p>Contextually Typed Expressions<br>根据被赋值的变量的类型推断赋值表达式中的类型。<br>var f: (s: string) =&gt; string;<br>f = function(s) { return s.toLowerCase(); } //s inferred as string</p>
</li>
</ul>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><ul>
<li>语法<br>class ClassName {<br>modifer filed1 = value1;<br>constructor(param:type) {…}<br>modifer method1(param:type):returnType { … }<br>}<br>其中 class 是关键字。</li>
</ul>
<p>字段可以给出初始值，类型可以从初始值推断。与接口一样，字段定义以分号结尾。</p>
<p>修饰符modifer是public或private，省略时默认为public。但这只在编译时检查。</p>
<p>constructor 也是关键字，表示构造器。如果没有声明构造器，则会有一个无参数构造器。</p>
<p>方法定义与接口类似，但因为有了函数体，不再需要分号结尾。</p>
<p>注意，方法和构造器前不要加function关键字。</p>
<p>在方法内部，访问字段或其它方法仍然需要用this关键字，这与js相同。</p>
<p>上述代码翻译为js时，会创建一个名为ClassName的伪类，方法都会定义于ClassName.prototype上。</p>
<p>修饰符modifer还可以是static，这时字段成为（伪）类本身的属性，要通过ClassName.filed访问。</p>
<p>类中的方法也支持重载，但是各个重载版本必须共用一个函数体，详见“重载”。</p>
<ul>
<li><p>在构造器中定义字段<br>这是一种方便语法。在构造器形式参数前加上访问修饰符，则会在类中定义同名字段，<br>并自动将该参数赋值给该字段，例如：<br>constructor(public param:type) {…}</p>
</li>
<li><p>类类型<br>如果变量的类型是一个（伪）类或者是构造函数，则可用如下类型表达式：<br>new(param:type…) =&gt; ClassOrInterfaceName<br>new关键字表明，这是个需要通过new语法调用的函数，并返回某个类或接口的对象。</p>
</li>
</ul>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>语法与java类似，采用extends关键字：</p>
<p>  class CheckingAccount extends BankAccount {<br>    constructor(balance: number) {<br>      super(balance);<br>    }<br>    writeCheck(debit: number) {<br>      this.balance -= debit;<br>    }<br>  }</p>
<p>调用父类构造器的方法是super(…)。TODO:如果没有显式调用，编译器是否会自动调用super()？<br>调用父类属性的方法是super.identifier。<br>在编译器生成的js代码中，子（伪）类的prototype会链接（chain）到父（伪）类的prototype上。</p>
<ul>
<li><p>实现接口<br>类也可以用implements关键字指明它实现了哪些接口，与Java的语法相同。<br>不过，类不必显式的声明它实现了什么接口，在需要该接口的场合，直接使用该类的实例也是正确的。</p>
</li>
<li><p>接口之间的继承<br>接口可以继承接口，用extends关键字，与Java相同。</p>
</li>
</ul>
<h3 id="强制类型转换（type-assertion）"><a href="#强制类型转换（type-assertion）" class="headerlink" title="强制类型转换（type assertion）"></a>强制类型转换（type assertion）</h3><p>语法：<br><type> expression<br>也就是将Java/C#中的圆括号改为尖括号。</p>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>对应js的模块模式。</p>
<ul>
<li>内部模块</li>
</ul>
<p>语法：<br>module M { //模块名M<br>  var var1 = value1; //模块私有变量<br>  function func1(…) {…}; //模块私有函数<br>  class C1 {…} //模块私有类<br>  export var var2 = value2; //导出变量<br>  export function func2(…) {…}; //导出函数<br>  export class C1 {…} //导出类<br>}</p>
<p>这样创建了一个名为M的模块对象（如果是在全局作用域，则M是个全局对象）<br>导出的结构都可以用M.name访问。</p>
<p>导出类型可以访问非导出类型，但是不能出现在导出的API中，例如public成员不能是非导出类型。<br>不过当前的tsc（0.8.3）似乎也不接受类的private成员有非导出类型，尽管局部变量使用非导出类型是没问题的。</p>
<p>module 和 export 都是关键字。</p>
<p>如果不在模块内部而使用了export关键字，编译器会报错“Cannot compile dynamic modules when emitting into single file”，这可能是个bug。</p>
<p>例子：<br>module M {<br>var s = “hello”;<br>export function f() {<br>return s;<br>}<br>}<br>M.f();<br>M.s; // Error, s is not exported</p>
<p>生成的js代码是：</p>
<p>var M;<br>(function(M) {<br>var s = “hello”;<br>function f() {<br>return s;<br>}<br>M.f = f;<br>})(M||(M={}));</p>
<ul>
<li>外部模块<br>这是为了产生用于CMD、AMD等系统的模块。<br>语法上，没有module M {} 构造，但是有顶层的 export 和 import 指令。</li>
</ul>
<h3 id="箭头函数表达式（arrow-function-expressions）"><a href="#箭头函数表达式（arrow-function-expressions）" class="headerlink" title="箭头函数表达式（arrow function expressions）"></a>箭头函数表达式（arrow function expressions）</h3><p>这也是计划中的ES6特性。<br>(param,…) =&gt; {…}<br>或者<br>param =&gt; {…}</p>
<p>括号和函数体中的return关键字有时是可选的。</p>
<p>例子：<br>(x) =&gt; { return Math.sin(x); }<br>(x) =&gt; Math.sin(x)<br>x =&gt; { return Math.sin(x); }<br>x =&gt; Math.sin(x)</p>
<p>以上都是等效的。</p>
<p>箭头函数表达式并不仅仅是传统函数表达式的简化写法。语义上的区别是，前者重用了上下文的this值，而后者的this值可以是其它值。</p>
<h2 id="高级语法"><a href="#高级语法" class="headerlink" title="高级语法"></a>高级语法</h2><h3 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h3><p>  TypeScript Language Specification.pdf</p>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul>
<li><p>全局模块<br>ts总是有一个全局模块，对应于js的全局作用域。</p>
</li>
<li><p>成员和类型<br>ts把语法构造分为两类：成员（members）和类型（types）。<br>成员包括：变量、函数、模块、构造器（即伪类）；<br>类型包括：模块、类、接口。</p>
</li>
</ul>
<p>可见，成员都是js原有的东西，类型则是ts新增的概念。<br>其中模块、类同时对成员和类型有贡献。</p>
<ul>
<li>声明空间<br>声明空间分为成员声明空间和类型声明空间两种，互相不会冲突。也就是说，可以同时声明同名的成员和类型。例如这是合法的：<br>module M<br>{<br>interface X { }<br>var X;<br>}<br>但如果X是个类，则出现语法错误，因为class同时对成员和类型有贡献。</li>
</ul>
<p>模块同时有成员声明空间和类型声明空间；其它大多数构造只有成员声明空间。</p>
<ul>
<li><p>模块和接口的合并<br>对于内部模块，同一模块可以被定义多次，可以分散到多个文件中，只要全名相同，则这些模块定义被合并。<br>接口也是这样。<br>多个同名内部模块内的局部成员的名字是不会冲突的，但导出的名字可能会冲突。</p>
</li>
<li><p>静态成员和非静态成员在不同的声明空间中<br>这是合法的：<br>class C<br>{<br>x: number;<br>static x: string;<br>}</p>
</li>
<li><p>嵌套的模块<br>模块可以嵌套。<br>内层模块中的名字会隐藏外部模块中相同的名字。</p>
</li>
</ul>
<h3 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h3><p>类、接口、模块、匿名对象类型都产生了对象类型。</p>
<p>仅有类的成员可以声明为私有的，其它都是公有的。</p>
<p>内部成员完全相同的两个类也是不兼容的。不过这只在编译时检查。</p>
<p>模块不能被声明为实现了某个接口。不过仍有可能对模块进行编译时类型检查，参考：<br>  <a href="http://stackoverflow.com/questions/16072471/why-cant-typescript-modules-implement-or-adhere-to-an-interface-can-i-get-arou" target="_blank" rel="noopener">http://stackoverflow.com/questions/16072471/why-cant-typescript-modules-implement-or-adhere-to-an-interface-can-i-get-arou</a></p>
<ul>
<li>ts的内置接口<br>ts的内置接口包括 Object、Function、Number、String、Bool 接口 – 不要和同名的js伪类混淆。<br>所有的对象都被认为实现了 Object 接口；函数和构造器被认为实现了 Function 接口；<br>基本类型number、string、bool被认为实现了Number、String、Bool 接口。</li>
</ul>
<h3 id="函数的进一步讨论"><a href="#函数的进一步讨论" class="headerlink" title="函数的进一步讨论"></a>函数的进一步讨论</h3><ul>
<li>重载<br>实现重载函数的例子是：</li>
</ul>
<p>function attr(name: string): string;<br>function attr(name: string, value: string): Accessor;<br>function attr(map: any): Accessor;<br>function attr(nameOrMap: any, value: string): any {<br>  if (nameOrMap &amp;&amp; typeof nameOrMap === “object”) {<br>  // handle map case<br>  }<br>  else {<br>  // handle string case<br>  }<br>}</p>
<p>也就是在函数体前声明多个函数签名，用分号隔开，最后跟上实际的函数实现。<br>不过，因为只能共用一个函数体，所以必须检查参数的实际类型。</p>
<p>以上实现的attr函数具有以下类型：<br>{<br>  (name: string): string;<br>  (name: string, value: string): Accessor;<br>  (map: any): Accessor;<br>}</p>
<ul>
<li><p>可选参数和默认值<br>ES5函数支持可选参数和默认值，ts中一样可以用；还可以在参数后加上问号表示可选参数。<br>例如：<br>redo(step?=1) { }<br>或者<br>redo(step=1) { }<br>以上是等效的。也可以只给出可选参数但不给出默认值：<br>redo(step?) { }</p>
</li>
<li><p>变长参数表（Rest Parameters）<br>参考：<br><a href="http://stackoverflow.com/questions/12739149/typescript-type-signatures-for-functions-with-variable-argument-counts" target="_blank" rel="noopener">http://stackoverflow.com/questions/12739149/typescript-type-signatures-for-functions-with-variable-argument-counts</a></p>
</li>
</ul>
<p>语法：<br>function func(…args: type[]) {<br>  …<br>}</p>
<p>例如 （<a href="http://stackoverflow.com/questions/12697275/open-ended-function-arguments-with-typescript）：" target="_blank" rel="noopener">http://stackoverflow.com/questions/12697275/open-ended-function-arguments-with-typescript）：</a><br>function sum(…numbers: number[]) {<br>    var aggregateNumber = 0;<br>    for (var i = 0; i &lt; numbers.length; i++)<br>        aggregateNumber += numbers[i];<br>    return aggregateNumber;<br>}</p>
<p>This will then type check correctly with</p>
<p>console.log(sum(1, 5, 10, 15, 20));</p>
<ul>
<li>变长参数表函数的重载<br>通常希望变长参数表也能接受数组作为参数，这就需要一个重载的版本。但是以下做法是语法错误：<br>  addProperties(…propNames: string[]);<br>  addProperties(propNames: string[]) {<br>  //…<br>  ｝<br>两个参数表交换位置、propNames: string[] 改为 propNames: any[]也都是语法错误。<br>只有这样是允许的：<br>  addProperties(…propNames: string[]);<br>  addProperties(propNames) {<br>  //…<br>  ｝<br>但是能否正常工作则不清楚。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a href="http://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript 官方网站</a></p>
<p>[2] <a href="http://www.typescriptlang.org/Content/TypeScript%20Language%20Specification.pdf" target="_blank" rel="noopener">TypeScript 语言规范（英）</a></p>
<p>[3] <a href="http://www.typescriptlang.org/Handbook" target="_blank" rel="noopener">TypeScript 手册（英）</a></p>
<p>[4] <a href="https://github.com/Microsoft/TypeScript" target="_blank" rel="noopener">TypeScript 源码库（github）</a></p>
<p>[5] <a href="http://www.codebelt.com/category/typescript/" target="_blank" rel="noopener">TypeScript - codeBelt（一些 typescript 教程（英））</a></p>
<p>[6] <a href="http://blog.csdn.net/he_8134/article/details/10954049" target="_blank" rel="noopener">TypeScript —— Web前端开发的救赎</a></p>
<p>[7] <a href="http://www.csdn.net/article/2012-10-11/2810645-Thoughts-on-TypeScript" target="_blank" rel="noopener">JavaScript 大师 Nicholas C. Zakas 谈 TypeScript</a></p>
<p>[21] <a href="http://stackoverflow.com/questions/12725544/how-to-use-the-typescript-compiler-in-the-watch-output-files-mode-tsc-w-on" target="_blank" rel="noopener">how to use the typescript compiler in the watch output files</a></p>
<p>[22] <a href="https://github.com/Microsoft/TypeScript/wiki/tsconfig.json" target="_blank" rel="noopener">tsconfig.json</a></p>
<p>[23] <a href="https://github.com/TypeStrong/atom-typescript" target="_blank" rel="noopener">atom-typescript</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://huangxok.github.io/blog/2016/10/14/typescript-note/" data-id="ckb7ljdxm0023lis68pn5g7hi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/blog/">&amp;laquo; Prev</a><a class="page-number" href="/blog/">1</a><span class="page-number current">2</span><a class="page-number" href="/blog/page/3/">3</a><a class="page-number" href="/blog/page/4/">4</a><a class="extend next" rel="next" href="/blog/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Epub/">Epub</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Epub/Kindle/">Kindle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E7%AE%97%E6%B3%95/">算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/">排序</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Board/" rel="tag">Board</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Epub/" rel="tag">Epub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Firefox/" rel="tag">Firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/JXGGraph/" rel="tag">JXGGraph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/NextT/" rel="tag">NextT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/OPF/" rel="tag">OPF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Theme/" rel="tag">Theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/XHTML/" rel="tag">XHTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/XUL/" rel="tag">XUL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/XULRunner/" rel="tag">XULRunner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/proto/" rel="tag">__proto__</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ajax/" rel="tag">ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/compose/" rel="tag">compose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/counter/" rel="tag">counter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/cros/" rel="tag">cros</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/curry/" rel="tag">curry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/debug/" rel="tag">debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/grunt/" rel="tag">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gruntfile/" rel="tag">gruntfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/h5API/" rel="tag">h5API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hammerJS/" rel="tag">hammerJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/jxggraph/" rel="tag">jxggraph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/link/" rel="tag">link</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/message/" rel="tag">message</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/mvvm/" rel="tag">mvvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/object/" rel="tag">object</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/pen/" rel="tag">pen</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/postmessage/" rel="tag">postmessage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/prototype/" rel="tag">prototype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/shape/" rel="tag">shape</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/touch/" rel="tag">touch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/web%E9%80%9A%E4%BF%A1/" rel="tag">web通信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%87%BD%E6%95%B0%E5%BC%8F/" rel="tag">函数式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%8E%9F%E5%9E%8B/" rel="tag">原型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E8%99%9A%E6%8B%9Fdom/" rel="tag">虚拟dom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E8%AE%A1%E6%95%B0%E5%99%A8/" rel="tag">计数器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%93%BE%E6%8E%A5/" rel="tag">链接</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Board/" style="font-size: 10px;">Board</a> <a href="/blog/tags/Epub/" style="font-size: 20px;">Epub</a> <a href="/blog/tags/Firefox/" style="font-size: 10px;">Firefox</a> <a href="/blog/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/blog/tags/JS/" style="font-size: 10px;">JS</a> <a href="/blog/tags/JXGGraph/" style="font-size: 10px;">JXGGraph</a> <a href="/blog/tags/NextT/" style="font-size: 10px;">NextT</a> <a href="/blog/tags/OPF/" style="font-size: 20px;">OPF</a> <a href="/blog/tags/Theme/" style="font-size: 10px;">Theme</a> <a href="/blog/tags/XHTML/" style="font-size: 10px;">XHTML</a> <a href="/blog/tags/XUL/" style="font-size: 10px;">XUL</a> <a href="/blog/tags/XULRunner/" style="font-size: 10px;">XULRunner</a> <a href="/blog/tags/proto/" style="font-size: 10px;">__proto__</a> <a href="/blog/tags/ajax/" style="font-size: 10px;">ajax</a> <a href="/blog/tags/compose/" style="font-size: 10px;">compose</a> <a href="/blog/tags/counter/" style="font-size: 10px;">counter</a> <a href="/blog/tags/cros/" style="font-size: 10px;">cros</a> <a href="/blog/tags/css/" style="font-size: 10px;">css</a> <a href="/blog/tags/curry/" style="font-size: 15px;">curry</a> <a href="/blog/tags/debug/" style="font-size: 10px;">debug</a> <a href="/blog/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/blog/tags/gruntfile/" style="font-size: 10px;">gruntfile</a> <a href="/blog/tags/h5API/" style="font-size: 10px;">h5API</a> <a href="/blog/tags/hammerJS/" style="font-size: 10px;">hammerJS</a> <a href="/blog/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/blog/tags/js/" style="font-size: 10px;">js</a> <a href="/blog/tags/jxggraph/" style="font-size: 10px;">jxggraph</a> <a href="/blog/tags/link/" style="font-size: 10px;">link</a> <a href="/blog/tags/message/" style="font-size: 10px;">message</a> <a href="/blog/tags/mvvm/" style="font-size: 10px;">mvvm</a> <a href="/blog/tags/node/" style="font-size: 10px;">node</a> <a href="/blog/tags/object/" style="font-size: 10px;">object</a> <a href="/blog/tags/pen/" style="font-size: 10px;">pen</a> <a href="/blog/tags/postmessage/" style="font-size: 10px;">postmessage</a> <a href="/blog/tags/prototype/" style="font-size: 15px;">prototype</a> <a href="/blog/tags/react/" style="font-size: 10px;">react</a> <a href="/blog/tags/shape/" style="font-size: 10px;">shape</a> <a href="/blog/tags/touch/" style="font-size: 10px;">touch</a> <a href="/blog/tags/web%E9%80%9A%E4%BF%A1/" style="font-size: 10px;">web通信</a> <a href="/blog/tags/%E5%87%BD%E6%95%B0%E5%BC%8F/" style="font-size: 10px;">函数式</a> <a href="/blog/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">函数式编程</a> <a href="/blog/tags/%E5%8E%9F%E5%9E%8B/" style="font-size: 10px;">原型</a> <a href="/blog/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 15px;">排序</a> <a href="/blog/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/blog/tags/%E8%99%9A%E6%8B%9Fdom/" style="font-size: 10px;">虚拟dom</a> <a href="/blog/tags/%E8%AE%A1%E6%95%B0%E5%99%A8/" style="font-size: 10px;">计数器</a> <a href="/blog/tags/%E9%93%BE%E6%8E%A5/" style="font-size: 10px;">链接</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2020/04/29/about-title-with-whitespac/">about title with whitespac</a>
          </li>
        
          <li>
            <a href="/blog/2020/04/29/about/">about</a>
          </li>
        
          <li>
            <a href="/blog/2020/04/29/OKVoice_note_api/">OKVoice_note_api</a>
          </li>
        
          <li>
            <a href="/blog/2017/06/16/Epub-analysis-md/">Epub_analysis</a>
          </li>
        
          <li>
            <a href="/blog/2017/04/01/javascript-object/">javascript_object</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 HKmaster<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">

  
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>