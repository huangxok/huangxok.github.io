<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="xulrunner-gecko-firefox, hexo,jsxgraph,xulrunner">
    <meta name="description" content="时光岁月如流水，流水奔流入海不复回">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>xulrunner-gecko-firefox | HKBlog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">HKBlog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">HKBlog</div>
        <div class="logo-desc">
            
            时光岁月如流水，流水奔流入海不复回
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">xulrunner-gecko-firefox</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/XUL/">
                                <span class="chip bg-color">XUL</span>
                            </a>
                        
                            <a href="/tags/XULRunner/">
                                <span class="chip bg-color">XULRunner</span>
                            </a>
                        
                            <a href="/tags/Firefox/">
                                <span class="chip bg-color">Firefox</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2017-01-13
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="XULRunner"><a href="#XULRunner" class="headerlink" title="XULRunner"></a>XULRunner</h2><h3 id="软件和工具"><a href="#软件和工具" class="headerlink" title="软件和工具"></a>软件和工具</h3><p>发行版下载<br>下载站点</p>
<p><a href="http://ftp.mozilla.org/pub/firefox/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/firefox/</a></p>
<p><a href="http://download.cdn.mozilla.net/pub/mozilla.org/" target="_blank" rel="noopener">http://download.cdn.mozilla.net/pub/mozilla.org/</a></p>
<p>xulrunner 在这里：</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/releases/latest/runtimes/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/releases/latest/runtimes/</a> – 稳定版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/candidates/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/candidates/</a> – beta版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-aurora/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-aurora/</a> – aurora版</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-central/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/xulrunner/nightly/latest-mozilla-central/</a> – central版</p>
<p>firefox 在这里：</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/firefox/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/firefox/</a></p>
<p>注意，xulrunner 只提供英文版，而 firefox 则有各种本地化版本，例如</p>
<p><a href="http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-mozilla-aurora-l10n/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-mozilla-aurora-l10n/</a></p>
<p>firefox sdk 只在 aurora 里面有，如<br><a href="http://ftp.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-47.0a2.en-US.win32.sdk.zip" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-47.0a2.en-US.win32.sdk.zip</a></p>
<p>可以利用后者的资源文件本地化前者，详见“本地化”。</p>
<h3 id="XULRunner-参考"><a href="#XULRunner-参考" class="headerlink" title="XULRunner 参考"></a>XULRunner 参考</h3><p>Creating Applications with Mozilla<br>  <a href="http://books.mozdev.org/html/index.html" target="_blank" rel="noopener">http://books.mozdev.org/html/index.html</a></p>
<p>XULRunner in large projects<br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-1-what-is-that-xulrunner-thingy-anyway" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-1-what-is-that-xulrunner-thingy-anyway</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-2-why-xulrunner-isn-t-like-java" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-2-why-xulrunner-isn-t-like-java</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-3-bugs-bugs-and-more-bugs" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-3-bugs-bugs-and-more-bugs</a><br>  <a href="https://adblockplus.org/blog/xulrunner-in-large-projects-part-4-localization-pitfalls" target="_blank" rel="noopener">https://adblockplus.org/blog/xulrunner-in-large-projects-part-4-localization-pitfalls</a></p>
<p>Getting_started_with_XULRunner<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Getting_started_with_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Getting_started_with_XULRunner</a><br>Structure_of_an_installable_bundle<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Structure_of_an_installable_bundle" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Structure_of_an_installable_bundle</a><br>XULRunner_tips<br>  <a href="https://developer.mozilla.org/en-US/docs/XULRunner_tips" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XULRunner_tips</a><br>JavaScript code modules<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules</a><br>Windows_and_menus<br>  <a href="https://developer.mozilla.org/zh-CN/docs/Windows_and_menus_in_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Windows_and_menus_in_XULRunner</a><br>Dialogs<br>  <a href="https://developer.mozilla.org/en-US/docs/Dialogs_in_XULRunner" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Dialogs_in_XULRunner</a><br>browser<br>  <a href="https://developer.mozilla.org/en-US/docs/XUL/browser" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/browser</a><br>Stream<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide</a><br>Using JavaScript code modules<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Using#Importing_CommonJS_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Using#Importing_CommonJS_modules</a><br>nsIDirectoryService<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Using_nsIDirectoryService" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Using_nsIDirectoryService</a></p>
<p>A Brief Introduction To XULRunner<br>  <a href="http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_1" target="_blank" rel="noopener">http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_1</a><br>  <a href="http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_2" target="_blank" rel="noopener">http://www.kodewerx.org/wiki/A_Brief_Introduction_To_XULRunner:_Part_2</a></p>
<p>Mozilla 错误代码表 error codes<br>  <a href="https://developer.mozilla.org/en-US/docs/Table_Of_Errors" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Table_Of_Errors</a><br>  <a href="http://james-ross.co.uk/mozilla/misc/nserror_list" target="_blank" rel="noopener">http://james-ross.co.uk/mozilla/misc/nserror_list</a></p>
<p>使用XPCOM:实现高级处理<br>  <a href="http://caoyue.sinaapp.com/?p=430" target="_blank" rel="noopener">http://caoyue.sinaapp.com/?p=430</a></p>
<p>样例代码<br>  <a href="https://github.com/matthewkastor/XULRunner-Examples" target="_blank" rel="noopener">https://github.com/matthewkastor/XULRunner-Examples</a></p>
<p>Mozilla研究<br>  Mozilla研究—用户界面的基本要素 <a href="http://www.cnblogs.com/faunus/archive/2009/04/12/1434213.html" target="_blank" rel="noopener">http://www.cnblogs.com/faunus/archive/2009/04/12/1434213.html</a><br>  Mozilla研究—XUL窗口创建和事件处理 <a href="http://www.cnblogs.com/faunus/archive/2009/04/12/1434214.html" target="_blank" rel="noopener">http://www.cnblogs.com/faunus/archive/2009/04/12/1434214.html</a></p>
<p>Add-ons/Extension Signing<br>  <a href="https://wiki.mozilla.org/Addons/Extension_Signing" target="_blank" rel="noopener">https://wiki.mozilla.org/Addons/Extension_Signing</a>  </p>
<p>system/child_process<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process</a></p>
<h3 id="XUL-应用结构"><a href="#XUL-应用结构" class="headerlink" title="XUL 应用结构"></a>XUL 应用结构</h3><ul>
<li>myapp/<br>|</li>
<li>-+ chrome/<br>| |<br>| +-+ content/<br>| | |<br>| | +– main.xul<br>| | |<br>| | +– main.js<br>| |<br>| +– chrome.manifest //用于向下兼容，可以没有<br>|</li>
<li>-+ defaults/<br>| |<br>| +-+ preferences/<br>|   |<br>|   +– prefs.js<br>|</li>
<li>– application.ini<br>|</li>
<li>– chrome.manifest </li>
</ul>
<p>与 extension 相比，XUL 应用只是多出了 application.ini 文件，但少了intall.rdf。<br>其它部分，如 chrome.manifest 与 extension 中的写法相同。</p>
<ul>
<li>默认执行的 xul<br>The prefs.js file tells XULRunner the name of the XUL file to use as the main window. Here is mine:</li>
</ul>
<p>pref(“toolkit.defaultChromeURI”, “chrome://myapp/content/main.xul”);</p>
<p>如果没有指定，xulrunner 会试图查找 content （chrome.manifest 中，content 指令指明的目录）中与 package 同名的 xul 文件，例如chrome/content/myapp.xul。</p>
<ul>
<li>application.ini<br><a href="https://developer.mozilla.org/en-US/docs/XUL_Application_Packaging" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL_Application_Packaging</a></li>
</ul>
<p>注意  Profile=MyAppData 可以指定Profile目录。在linux上是 $HOME/.MyAppData。</p>
<h3 id="Deploying"><a href="#Deploying" class="headerlink" title="Deploying"></a>Deploying</h3><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Deploying_XULRunner_1.8" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Deploying_XULRunner_1.8</a></p>
<pre><code>installdir/
    application.ini
    components/
        ... components which are part of the application
    chrome/
        ... chrome which is part of the application
    ... additional application files such as icons, etc
    myapplicationname.exe (This is the &quot;stub executable&quot;... you should copy and rename this file from xulrunner-stub.exe in your XULRunner installation.)
    xulrunner/
        ... copy xulrunner/ to this directory</code></pre><p>When deploying with XULRunner 2.0 and above do the following:</p>
<pre><code>Move chrome.manifest to the root directory, and adjust resource paths inside chrome.manifest accordingly

With XULRunner 9.0 or 10.0 you may need to copy &quot;mozutils.dll&quot; and/or &quot;mozcrt19.dll&quot; from the xulrunner directory to the root directory. This should be fixed with XULRunner 11.0

With XULRunner 11.0 you may need to copy &quot;gkmedias.dll&quot; from the xulrunner directory to the root directory</code></pre><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>linux/windows：<br>xulrunner <path_to_app>/application.ini</p>
<p>使用firefox:<br>firefox -app path/to/application.ini</p>
<h3 id="全屏-fullscreen"><a href="#全屏-fullscreen" class="headerlink" title="全屏/fullscreen"></a>全屏/fullscreen</h3><p>xul 26 可支持全屏，但默认没有打开，mybrowser例子可以在about:config中搜索full-screen打开。<br>相关选项：<br>full-screen-api.enabled;true<br>full-screen-api.allow-trusted-requests-only;true<br>full-screen-api.approval-required;true<br>full-screen-api.content-only;false<br>full-screen-api.pointer-lock.enabled;true</p>
<p>一般只需要改 full-screen-api.enabled 一项。</p>
<p>不过窗口管理似乎需要自己实现，mybrowser例子的全屏只是占满整个viewport。</p>
<h3 id="给-xulrunner-安装扩展"><a href="#给-xulrunner-安装扩展" class="headerlink" title="给 xulrunner 安装扩展"></a>给 xulrunner 安装扩展</h3><ul>
<li>FF 扩展的兼容性<br><a href="http://stackoverflow.com/questions/18588542/run-firefox-extensions-in-xulrunner" target="_blank" rel="noopener">http://stackoverflow.com/questions/18588542/run-firefox-extensions-in-xulrunner</a><br>Existing extensions may run, with or without modifications in such a xulrunner app. Well, likely with modifications, as most extensions use APIs specific to Firefox or Thunderbird or …</li>
</ul>
<p>The add-on SDK is not generally isn’t a good fit for generic xulrunner apps: It is too much tailered against Firefox specifically.<br><a href="http://stackoverflow.com/questions/8334415/adding-add-on-bar-to-a-custom-xulrunner-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/8334415/adding-add-on-bar-to-a-custom-xulrunner-application</a></p>
<ul>
<li><p>将扩展安装到 xulrunner 本身中<br>在 xulrunner 目录下建立如下子目录<br>distribution/bundles/&lt;扩展的名字&gt;<br>然后将扩展的文件放到&lt;扩展的名字&gt;下面，让install.rdf、chrome.manifest等文件位于&lt;扩展的名字&gt;目录下；如果是xpi文件则要解压。<br>&lt;扩展的名字&gt; 应该可以随便取。</p>
</li>
<li><p>将扩展安装到 xulrunner app 中<br>在 xulrunner 应用的目录下建立如下子目录：<br>extensions/&lt;扩展的名字&gt;<br>将扩展的文件放到&lt;扩展的名字&gt;下面，让install.rdf、chrome.manifest等文件位于&lt;扩展的名字&gt;目录下。<br>或者将扩展的xpi文件直接放到extensions/下面，例如<br>extensions/&lt;扩展的名字&gt;.xpi<br>注意 &lt;扩展的名字&gt; 不可随便取，应当等于 install.rdf 中的 em:id 的值。</p>
</li>
<li><p>Extension Manager<br><a href="https://developer.mozilla.org/en-US/docs/XULRunner_tips#Extension_Manager" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XULRunner_tips#Extension_Manager</a></p>
</li>
<li><p>扩展的更新<br><a href="http://stackoverflow.com/questions/12055985/updating-extensions-in-a-xulrunner-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/12055985/updating-extensions-in-a-xulrunner-application</a><br>可以设置自动更新扩展</p>
</li>
</ul>
<h3 id="XUL-语法和控件"><a href="#XUL-语法和控件" class="headerlink" title="XUL 语法和控件"></a>XUL 语法和控件</h3><ul>
<li>样式表<?xml-stylesheet href="chrome://global/skin" type="text/css"?>
这个引用的是默认样式表。如果要自定义，可以在自定义样式表中引入，例如<br>in xul:<?xml-stylesheet href="chrome://basicapp/skin/main.css" type="text/css"?>
in basicapp/skin/main.css:<br>@import url(chrome://global/skin/);</li>
</ul>
<p>html 样式表是怎样的？</p>
<ul>
<li><p>namespace<br>xmlns:xul =”<a href="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;" target="_blank" rel="noopener">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</a><br>xmlns:html=”<a href="http://www.w3.org/1999/xhtml&quot;" target="_blank" rel="noopener">http://www.w3.org/1999/xhtml&quot;</a><br>注意 xul 中允许混合 html标签。</p>
</li>
<li><p>window<br>这是顶层元素<br>&lt;xul:window title     =”&amp;mybrowser.title;”</p>
<pre><code>      xmlns:xul =&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;
      xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;
      id        =&quot;mybrowser&quot;
      width     =&quot;800&quot;
      height    =&quot;600&quot;&gt;</code></pre></li>
<li><p>script<br>&lt;xul:script type=”application/javascript”</p>
<pre><code>          src=&quot;chrome://myapp/content/mybrowser.js&quot; /&gt;</code></pre><p>html script 可以吗？</p>
</li>
<li><p>browser 组件<br>&lt;xul:browser flex=”1”</p>
<pre><code>           id  =&quot;browser&quot;
           src =&quot;&quot;
           type=&quot;content-primary&quot; /&gt;</code></pre></li>
</ul>
<h2 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h2><p><a href="http://kb.mozillazine.org/Starting_your_Mozilla_application_with_a_specified_profile#Bypassing_the_Profile_Manager" target="_blank" rel="noopener">http://kb.mozillazine.org/Starting_your_Mozilla_application_with_a_specified_profile#Bypassing_the_Profile_Manager</a></p>
<p>启动profile管理器来选择一个profile：<br>  <xul_app> -P<br>直接选择指定的 profile 名字：<br>  <xul_app> -P profileName<br>直接选择指定的 profile 路径。如果是个空目录，则会在该目录中创建新 profile。<br>  <xul_app> -profile path_to_profile</p>
<p><xul_app> 可以是 firefox，xulrunner，xulrunner-stub 等。</p>
<p><xul_app> 最终是调用 XRE_main(argc, argv, …) 函数，以上参数都是传给这个函数的。<br>以编程的方式增加 XRE_main() 的参数也可以实现自定义 profile 路径，例如 duanyao/xulrunner-stub。</p>
<p>另一个自定义 profile 路径的方法是使用 nsIDirectoryServiceProvider，自定义 “ProfD”。geckofx 采用此方法。</p>
<h2 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h2><h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><p>从 FF 43 起，扩展将被要求有数字签名才能运行。<br>普通版的 FF 没有可以关闭签名验证的选项，而 developer edition 可以通过修改 xpinstall.signatures.required 偏好来关闭签名验证。<br>签名的方法见[Add-ons/Extension Signing]。</p>
<h3 id="Comparing-Extension-Toolchains"><a href="#Comparing-Extension-Toolchains" class="headerlink" title="Comparing_Extension_Toolchains"></a>Comparing_Extension_Toolchains</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Comparing_Extension_Toolchains" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Comparing_Extension_Toolchains</a></p>
<p>There are three common methods of developing extensions: the Add-on SDK, manually bootstrapped restartless extensions, and legacy, overlay-based restartful extensions.</p>
<h3 id="传统-extention"><a href="#传统-extention" class="headerlink" title="传统 extention"></a>传统 extention</h3><p>Building_an_Extension<br>  <a href="https://developer.mozilla.org/en-US/docs/Building_an_Extension" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Building_an_Extension</a></p>
<p>Getting_Started_with_Firefox_Extensions<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/Getting_Started_with_Firefox_Extensions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/Getting_Started_with_Firefox_Extensions</a></p>
<p>The_Essentials_of_an_Extension<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/The_Essentials_of_an_Extension" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Overlay_Extensions/XUL_School/The_Essentials_of_an_Extension</a><br>  install.rdf</p>
<p>Setting_up_extension_development_environment<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Setting_up_extension_development_environment" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Setting_up_extension_development_environment</a></p>
<p>Install_Manifests (intall.rdf)<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Install_Manifests" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Install_Manifests</a></p>
<p>Chrome_Registration (chrome.manifest)<br>  <a href="https://developer.mozilla.org/en-US/docs/Chrome_Registration" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Chrome_Registration</a></p>
<h3 id="设置开发环境"><a href="#设置开发环境" class="headerlink" title="设置开发环境"></a>设置开发环境</h3><ul>
<li>新建开发 profile<br>firefox -no-remote -P dev</li>
</ul>
<p>-no-remote 是必要的，这样可以同时运行多个ff进程。</p>
<ul>
<li>链接开发中的扩展到 profile<br>定位到刚才创建的 profile 下的 extensions 目录，创建一个文本文件，名字是你的 extension 的 id （在install.rdf中），<br>内容是到你的 extension 的全路径，而且要以 /或\结尾。</li>
</ul>
<h3 id="Bootstrapped-extensions"><a href="#Bootstrapped-extensions" class="headerlink" title="Bootstrapped extensions"></a>Bootstrapped extensions</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Bootstrapped_extensions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Bootstrapped_extensions</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Extensions/bootstrap.js" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Extensions/bootstrap.js</a></p>
<p><a href="http://www.oxymoronical.com/blog/2011/01/Playing-with-windows-in-restartless-bootstrapped-extensions" target="_blank" rel="noopener">http://www.oxymoronical.com/blog/2011/01/Playing-with-windows-in-restartless-bootstrapped-extensions</a></p>
<h3 id="Add-on-SDK"><a href="#Add-on-SDK" class="headerlink" title="Add-on SDK"></a>Add-on SDK</h3><p>The Add-on SDK consists of two things:</p>
<pre><code>a command-line tool to help test and package extensions
a set of JavaScript APIs, built into Firefox, to create extensions, including APIs to build user interfaces, to interact with the browser and to interact with web content</code></pre><p><a href="https://developer.mozilla.org/en-US/Add-ons/SDK" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Installation</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/cfx" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/cfx</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Add_a_Menu_Item_to_Firefox" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tutorials/Add_a_Menu_Item_to_Firefox</a></p>
<ul>
<li>command line tool<br>If you give –profiledir a path to a nonexistent profile, cfx will create a profile there for you. So you just have to make up a path and name the first time, and keep using it:</li>
</ul>
<p>cfx run –profiledir=”~/addon-dev/profiles/boogaloo”</p>
<ul>
<li>resource<br>属于扩展的资源放在data/目录下，其url的解析要使用<br>self.data.url() 函数，例如：<br>var self = require(“sdk/self”);<br>var url = self.data.url(“content.htm”);<br>得到的结果类似：<br>resource://jid1-mf8k5xsb2s4vng-at-jetpack/hello/data/content.htm</li>
</ul>
<p>注意 resource: 协议下的文档默认是没有特权的。</p>
<ul>
<li><p>High/Low-Level APIs<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs</a></p>
</li>
<li><p>package.json<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/package_json" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Tools/package_json</a></p>
</li>
<li><p>chrome<br>chrome.manifest 文件默认是没有的，也没有可以用 chrome: 协议访问的资源。<br>可以在工程根目录下自行建立这些文件，例如<br>chrome.manifest<br>chrome/<br>content/<br>locale/<br>skin/</p>
</li>
</ul>
<p>chrome.manifest 的内容是：<br>content  hello  chrome/content/<br>…</p>
<p>注意，chrome 目录的名字是固定的，否则 SDK 认不出来（其它情况下不要求）。</p>
<ul>
<li>io_file<br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_file" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_file</a><br><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_byte-streams" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/io_byte-streams</a></li>
</ul>
<p>功能不是很强，不适合高效地处理二进制文件。</p>
<h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><p><a href="https://developer.mozilla.org/en/extension_versioning,_update_and_compatibility" target="_blank" rel="noopener">https://developer.mozilla.org/en/extension_versioning,_update_and_compatibility</a></p>
<h3 id="打包和安装"><a href="#打包和安装" class="headerlink" title="打包和安装"></a>打包和安装</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Extension_Packaging" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Extension_Packaging</a></p>
<p>An XPI (XPInstall) file is simply a ZIP file containing the extension files, with the install.rdf file at the root of the ZIP. Users can download and install XPI files off a website or from a local file, by opening it or dragging it into the Extension Manager window.</p>
<p>Install extension files directly</p>
<p>If you know the location of the application (if you are installing an extension as part of the application installer, for example), you can install the extension files directly to <appdir>/extensions/<extensionID>. The extension will be found automatically by the extension manager the next time the application is launched.</p>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><p><a href="https://developer.mozilla.org/en-US/Add-ons/Extension_Frequently_Asked_Questions" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Extension_Frequently_Asked_Questions</a></p>
<h2 id="特殊协议chrome-和resource"><a href="#特殊协议chrome-和resource" class="headerlink" title="特殊协议chrome:和resource:"></a>特殊协议chrome:和resource:</h2><p>参考：<br><a href="https://developer.mozilla.org/en-US/docs/Chrome_Registration" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Chrome_Registration</a><br><a href="https://developer.mozilla.org/en-US/docs/XUL/Tutorial/The_Chrome_URL" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/Tutorial/The_Chrome_URL</a></p>
<p>两者都可以用 chrome.manifest 文件来注册</p>
<h3 id="chrome"><a href="#chrome" class="headerlink" title="chrome"></a>chrome</h3><p>content</p>
<p>A content package is registered with the line</p>
<p>content packagename uri/to/files/ [flags]</p>
<p>This will register a location to use when resolving the URI chrome://packagename/content/…. The URI may be absolute or relative to the location of the manifest file. Note: it must end with a ‘/‘.</p>
<p>注意包名（packagename）只能用小写字母，否则会引起大小写不一致的问题，因为<br>FF 会在读取 src/href 等 WebIDL 属性时将包名部分都转化为小写。参考：<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=132183" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=132183</a></p>
<p>chrome 协议下的页面有特权，但是不可以访问 DOM storage。详见 DOM Storage。</p>
<h3 id="resource"><a href="#resource" class="headerlink" title="resource"></a>resource</h3><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><ul>
<li>chrome.manifest 注册法<br>在 chrome.manifest 文件中，Aliases can be created using the resource instruction:</li>
</ul>
<p>resource aliasname uri/to/files/ [flags]</p>
<p>This will create a mapping for resource://<aliasname>/ URIs to the path given.</p>
<p>当前目录的写法是 ‘./‘。</p>
<p>chrome.manifest 也可以动态注册、删除，即利用 nsIComponentManager<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIComponentManager" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIComponentManager</a></p>
<p>addBootstrappedManifestLocation((in nsILocalFile aLocation)<br>  Loads a “bootstrapped” chrome.manifest file from the specified directory or XPI file. A “bootstrapped” chrome manifest supports some of the instructions allowed in a regular chrome manifest, see the Chrome Registration documentation for details.</p>
<p>void removeBootstrappedManifestLocation(in interface nsILocalFile aLocation);</p>
<p>在 JS 中，可以用 Components.manager 获得实例。<br>在 geckofx 中，可以通过 Xpcom.ComponentManager 属性得到实例。</p>
<ul>
<li>resource 动态注册法<br>也可以在js代码中注册 resource alias<br>参考 <a href="https://developer.mozilla.org/en/Using_JavaScript_code_modules#Programmatically_adding_aliases" target="_blank" rel="noopener">https://developer.mozilla.org/en/Using_JavaScript_code_modules#Programmatically_adding_aliases</a><br>中 Extending resource: URLs 一节。</li>
</ul>
<p>这个方法也可以注册本地磁盘目录为 resource alias。</p>
<p>用于 bootstrap addon 时（参考 <a href="http://starkravingfinkle.org/blog/2011/01/restartless-add-ons-more-resources/）：" target="_blank" rel="noopener">http://starkravingfinkle.org/blog/2011/01/restartless-add-ons-more-resources/）：</a></p>
<p>function startup(aData, aReason) {<br>  let resource = Services.io.getProtocolHandler(“resource”).QueryInterface(Ci.nsIResProtocolHandler);<br>  let alias = Services.io.newFileURI(aData.installPath);<br>  if (!aData.installPath.isDirectory())<br>    alias = Services.io.newURI(“jar:” + alias.spec + “!/“, null, null);<br>  resource.setSubstitution(“myaddonpackage”, alias);<br>  …<br>}</p>
<p>function shutdown(aData, aReason) {<br>  if (aReason == APP_SHUTDOWN) return;</p>
<p>  let resource = Services.io.getProtocolHandler(“resource”).QueryInterface(Ci.nsIResProtocolHandler);<br>  resource.setSubstitution(“myaddonpackage”, null);<br>  …</p>
<p>The isDirectory check is needed because it is possible for add-ons to be installed in folders or XPI bundles, which require the jar: URI syntax. The code adds a resource alias, after which you can use URIs like this:</p>
<p>resource://myaddonpackage/images/someimage.png<br>resource://myaddonpackage/content/somescript.js</p>
<p>注：可以注册多个 resource: 别名。</p>
<ul>
<li><p>限制<br>resource: 映射的路径似乎必须在 addon 的根目录下，否则虽然能注册成功，但访问会失败，xhr访问的时候得到onerror事件，但没有写出原因。</p>
</li>
<li><p>addon-sdk<br>注意：addon-sdk开发的扩展不用 chrome.manifest 注册，即使在 chrome.manifest 写了 resource 指令也是无效的。<br>参考：<a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/XUL_Migration_Guide</a><br><a href="https://blog.mozilla.org/addons/2012/01/11/sdk-1-4-known-issue-with-hard-coding-resource-uris/" target="_blank" rel="noopener">https://blog.mozilla.org/addons/2012/01/11/sdk-1-4-known-issue-with-hard-coding-resource-uris/</a><br>addon-sdk 的资源总是在 data 目录下，构建的时候复制到 resources 目录下。<br>addon-sdk 采用动态注册法。</p>
</li>
<li><p>权限<br>resource 协议下的页面没有特权，但是可以访问 DOM storage。详见 DOM Storage。<br>There are no security restrictions preventing web content from including content at resource: URIs, so take care what you make visible there.<br>[似乎是说，任意的web页面也可以访问 resource: URIs，所以不要放敏感内容在这里]</p>
</li>
</ul>
<h2 id="manifest-的其他特性"><a href="#manifest-的其他特性" class="headerlink" title="manifest 的其他特性"></a>manifest 的其他特性</h2><h3 id="chrome-1"><a href="#chrome-1" class="headerlink" title="chrome"></a>chrome</h3><p>chrome path_to_manifest<br>chrome 指令可以用来引入另一个 .manifest 文件，这个文件就不一定要叫 chrome.manifest 了。例如<br>  chrome components.manifest</p>
<h3 id="locale"><a href="#locale" class="headerlink" title="locale"></a>locale</h3><p>  locale branding zh-CN zh-CN/locale/branding/</p>
<h3 id="override"><a href="#override" class="headerlink" title="override"></a>override</h3><p>用来覆盖一个之前（如在omni.ja中）定义的文件，例如<br>  override chrome://global/locale/dom/dom.properties zh-CN/locale/global/dom/dom.properties</p>
<h3 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces"></a>interfaces</h3><p>用来引入 JS 的 XPCOM 接口定义文件（.xpt），它决定了 Components.interfaces 的内容。<br>  interfaces interfaces.xpt</p>
<h3 id="使用-jar-协议"><a href="#使用-jar-协议" class="headerlink" title="使用 jar 协议"></a>使用 jar 协议</h3><p>manifest 也可以引用位于 zip 包中的位置，这需要在路径部分使用 jar 协议，例如：<br>  content devtools jar:devtools.zip!/chrome/devtools/content/</p>
<p>“jar:” 后面跟上 zip 文件的相对路径，”!” 后面跟上 zip 内部的路径。<br>jar 协议适用于 content, resource, locale 等指令，但似乎不适用 chrome 和 interfaces 指令。</p>
<h2 id="XULRunner-net绑定"><a href="#XULRunner-net绑定" class="headerlink" title="XULRunner .net绑定"></a>XULRunner .net绑定</h2><h3 id="geckofx"><a href="#geckofx" class="headerlink" title="geckofx"></a>geckofx</h3><ul>
<li>源码<br>源码库在此：<a href="https://bitbucket.org/geckofx" target="_blank" rel="noopener">https://bitbucket.org/geckofx</a><br>最新版：<a href="https://bitbucket.org/geckofx/geckofx-29.0" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0</a></li>
</ul>
<p>已经包含以前的版本，可以导出版本历史：<br>hg log &gt; log.txt<br>然后查找版本号“13.0”之类的tag，然后用hg转到该版本：<br>hg update v13.0-0.1</p>
<ul>
<li>编译</li>
</ul>
<p>下载XULRunner发行版，解压到PutXulRunnerFolderHere中。<br>注意geckofx的版本要和xulrunner一致，它没有向下兼容性。</p>
<p>VS /monodevelpe直接编译即可。运行GeckoFxTest工程。</p>
<ul>
<li>profile 目录<br>默认的是在 local application data directory下，例如<br>C:\Users\duanyao\AppData\Local\Geckofx\DefaultProfile<br>可以通过 Xpcom.ProfileDirectory 设置和读取。</li>
</ul>
<ul>
<li>注册xulrunner应用、扩展<br>geckofx 不会像 xulrunner 可执行程序那样自动注册 xulrunner 应用及其扩展。<br>如果 xulrunner 自带扩展，则扩展仍要逐一注册，不会自动注册。<br>注册至少包括以下3个步骤（顺序应该没关系）：</li>
</ul>
<ul>
<li><p>注册 chrome: 协议映射<br>仍用 chrome.manifest 文件来定义映射，然后调用：<br>Xpcom.ComponentManager.AddBootstrappedManifestLocation(chromeDir)<br>chromeDir 指向 chrome.manifest 文件所在的目录。</p>
</li>
<li><p>注册 XPCOM 组件<br>仍用 chrome.manifest 文件登记组件。<br>Xpcom.ComponentRegistrar.AutoRegister(chromeFile);<br>chromeFile 指向 chrome.manifest 文件（不是目录）。</p>
</li>
<li><p>注册 preference<br>GeckoPreferences.Load(preffile);<br>preffile 指向包含 pref 调用的 js 文件。</p>
</li>
</ul>
<p>注意，这个方法是有副作用的：将preffile设置为用户的pref文件，这样，当用户通过 about:config 修改偏好后，会把用户设置的偏好都写入该文件。<br>不过，通过 GeckoPreferences.User[] 设置的偏好则不会触发写入，但写入时会包括GeckoPreferences.User[]设置的值。<br>为了避免覆盖 preffile，可以多次调用 GeckoPreferences.Load，在最后一次传入一个临时文件。<br>GeckoPreferences.Load 最终调用 xpcom 接口 nsIPrefService::ReadUserPrefs()，ReadUserPrefs 的这个行为可能是bug。<br>nsIPrefService::ReadUserPrefs() 的实现在：<br><a href="http://mxr.mozilla.org/mozilla-central/source/modules/libpref/src/Preferences.cpp#581" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/modules/libpref/src/Preferences.cpp#581</a><br>  ReadAndOwnUserPrefFile(aFile); //这应该是原因所在，故意的。<br>虽然文档上说可以给 nsIPrefService::ReadUserPrefs() 传入 null，将读取默认的 pref.js，但实际上会抛出异常。我们注意到在geckofx的profile目录下，没有pref.js，这可能是geckofx的bug。<br>所以，为了避免麻烦，在geckofx上不要通过 about:config 修改偏好。</p>
<ul>
<li>窗口</li>
</ul>
<ul>
<li>创建隐藏窗口<br>AppShellService.CreateHiddenWindow() </li>
</ul>
<ul>
<li>mozilla IDL 到 C# 的翻译器 IDLImp or IDLImporter<br><a href="https://bitbucket.org/geckofx/idlimp" target="_blank" rel="noopener">https://bitbucket.org/geckofx/idlimp</a><br>如果要使用自定义的 XPCOM 组件，可以用这个工具生成 C# 接口。不过好像有一些错误。</li>
</ul>
<h3 id="OpenGeckoSharp"><a href="#OpenGeckoSharp" class="headerlink" title="OpenGeckoSharp"></a>OpenGeckoSharp</h3><p><a href="https://github.com/quantum1423/OpenGeckoSharp" target="_blank" rel="noopener">https://github.com/quantum1423/OpenGeckoSharp</a></p>
<h2 id="JSM"><a href="#JSM" class="headerlink" title="JSM"></a>JSM</h2><p>Using_JavaScript_code_modules <a href="https://developer.mozilla.org/en/Using_JavaScript_code_modules" target="_blank" rel="noopener">https://developer.mozilla.org/en/Using_JavaScript_code_modules</a><br>通过Javascript code modules在XUL文件之间使用全局变量  <a href="http://blog.csdn.net/forumz/article/details/5719678" target="_blank" rel="noopener">http://blog.csdn.net/forumz/article/details/5719678</a></p>
<p>var EXPORTED_SYMBOLS = [“foo”, “bar”];<br>function foo() {<br>  return “foo”;<br>}<br>var bar = {<br>  name : “bar”,<br>  size : “3”<br>};<br>var dummy = “dummy”;</p>
<p>注意：对于 xulrunner 应用，如果修改了 jsm 文件，则必需修改 application.ini 中的 BuildID，否则实际加载的总是旧版本！</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Services.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Services.jsm</a></p>
<p>Services.jsm<br>In This Article</p>
<p>The Services.jsm JavaScript code module offers a wide assortment of lazy getters that simplify the process of obtaining references to commonly used services.</p>
<h3 id="使用-CommonJS-模块"><a href="#使用-CommonJS-模块" class="headerlink" title="使用 CommonJS 模块"></a>使用 CommonJS 模块</h3><p>// import require() into your scope.<br>const { require } = Cu.import(“resource://gre/modules/commonjs/toolkit/require.js”, {})<br>// import the SDK’s base64 module<br>var base64 = require(“sdk/base64”);<br>base64.encode(“hello”); // “aGVsbG8=”<br>// import my module<br>var myModule = require(“resource://path/to/my/module.js”);</p>
<h2 id="preference"><a href="#preference" class="headerlink" title="preference"></a>preference</h2><p><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Preferences" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Preferences</a><br><a href="http://stackoverflow.com/questions/3796084/about-config-preferences-and-js" target="_blank" rel="noopener">http://stackoverflow.com/questions/3796084/about-config-preferences-and-js</a></p>
<p>// Get the “accessibility.” branch<br>var prefs = Components.classes[“@mozilla.org/preferences-service;1”]<br>                    .getService(Components.interfaces.nsIPrefService).getBranch(“accessibility.”);</p>
<p>// prefs is an nsIPrefBranch.<br>// Look in the above section for examples of getting one.<br>var value = prefs.getBoolPref(“typeaheadfind”); // get a pref (accessibility.typeaheadfind)<br>prefs.setBoolPref(“typeaheadfind”, !value); // set a pref (accessibility.typeaheadfind)</p>
<p>preference 条目的文档<br><a href="http://kb.mozillazine.org/About%3aconfig_entries" target="_blank" rel="noopener">http://kb.mozillazine.org/About%3aconfig_entries</a></p>
<p>defaults/preferences/prefs.js 不支持编程结构，参考<br>  <a href="https://developer.mozilla.org/en-US/docs/Default_Preferences" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Default_Preferences</a></p>
<p>保存 prefs<br>var prefService = Components.classes[“@mozilla.org/preferences-service;1”]<br>                               .getService(Components.interfaces.nsIPrefService);<br>prefService.savePrefFile(null);</p>
<h2 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h2><p>File I/O<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O</a></p>
<p>nsIFile<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIFile" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIFile</a></p>
<p>FileUtils.jsm<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/FileUtils.jsm?redirectlocale=en-US&amp;redirectslug=JavaScript_code_modules%2FFileUtils.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/FileUtils.jsm?redirectlocale=en-US&amp;redirectslug=JavaScript_code_modules%2FFileUtils.jsm</a></p>
<ul>
<li>OS.File<br><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File</a></li>
</ul>
<p>OS.File is a new API designed for efficient, off-main thread, manipulation of files by privileged JavaScript code. This API is intended to replace, in time, most XPCOM-based manipulation of files (nsIFile, subsets of nsIIOService, etc.) by JavaScript code.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.File_for_the_main_thread" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.File_for_the_main_thread</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/OSFile.jsm/OS.File.DirectoryIterator_for_the_main_thread" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/OSFile.jsm/OS.File.DirectoryIterator_for_the_main_thread</a><br><a href="https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.Path" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/JavaScript_OS.File/OS.Path</a></p>
<p>XUL环境下的文件 IO 用这个库应该就足够了，不需要再与 sream 打交道。</p>
<p>OS.File.copy(sourcePath, destPath) 函数可以用于复制文件，不过似乎存在bug，在复制完成前promise就会完成：<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1166027" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1166027</a></p>
<p>一些有用的路径：<br>  OS.Constants.Path.profileDir profile 的路径。如果在 application.ini 中设置了 Profile=MyAppData，则 OS.Constants.Path.profileDir 为 $HOME/.MyAppData/xxx.default。<br>  tmpDir 临时目录<br>  homeDir 用户主目录</p>
<ul>
<li>特殊路径<br>var iop = Components.classes[“@mozilla.org/file/directory_service;1”]<pre><code>    .getService(Components.interfaces.nsIProperties);</code></pre>var dir = iop.get(“ProfD”, Components.interfaces.nsIFile);</li>
</ul>
<p>其中 ProfD 可以替换为：<br>CurProcD     Current working directory (usually the application’s installation directory).<br>ProfD     The profile directory.<br>Home     The user’s home directory (for example, /home/username).<br>更多的值可以参考：<br><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/File_I_O</a></p>
<ul>
<li><p>HTML5 File API<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/File" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/File</a><br>Gecko notes</p>
<p>  In Gecko, you can use this(File) API from chrome code. See Using the DOM File API in chrome code for details.<br>  Starting in Gecko 6.0 (Firefox 6.0 / Thunderbird 6.0 / SeaMonkey 2.3), privileged code (such as extensions) can pass an nsIFile object to the DOM File constructor to specify the file to reference.<br>  Starting in Gecko 8.0 (Firefox 8.0 / Thunderbird 8.0 / SeaMonkey 2.5), you can use new File to create File objects from XPCOM component code instead of having to instantiate the nsIDOMFile object directly.</p>
</li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Extensions/Using_the_DOM_File_API_in_chrome_code" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Extensions/Using_the_DOM_File_API_in_chrome_code</a></p>
<p>不过，看来这种用法只适于读文件，而不是写文件。</p>
<p>在特权代码中，File.mozFullPath 属性表示 File 对象的全路径。</p>
<ul>
<li><p>Channel<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChannel" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChannel</a><br>This interface allows clients to construct ‘GET’ requests for specific protocols, and manage them in a uniform way. </p>
</li>
<li><p>Stream<br>Binary Stream<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryOutputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryOutputStream</a><br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryInputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIBinaryInputStream</a></p>
</li>
</ul>
<p>Stream_Guide<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Stream_Guide</a><br>ScriptableInputStream<br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIScriptableInputStream" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIScriptableInputStream</a></p>
<ul>
<li><p>NetUtil<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/NetUtil.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/NetUtil.jsm</a></p>
<p>asyncFetch()</p>
</li>
</ul>
<p>The asyncFetch() method opens an input source, asynchronously, and gives an nsIInputStream containing the data obtained to the callback provided. The callback may then consume data from the input stream passed to the callback.</p>
<p>readInputStreamToString()</p>
<h2 id="DOM-Storage"><a href="#DOM-Storage" class="headerlink" title="DOM Storage"></a>DOM Storage</h2><p>chrome: 协议代码中无法使用 localStorage/sessionStorage 等。尽管这些对象是存在的，但访问它们会出现异常。参考：<br>Can’t access localStorage from chrome:// <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=495747" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=495747</a> 未来可能会解决。</p>
<p>注意，也无法将 localStorage 替换为自定义实现，赋值无效。<br>可能的变通是：</p>
<ol>
<li><p>使用 resource: 协议代码。但这种代码没有特权。参考<br><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=562646" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=562646</a></p>
</li>
<li><p>1 另一个变体是，使用http等协议，但是拦截请求。</p>
</li>
<li><p>将自定义实现绑定到另一个名字，例如 xxxLocalStorage。<br>具体的，可以使用 XPCOM 获得一个绑定到普通域的 localStorage，然后绑定到 xxxLocalStorage。参考<br><a href="http://stackoverflow.com/questions/20195541/html-5-local-storage-in-xul-application" target="_blank" rel="noopener">http://stackoverflow.com/questions/20195541/html-5-local-storage-in-xul-application</a></p>
</li>
</ol>
<p>var url = “<a href="http://example.com&quot;" target="_blank" rel="noopener">http://example.com&quot;</a>;<br>var ios = Components.classes[“@mozilla.org/network/io-service;1”]<br>          .getService(Components.interfaces.nsIIOService);<br>var ssm = Components.classes[“@mozilla.org/scriptsecuritymanager;1”]<br>          .getService(Components.interfaces.nsIScriptSecurityManager);<br>var dsm = Components.classes[“@mozilla.org/dom/storagemanager;1”]<br>          .getService(Components.interfaces.nsIDOMStorageManager);</p>
<p>var uri = ios.newURI(url, “”, null);<br>var principal = ssm.getCodebasePrincipal(uri);<br>var storage = dsm.getLocalStorageForPrincipal(principal, “”);</p>
<p>storage.setItem(“chromekey”, “chromevalue”);</p>
<h2 id="Javascript-集成"><a href="#Javascript-集成" class="headerlink" title="Javascript 集成"></a>Javascript 集成</h2><p>XPConnect<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/XPConnect" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/XPConnect</a></p>
<p>mozIJSSubScriptLoader<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIJSSubScriptLoader" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIJSSubScriptLoader</a><br>This interface can be used from privileged JavaScript to load and run JavaScript code from the given URL at runtime.<br>var mozIJSSubScriptLoader = Components.classes[“@mozilla.org/moz/jssubscript-loader;1”]<br>                            .getService(Components.interfaces.mozIJSSubScriptLoader);</p>
<h3 id="geckofx-js-and-native-interop"><a href="#geckofx-js-and-native-interop" class="headerlink" title="geckofx js and native interop"></a>geckofx js and native interop</h3><p>D:\project\geckofx-29.0.hg\Geckofx-Core\AutoJSContext.cs<br>D:\project\geckofx-29.0.hg\Geckofx-Core\JQuery\JQueryExecutor.cs<br>D:\project\geckofx-29.0.hg\Geckofx-Core\Interop\SpiderMonkey\SpiderMonkey.cs</p>
<p>D:\project\geckofx-29.0.hg\GeckofxUnitTests\GeckoWebBrowserTests.cs<br>D:\project\geckofx-29.0.hg\GeckofxUnitTests\XPConnectTests.cs<br>D:\project\geckofx-29.0.hg\GeckofxUnitTests\XpComTests.cs</p>
<pre><code>    public void EvaluateScript_SimpleJavascript_ScriptExecutesAndReturnsExpectedResult()
    {
        browser.TestLoadHtml(&quot;&quot;);

        using (AutoJSContext context = new AutoJSContext(browser.Window.JSContext))
        {                
            string result;
            Assert.IsTrue(context.EvaluateScript(&quot;3 + 2;&quot;, out result));
            Assert.AreEqual(5, Int32.Parse(result));

            Assert.IsTrue(context.EvaluateScript(&quot;&#39;hello&#39; + &#39; &#39; + &#39;world&#39;;&quot;, out result));
            Assert.AreEqual(&quot;hello world&quot;, result);
        }                
    }</code></pre><p>var instance = Xpcom.CreateInstance<nsISupports>(“@mozilla.org/byte-buffer;1”);</p>
<h2 id="页面加载状态监视和错误处理"><a href="#页面加载状态监视和错误处理" class="headerlink" title="页面加载状态监视和错误处理"></a>页面加载状态监视和错误处理</h2><p><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIWebProgressListener" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIWebProgressListener</a></p>
<p>LOCATION_CHANGE_ERROR_PAGE This flag indicates that aWebProgress redirected from the requested document to an internal page to show error status, such as about:neterror, about:certerror and so on. </p>
<h3 id="geckofx-1"><a href="#geckofx-1" class="headerlink" title="geckofx"></a>geckofx</h3><p>GeckoWebBrowser 有以下.net事件：<br>browser.Navigating<br>  开始导航到某个页面。注意这个事件也会在页面内导航、子框架（frame）导航时产生。<br>  GeckoNavigatingEventArgs.DomWindowTopLevel表示是否是顶层窗口的导航事件, GeckoNavigatingEventArgs.DomWindow 为事件相关的窗口。<br>  这时可以取消导航，GeckoNavigatingEventArgs 是 CancelEventArgs 的子类。<br>browser.Navigated<br>  导航结束，页面将开始解析（如果是新页面）。注意这个事件也会在错误页面、页面内导航、子框架（frame）导航时产生。<br>  （1）如果是新页面，这时JS上下文已经创建，可以注入和执行JS（AutoJSContext.EvaluateScript）；但页面本身尚未解析，html中的JS都还没有开始执行，<br>  因此这是注入跨语言交互代码的理想时机。<br>  （2）如果加载页面时发生网络错误，并且启用了内置错误页面（设置偏好 browser.xul.error_pages.enabled = true），则 GeckoNavigatedEventArgs.IsErrorPage == true；但HTTP错误（4xx, 5xx）不会反映在这里（TODO 如何检测）。顺提，如果没有启用了内置错误页面，则网络错误会通过对话框报告，详见PromptService。<br>  （3）GeckoNavigatedEventArgs.IsSameDocument 表示结局是否仍为原来的文档（即页面内跳转）；GeckoNavigatedEventArgs.DomWindowTopLevel 表示是否是顶层窗口的导航事件，<br>    GeckoNavigatedEventArgs.DomWindow 为事件相关的窗口。<br>browser.Load<br>  类似于 js window.onload 事件，不过会在 js window.onload 事件之前执行。所以如果有要在网页加载完后做处理，更好的时机是 DocumentCompleted 事件。<br>browser.ReadyStateChange<br>  等效于 JS 中的 document 的 readystatechange 事件，可以通过 browser.Window.Document.ReadyState:string 查询状态，有interactive, complete等。<br>browser.DocumentCompleted<br>  新页面、无网络错误时，在 Load 和 JS load 事件之后触发。<br>  如果要对加载完的页面做修改，这是个合适的地方。<br>  GeckoDocumentCompletedEventArgs 与 GeckoNavigatedEventArgs 类似，注意区分错误页面（无此参数）、页面内导航、子框架导航，HTTP错误。<br>  注意，如果有网络错误，并加载了错误页面，这个事件会在 Navigated 事件之前发生。</p>
<p>总结一下网络错误、并加载了错误页面时的事件：</p>
<p>使用服务器上关闭的端口时，此方法被调用<br>void nsIWebProgressListener.OnStatusChange(nsIWebProgress aWebProgress, nsIRequest aRequest, int aStatus, string aMessage)<br>aMessage    aStatus<br>Looking up <a href="http://www.baidu.com…">www.baidu.com…</a>   -2142568445<br>Connecting to <a href="http://www.baidu.com…">www.baidu.com…</a>    -2142568441</p>
<p>void nsIWebProgressListener.OnStateChange(nsIWebProgress aWebProgress, nsIRequest aRequest, uint aStateFlags, int aStatus)</p>
<p>PromptService : nsIPromptService2,nsIPrompt</p>
<h2 id="Clipboard"><a href="#Clipboard" class="headerlink" title="Clipboard"></a>Clipboard</h2><p><a href="https://developer.mozilla.org/en-US/docs/Using_the_Clipboard" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Clipboard</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Jetpack/docs/System/Clipboard" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Jetpack/docs/System/Clipboard</a></p>
<h2 id="Debugging-调试"><a href="#Debugging-调试" class="headerlink" title="Debugging/调试"></a>Debugging/调试</h2><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></p>
<h3 id="prefs"><a href="#prefs" class="headerlink" title="prefs"></a>prefs</h3><p>/* debugging prefs */<br>pref(“browser.dom.window.dump.enabled”, true);<br>pref(“javascript.options.showInConsole”, true);<br>pref(“javascript.options.strict”, true);<br>pref(“nglayout.debug.disable_xul_cache”, true);<br>pref(“nglayout.debug.disable_xul_fastload”, true);</p>
<p>也可以打开 about:config 来设置。</p>
<h3 id="本地控制台"><a href="#本地控制台" class="headerlink" title="本地控制台"></a>本地控制台</h3><p>也就是window.dump()方法，打印到操作系统控制台。默认情况下，dump没有启用，要设置偏好：<br>pref(“browser.dom.window.dump.enabled”, true);</p>
<p>在windows上，GUI程序默认没有控制台，要采用 -console 参数来启动 FF/xulrunner 才可以打开控制台。<br>此外，windows 的控制台默认编码不是UTF-8，中文系统上是 GBK，这会导致 dump 输出的中文乱码。</p>
<p>启动控制台编码  重定向文件编码 控制台编码 控制台是否乱码<br>utf8    utf8  gbk 是<br>gbk utf8    gbk 是</p>
<h3 id="debug-server"><a href="#debug-server" class="headerlink" title="debug server"></a>debug server</h3><p>参考<br>[1] <a href="https://developer.mozilla.org/en-US/docs/Tools/Remote_Debugging/Debugging_Firefox_Desktop" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Tools/Remote_Debugging/Debugging_Firefox_Desktop</a><br>[2]（37+已过时） <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></p>
<p>怎样跟踪 firefox 中调试服务代码的变化？</p>
<ul>
<li>调试服务的源码是 devtools 的一部分，在 devtools/ 目录下；发布后则在 omni.ja!/modules/devtools 中。</li>
<li>可以在 mxr 搜索源码中的关键字：start-debugger-server（启动调试服务的命令行参数）, DebuggerServer, 6000 (调试服务的默认端口), &quot;devtools&quot;, debugger 等。</li>
</ul>
<p>在xul应用中，要打开DebuggerServer[2]（这个方法对 37+ 就不适用了）：<br>Components.utils.import(‘resource://gre/modules/devtools/dbg-server.jsm’);<br>if (!DebuggerServer.initialized) {<br>  DebuggerServer.init();<br>  DebuggerServer.addBrowserActors(null);<br>}<br>DebuggerServer.openListener(6000);<br>并设置属性允许远程调试：<br>pref(“devtools.debugger.remote-enabled”, true);</p>
<p>对于geckofx来说，每个进程只需要运行这个过程一次即可，不需要在每个窗口中运行。</p>
<p>然后用ff的 web开发者-&gt;连接 来进行远程调试。</p>
<p>远程调试 firefox 37+ 时，用<br>firefox.exe -P a_profile -no-remote -start-debugger-server 6101<br>启动被调试进程，设定允许chrome调试和远程调试，然后用另一个 firefox 实例连接调试。</p>
<p>或者，在浏览器中打开 chrome://browser/content/browser.xul 直接调试。</p>
<p>对于 xulrunner 37+，可以参考 firefox 的代码：</p>
<p>function startDebugNew() {<br>//<a href="http://mxr.mozilla.org/mozilla-central/search?string=start-debugger-server" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/search?string=start-debugger-server</a><br>//<a href="http://mxr.mozilla.org/mozilla-central/source/browser/devtools/devtools-clhandler.js#28" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/browser/devtools/devtools-clhandler.js#28</a><br>    var portOrPath = 6101;<br>    let { DevToolsLoader } =<br>      Cu.import(“resource://gre/modules/devtools/Loader.jsm”, {});</p>
<pre><code>try {
  // Create a separate loader instance, so that we can be sure to receive
  // a separate instance of the DebuggingServer from the rest of the
  // devtools.  This allows us to safely use the tools against even the
  // actors and DebuggingServer itself, especially since we can mark
  // serverLoader as invisible to the debugger (unlike the usual loader
  // settings).
  let serverLoader = new DevToolsLoader();
  serverLoader.invisibleToDebugger = true;
  serverLoader.main(&quot;devtools/server/main&quot;);
  let debuggerServer = serverLoader.DebuggerServer;
  debuggerServer.init();
  debuggerServer.addBrowserActors();
  debuggerServer.allowChromeProcess = true;

  let listener = debuggerServer.createListener();
  listener.portOrPath = portOrPath;
  listener.open();
  dump(&quot;startDebugNew:Started debugger server on &quot; + portOrPath + &quot;\n&quot;);
} catch(e) {
  dump(&quot;startDebugNew:Unable to start debugger server on &quot; + portOrPath + &quot;: &quot; + e);
}</code></pre><p>}</p>
<p>对于 xulrunner 45+ （实际上是firefox 45+ 伪装的），xulrunner 的 omni.ja 缺少了</p>
<h3 id="JavaScript-Console"><a href="#JavaScript-Console" class="headerlink" title="JavaScript Console"></a>JavaScript Console</h3><p>To enable the JS console, start XULRunner with the -jsconsole argument.<br>Note: If you are not using the stub executable to launch the application, the -jsconsole argument is after the application.ini argument: e.g. xulrunner.exe /path/to/application.ini -jsconsole</p>
<p>By default the JS console only shows errors from web content. To show errors in chrome JavaScript, the pref pref(“javascript.options.showInConsole”, true) must be set.</p>
<p>不过，console.log/error 输出的信息似乎无法显示在 JavaScript Console 中，eval也无法访问执行上下文中的对象，只有未捕获异常才会显示出来。</p>
<h3 id="本地js调试器"><a href="#本地js调试器" class="headerlink" title="本地js调试器"></a>本地js调试器</h3><ul>
<li>Venkman<br>这个扩展可以弹出一个gui调试器，不过需要在应用中去调用 Venkman 的函数，因此有特权代码可以启动它。<br>安装到 xulrunner 中的办法参考本文”给 xulrunner 安装扩展“一节。<br>按照此处的指引安装 Venkman 是可以的（注意装到xulrunner目录下），注意Troubleshooting一节。<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/XULRunner/Debugging_XULRunner_applications</a></li>
</ul>
<h3 id="mozrepl"><a href="#mozrepl" class="headerlink" title="mozrepl"></a>mozrepl</h3><p><a href="https://github.com/bard/mozrepl/" target="_blank" rel="noopener">https://github.com/bard/mozrepl/</a> – 原版<br><a href="https://github.com/duanyao/mozrepl" target="_blank" rel="noopener">https://github.com/duanyao/mozrepl</a> – 打补丁适配 geckofx 的版本</p>
<p>这个扩展可以安装到FF、xulrunner app 或 xulrunner 本身当中。运行时，它在被调试的进程中开启一个telnet服务（端口4242），用telnet客户端连结上去以后可以执行js表达式和语句。<br>不过，它目前似乎在 geckofx 中跑不起来。</p>
<p>安装到 xulrunner 中的办法参考本文”给 xulrunner 安装扩展“一节。</p>
<p>运行 app 时，追加 -repl 参数即可启动 mozrepl。<br>如果要自动启动，设置 pref extensions.mozrepl.autoStart = true（mozrepl/defaults/preferences/mozrepl.js中）。</p>
<p>连接：<br>localhost 4242</p>
<p>在Windows上，如果没有 telnet 命令，可以安装 netcat 来代替：<br><a href="http://code.google.com/p/yesanshare/downloads/detail?name=nc111nt.zip&amp;can=2&amp;q=" target="_blank" rel="noopener">http://code.google.com/p/yesanshare/downloads/detail?name=nc111nt.zip&amp;can=2&amp;q=</a><br>安装 nc.exe 到 path 中，然后<br>nc localhost 4242</p>
<p>命令参考：<br><a href="https://github.com/bard/mozrepl/wiki/Tutorial" target="_blank" rel="noopener">https://github.com/bard/mozrepl/wiki/Tutorial</a></p>
<ul>
<li>geckofx 适配<br>在.net代码中，首先要按照geckofx一节中”注册xulrunner应用、扩展“的描述注册 mozrepl，然后启动服务器：<br>var mozrepl = Xpcom.CreateInstance&lt;MozRepl.nsIMozRepl&gt;(“@hyperstruct.net/mozlab/mozrepl;1”);<br>mozrepl.Start(4242, true | false);</li>
</ul>
<p>geckofx 的一个问题是 nsIWindowMediator 没有包含任何窗口，所以要查询 nsIWindowWatcher 来代替，详见：<br><a href="https://github.com/duanyao/mozrepl" target="_blank" rel="noopener">https://github.com/duanyao/mozrepl</a></p>
<ul>
<li>代码分析<br>mozrepl 监听 profile-after-change 事件（似乎会在程序启动时触发），如果设置了 autoStart = true，则启动服务器。</li>
</ul>
<p>profile-after-change 监听是在 chrome.manifest 中注册的，参考：<br><a href="http://stackoverflow.com/questions/3169852/how-to-listen-to-profile-after-change-in-xpcom-component-for-ff4" target="_blank" rel="noopener">http://stackoverflow.com/questions/3169852/how-to-listen-to-profile-after-change-in-xpcom-component-for-ff4</a><br>监听的实现代码在 mozrepl/chrome/content/server.js:observe</p>
<p>服务器是个 XPCOM 组件。<br>接口：nsIMozRepl（MozRepl.idl）<br>实现：mozrepl/chrome/content/server.js<br>CONTRACT_ID = ‘@hyperstruct.net/mozlab/mozrepl;1’<br>CLASS_ID = 57f4284b-1f9b-4990-8525-9ed5cbb23e01<br>启动、停止服务器的方法是<br>void start(in short port, in boolean loopbackOnly);<br>void stop();</p>
<h3 id="本地代码调试"><a href="#本地代码调试" class="headerlink" title="本地代码调试"></a>本地代码调试</h3><p>VS 中设置 Mozilla symbol server<br><a href="https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_symbol_server" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_symbol_server</a></p>
<p>对于 xulrunner 设置 symbol server<br><a href="http://symbols.mozilla.org/xulrunner" target="_blank" rel="noopener">http://symbols.mozilla.org/xulrunner</a></p>
<p>并且只允许加载下面的符号，以免太慢<br>xul.dll<br>mozjs.dll<br>mozglue.dll</p>
<p>以及 Mozilla source server<br><a href="https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_source_server" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Using_the_Mozilla_source_server</a></p>
<p>也可以下载源码包，解压后，当用VS调试时点击调用栈，VS会询问源文件的位置，选择解压后的源文件即可。<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Source_Code/Downloading_Source_Archives" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Source_Code/Downloading_Source_Archives</a></p>
<h2 id="拦截网络请求"><a href="#拦截网络请求" class="headerlink" title="拦截网络请求"></a>拦截网络请求</h2><p>Firefox 扩展可以拦截网络请求和回复，因此可以用特殊的http url表示模拟的本地文件系统。<br>参考：<br>  <a href="http://stackoverflow.com/questions/2141469/create-firefox-addon-to-watch-and-modify-xhr-requests-reponses" target="_blank" rel="noopener">http://stackoverflow.com/questions/2141469/create-firefox-addon-to-watch-and-modify-xhr-requests-reponses</a><br>  <a href="http://www.softwareishard.com/blog/firebug/nsitraceablechannel-intercept-http-traffic/" target="_blank" rel="noopener">http://www.softwareishard.com/blog/firebug/nsitraceablechannel-intercept-http-traffic/</a><br>  <a href="http://stackoverflow.com/questions/7222577/firefox-extension-cancel-requests-and-emit-fake-responses" target="_blank" rel="noopener">http://stackoverflow.com/questions/7222577/firefox-extension-cancel-requests-and-emit-fake-responses</a><br>  <a href="https://developer.mozilla.org/en-US/docs/XUL/School_tutorial/Intercepting_Page_Loads" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XUL/School_tutorial/Intercepting_Page_Loads</a><br>  <a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a> http-on-opening-request</p>
<ul>
<li><p>The Easy Way: Load Events<br>监听全局浏览器对象 gBrowser 的 “load” 事件。这个事件类似 web 中的 load 事件，是针对tab中的主文档或iframe中的文档的。<br>可以趁机修改DOM，但是不能在DOM构建前取消或修改响应。</p>
</li>
<li><p>HTTP Observers<br>对每个http请求都发出事件。允许在请求发出前修改头，或者取消请求，或者在收到响应后修改响应。<br>使用 nsITraceableChannel，可以在收到响应后修改内容，然后再传递给原来的发起者。<br>相关文档：<br><a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a><br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/NsITraceableChannel" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/NsITraceableChannel</a><br>但是，看起来请求还是会发到原来请求的url，并不能做成完全合成的请求/响应。</p>
</li>
<li><p>WebProgressListeners<br>针对每个 xul browser 实例（也就是浏览器tab），每个tab打开关闭的时候要添加删除监听器。</p>
</li>
<li><p>XPCOM Solutions<br>Document Loader Service<br>相当于全局 Web Progress Listener.<br>nsIDocumentLoader is nothing but a global Web Progress Listener. You can create an XPCOM component that extends nsIWebProgressListener and use the addProgressListener method in the service to include it. </p>
</li>
</ul>
<p>Content Policy<br>只能用于取消请求。</p>
<h2 id="自定义协议处理器"><a href="#自定义协议处理器" class="headerlink" title="自定义协议处理器"></a>自定义协议处理器</h2><p>Firefox 扩展可以添加自定义协议处理器。<br>  <a href="http://mike.kaply.com/2011/01/18/writing-a-firefox-protocol-handler/" target="_blank" rel="noopener">http://mike.kaply.com/2011/01/18/writing-a-firefox-protocol-handler/</a><br>  <a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIProtocolHandler" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIProtocolHandler</a></p>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><p><a href="https://developer.mozilla.org/en-US/docs/Displaying_web_content_in_an_extension_without_security_issues" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Displaying_web_content_in_an_extension_without_security_issues</a></p>
<p><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages</a></p>
<h3 id="同源规则"><a href="#同源规则" class="headerlink" title="同源规则"></a>同源规则</h3><p>mozilla 平台似乎没有 chrome 那样的命令行或API可以关掉同源规则。参考：<br><a href="http://stackoverflow.com/questions/17711924/disable-cross-domain-web-security-in-firefox" target="_blank" rel="noopener">http://stackoverflow.com/questions/17711924/disable-cross-domain-web-security-in-firefox</a><br><a href="http://stackoverflow.com/questions/17088609/disable-firefox-same-origin-policy" target="_blank" rel="noopener">http://stackoverflow.com/questions/17088609/disable-firefox-same-origin-policy</a><br><a href="http://stackoverflow.com/questions/330427/can-i-disable-sop-same-origin-policy-on-any-browser-for-development" target="_blank" rel="noopener">http://stackoverflow.com/questions/330427/can-i-disable-sop-same-origin-policy-on-any-browser-for-development</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Same-origin_policy_for_file:_URIs" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Same-origin_policy_for_file:_URIs</a></p>
<p>Force CORS Firefox Extension<br><a href="http://www-jo.se/f.pfleger/forcecors" target="_blank" rel="noopener">http://www-jo.se/f.pfleger/forcecors</a></p>
<p>过去的FF，可以修改 profile 目录下的 prefs.js，加入<br>user_pref(“capability.principal.myapp.id”, “file:///D:/project/MyHTML/xhrtest.html”);<br>user_pref(“capability.principal.myapp.granted”, “UniversalBrowserRead”);<br>注意 about:config 不显示这类配置。<br>但是看起来这个特性被删除了，不起作用，而且FF关闭时会删除这样的配置。</p>
<p>总结起来就是，最近的FF（28+），不支持放开非特权页面的特权，只有 chrome: 协议的页面能绕开同源限制。参考：<br><a href="https://developer.mozilla.org/en-US/docs/Bypassing_Security_Restrictions_and_Signing_Code" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Bypassing_Security_Restrictions_and_Signing_Code</a></p>
<h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>navigator.mozTCPSocket 或者 navigator.TCPSocket 是可以用于浏览器环境的 TCP Socket 实现。<br>W3C正在讨论中，目前只有 mozilla 实现了，只能在特权代码或者特权 web app 中使用。<br>在 xulrunner 或桌面 firefox 中，目前（40）需要设置 dom.mozTCPSocket.enabled = true 来启用（<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1079648）。" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1079648）。</a></p>
<h2 id="mozilla-跨不同权限页面的交互"><a href="#mozilla-跨不同权限页面的交互" class="headerlink" title="mozilla 跨不同权限页面的交互"></a>mozilla 跨不同权限页面的交互</h2><h3 id="frame-嵌入"><a href="#frame-嵌入" class="headerlink" title="frame 嵌入"></a>frame 嵌入</h3><p>特权页面中可以嵌入非特权页面，但反过来不行，只会显示一个空白页。</p>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><p>给非特权页面的 WebIDL 添加的扩展方法，特权页面并不能有效访问，可能是因为安全限制：<br><a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Interaction_between_privileged_and_non-privileged_pages</a><br>Gecko prevents chrome to access custom object properties added by the content, because that can create security holes.<br>Never invoke the web page’s JavaScript functions from your extension - doing this increases the chance of creating a security hole, where a malicious web page can trick the browser to run its code with extended privileges (just like your extension) with, for example, the ability to delete local files.</p>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><ul>
<li>web message<br>特权页面可以给非特权页面发送 web message；但从非特权页面发给特权页面似乎没有效果。</li>
</ul>
<h2 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h2><h3 id="dbus"><a href="#dbus" class="headerlink" title="dbus"></a>dbus</h3><ul>
<li><p>mozjs-dbus<br><a href="https://github.com/codebutler/mozjs-dbus/wiki" target="_blank" rel="noopener">https://github.com/codebutler/mozjs-dbus/wiki</a><br>makes it possible for Mozilla/Javascript-based applications and extensions to interoperable with<br>D-Bus, which allows for deep integration with the Linux desktop.<br>代码相当老了（5年）。</p>
</li>
<li><p>Browser DBus Bridge<br><a href="http://sandbox.movial.com/wiki/index.php/Browser_DBus_Bridge" target="_blank" rel="noopener">http://sandbox.movial.com/wiki/index.php/Browser_DBus_Bridge</a><br>The Browser D-Bus Bridge is a JavaScript D-Bus bindings implementation for web browsers. The Bridge allows privileged JavaScript code to talk to the D-Bus, both session and system bus (if not prohibited by the D-Bus configuration).</p>
</li>
</ul>
<p>The bridge currently supports Gecko-based and WebKit-based browsers. Each of these have their own implementation of the Bridge due to technical differences in the integration, but support the same API on the JavaScript side.<br>代码相当老了。</p>
<ul>
<li>D-Bus and other Linux desktop integration improvements, DBuzilla<br><a href="http://zenit.senecac.on.ca/wiki/index.php/D-Bus_and_other_Linux_desktop_integration_improvements" target="_blank" rel="noopener">http://zenit.senecac.on.ca/wiki/index.php/D-Bus_and_other_Linux_desktop_integration_improvements</a><br>代码相当老了（7年）。</li>
</ul>
<h2 id="嵌入"><a href="#嵌入" class="headerlink" title="嵌入"></a>嵌入</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/API_overview" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/API_overview</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Gecko/Embedding_Mozilla/Roll_your_own_browser" target="_blank" rel="noopener">Roll your own browser: An embedding how-to</a> on MDN. (out dated)</p>
<p>将Mozilla源码里的内嵌Gecko示例winEmbed工程移植到VC (1.9)<br>  <a href="http://blog.csdn.net/mzlogin/article/details/7292310" target="_blank" rel="noopener">http://blog.csdn.net/mzlogin/article/details/7292310</a></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><ul>
<li>nsIWebBrowser</li>
</ul>
<p>This is the primary interface to the WebBrowser component.</p>
<ul>
<li><p>nsIWebBrowserSetup<br>SETUP_IS_CHROME_WRAPPER=7<br>Boolean. Marks whether the browser is a chrome wrapper. A value of PR_TRUE means the browser is a chrome wrapper. The default value is PR_FALSE. </p>
</li>
<li><p>nsIWebBrowserChrome</p>
</li>
</ul>
<p>This interface provides access to the window containing an nsWebBrowser instance.</p>
<ul>
<li><p>nsIChromeRegistry<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChromeRegistry" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIChromeRegistry</a></p>
</li>
<li><p>nsIXULAppInfo<br>In XULRunner applications nsIXULAppInfo obtains app-specific information from application.ini.<br><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIXULAppInfo" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIXULAppInfo</a></p>
</li>
<li><p>nsIXULRuntime<br>Provides information about the XUL runtime to allow extensions and XUL applications to determine information about the XUL runtime. </p>
</li>
<li><p>nsIAppShell<br>Interface for the native event system layer. This interface is designed to be used on the main application thread only. </p>
</li>
<li><p>nsIAppStartup<br>This interface is intended to be used as application startup service. It also helps in quitting applications as well. </p>
</li>
<li><p>nsIAppShellService<br>Provides the AppShellService. </p>
</li>
<li><p>nsIFile/nsILocalFile<br>创建<br>var localFile = Components.classes[“@mozilla.org/file/local;1”]</p>
<pre><code>          .createInstance(Components.interfaces.nsILocalFile);</code></pre><p>或者<br>Components.utils.import(“resource://gre/modules/FileUtils.jsm”);</p>
</li>
</ul>
<p>var file = new FileUtils.File(“/home”);</p>
<p>初始化<br>localFile.initWithPath(in AString filePath);<br>  js 中直接传入string，geckofx中传入nsAString对象。</p>
<h3 id="应用的解析"><a href="#应用的解析" class="headerlink" title="应用的解析"></a>应用的解析</h3><ul>
<li>application.ini 的解析<br>browser/app/nsBrowserApp.cpp 或者<br>xulrunner/app/nsXULRunnerApp.cpp</li>
</ul>
<p><a href="http://mxr.mozilla.org/mozilla-central/source/xulrunner/app/nsXULRunnerApp.cpp" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/xulrunner/app/nsXULRunnerApp.cpp</a></p>
<p>277   nsCOMPtr<nsIFile> appDataLF;<br>278   rv = XRE_GetFileFromPath(appDataFile, getter_AddRefs(appDataLF));<br>279   if (NS_FAILED(rv)) {<br>280     Output(true, “Error: unrecognized application.ini path.\n”);<br>281     return 2;<br>282   }<br>283<br>284   AutoAppData appData(appDataLF);<br>285   if (!appData) {<br>286     Output(true, “Error: couldn’t parse application.ini.\n”);<br>287     return 2;<br>288   }<br>290   return XRE_main(argc, argv, appData, 0);</p>
<p>解析代码的实现在<br><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/CreateAppData.cpp#15" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/CreateAppData.cpp#15</a></p>
<p>nsresult XRE_CreateAppData(nsIFile* aINIFile, nsXREAppData **aAppData)</p>
<p>xul 应用入口函数是 XRE_main<br><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#4227" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#4227</a><br> XRE_main(int argc, char* argv[], const nsXREAppData* aAppData, uint32_t aFlags)</p>
<p><a href="http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2719" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2719</a><br>2718 // Encapsulates startup and shutdown state for XRE_main<br>2719 class XREMain</p>
<ul>
<li>chrome.manifest 的解析<br><a href="http://mxr.mozilla.org/mozilla-central/source/xpcom/build/nsXULAppAPI.h#263" target="_blank" rel="noopener">http://mxr.mozilla.org/mozilla-central/source/xpcom/build/nsXULAppAPI.h#263</a><br>240 /<em>*<br>241  * Register XPCOM components found in an array of files/directories.<br>242  * This method may be called at any time before or after XRE_main or<br>243  * XRE_InitEmbedding.<br>244  *<br>245  * @param aFiles An array of files or directories.<br>246  * @param aFileCount the number of items in the aFiles array.<br>247  * @note appdir/components is registered automatically.<br>248  *<br>249  * NS_COMPONENT_LOCATION specifies a location to search for binary XPCOM<br>250  * components as well as component/chrome manifest files.<br>251  *<br>252  * NS_SKIN_LOCATION specifies a location to search for chrome manifest files<br>253  * which are only allowed to register only skin packages and style overlays.<br>254  */<br>255 enum NSLocationType<br>256 {<br>257   NS_COMPONENT_LOCATION,<br>258   NS_SKIN_LOCATION,<br>259   NS_BOOTSTRAPPED_LOCATION<br>260 };<br>261<br>262 XRE_API(nsresult,<br>263         XRE_AddManifestLocation, (NSLocationType aType,<br>264                                   nsIFile</em> aLocation))</li>
</ul>
<p>另一个可能的方法是 nsIComponentManager.addBootstrappedManifestLocation((in nsILocalFile aLocation)<br>geckofx 中的代码例子：<br>            var chromeDir = Xpcom.CreateInstance<nsILocalFile> (“@mozilla.org/file/local;1”);<br>            chromeDir.InitWithPath (new nsAString (“D:\project\MBEditor.js.git\mozApp”));<br>            Xpcom.ComponentManager.AddBootstrappedManifestLocation (chromeDir);</p>
<h2 id="JS-引擎：SpiderMonkey"><a href="#JS-引擎：SpiderMonkey" class="headerlink" title="JS 引擎：SpiderMonkey"></a>JS 引擎：SpiderMonkey</h2><p><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_User_Guide" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_User_Guide</a></p>
<h3 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h3><p>JS_AddRoot/JS_RemoveRoot<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_AddRoot" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_AddRoot</a><br>The JS_Add*Root and functions add a C/C++ variable to the garbage collector’s root set, the set of variables used as starting points each time the collector checks to see what memory is reachable. The garbage collector aggressively collects and recycles memory that it deems unreachable, so roots are often necessary to protect data from being prematurely collected.</p>
<h3 id="mozjs-函数签名"><a href="#mozjs-函数签名" class="headerlink" title="mozjs 函数签名"></a>mozjs 函数签名</h3><p>?JS_EvaluateUCScript@@YA_NPAUJSContext@@V?$Handle@PAVJSObject@@@JS@@PB_WIPBDIV?$MutableHandle@VValue@JS@@@3@@Z<br>?JS_ExecuteScript@@YA_NPAUJSContext@@PAVJSObject@@PAVJSScript@@PAVValue@JS@@@Z</p>
<p>bool JS_EvaluateUCScript(struct JSContext *,class JS::Handle&lt;class JSObject *&gt;,wchar_t const *,unsigned int,char const *,unsigned int,class JS::MutableHandle<class JS::Value>)<br>bool JS_ExecuteScript(struct JSContext *,class JSObject *,class JSScript *,class JS::Value *)</p>
<p>DomMessageEventArgs</p>
<p>internal string ConvertValueToString(JsVal value)<br><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars</a></p>
<p>wchar_t const * JS_GetStringCharsZAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsZAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>wchar_t const * JS_GetStringCharsZ(struct JSContext *,class JSString *)<br>?JS_GetStringCharsZ@@YAPB_WPAUJSContext@@PAVJSString@@@Z</p>
<p>wchar_t const * JS_GetStringCharsAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>unsigned int JS_GetStringLength(class JSString *)<br>?JS_GetStringLength@@YAIPAVJSString@@@Z</p>
<p>?JS_EvaluateUCScript@@YA_NPAUJSContext@@V?$Handle@PAVJSObject@@@JS@@PB_WIPBDIV?$MutableHandle@VValue@JS@@@3@@Z<br>?JS_ExecuteScript@@YA_NPAUJSContext@@PAVJSObject@@PAVJSScript@@PAVValue@JS@@@Z</p>
<p>bool JS_EvaluateUCScript(struct JSContext *,class JS::Handle&lt;class JSObject *&gt;,wchar_t const *,unsigned int,char const *,unsigned int,class JS::MutableHandle<class JS::Value>)<br>bool JS_ExecuteScript(struct JSContext *,class JSObject *,class JSScript *,class JS::Value *)</p>
<p>DomMessageEventArgs</p>
<p>internal string ConvertValueToString(JsVal value)<br><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/SpiderMonkey/JSAPI_Reference/JS_GetStringChars</a></p>
<p>wchar_t const * JS_GetStringCharsZAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsZAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>wchar_t const * JS_GetStringCharsZ(struct JSContext *,class JSString *)<br>?JS_GetStringCharsZ@@YAPB_WPAUJSContext@@PAVJSString@@@Z</p>
<p>wchar_t const * JS_GetStringCharsAndLength(struct JSContext *,class JSString *,unsigned int *)<br>?JS_GetStringCharsAndLength@@YAPB_WPAUJSContext@@PAVJSString@@PAI@Z</p>
<p>unsigned int JS_GetStringLength(class JSString *)<br>?JS_GetStringLength@@YAIPAVJSString@@@Z</p>
<h2 id="omni"><a href="#omni" class="headerlink" title="omni"></a>omni</h2><p>omni.ja 文件是个特殊的 zip 文件（windows explorer 可打开，7zip不行），里面包含moz平台的界面的xul/css/js代码，包括调试器(devtools)等。</p>
<p>omni.ja 这个文件名有特殊意义。与 xul.dll (或.so) 同一目录的 omni.ja 会被 xul.dll 自动加载；<br>与 xul 应用的 application.ini 同一目录的 omni.ja 也会被自动加载。</p>
<p>加载 omni.ja 时，会通过其内部根目录下的 chrome.manifest 来注册。</p>
<p>如果要修改、调试 xulrunner/firefox 的 omni.ja 的代码，可以将它解压在其所在的目录，再把它改名/删除。<br>正确的压缩命令：zip -qr9XD omni.ja *</p>
<p>firefox 除了在顶层目录（xul.dll所在的目录）有一个 omni.ja，还在 browser/ 目录下有一个 omni.ja。前者与 xulrunner 的相同，后者是只有 firefox 需要的文件。</p>
<p>参考：<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29" target="_blank" rel="noopener">About omni.ja (formerly omni.jar)</a><br><a href="https://blog.mozilla.org/mwu/2010/08/13/omnijar-how-does-it-work/" target="_blank" rel="noopener">Omnijar. How does it work?</a><br><a href="https://blog.mozilla.org/tglek/2010/09/14/firefox-4-jar-jar-jar/" target="_blank" rel="noopener">Firefox 4: jar jar jar</a></p>
<h2 id="本地化（中文化）-i18n"><a href="#本地化（中文化）-i18n" class="headerlink" title="本地化（中文化） i18n"></a>本地化（中文化） i18n</h2><p>xulrunner 的发行版没有中文版，所以有些界面，如错误页面，是英文的。<br>界面相关的资源在 omni.ja 文件中，这是个特殊的zip文件，参考<br><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Mozilla/About_omni.ja_%28formerly_omni.jar%29</a></p>
<p>可以用中文版 firefox 的 omni.ja 文件来替换，从而将 xulrunner 改为中文版。要注意选择与 xulrunner 版本号相同的 firefox。</p>
<p>geckofx 中，js alert/prompt 等对话框还是有英文，因为用了自定义的对话框。<br>解决办法是修改自定义对话框中的文字，或者用xulrunner本身的对话框。参考：<br>GeckoWebBrowser.UseCustomPrompt() 和 d:\Geckofx-Winforms\PromptService.cs<br><a href="http://localhost" target="_blank" rel="noopener">http://localhost</a><br>javascript:confirm(‘hh’)</p>
<h2 id="下载-TODO"><a href="#下载-TODO" class="headerlink" title="下载 TODO"></a>下载 TODO</h2><h2 id="插件-plugin"><a href="#插件-plugin" class="headerlink" title="插件/plugin"></a>插件/plugin</h2><h3 id="禁用个别插件"><a href="#禁用个别插件" class="headerlink" title="禁用个别插件"></a>禁用个别插件</h3><p><a href="http://serverfault.com/questions/340195/disable-certain-firefox-plugins-system-wide-by-default" target="_blank" rel="noopener">http://serverfault.com/questions/340195/disable-certain-firefox-plugins-system-wide-by-default</a><br>Disable Certain Firefox Plugins System-wide by Default</p>
<p>The plugins’ settings are now integrated partially in about:config as of Firefox 22, and fully in 23+. The key names are plugin.state.* where * denotes the internal naming scheme used by Firefox for the discovered plugins. The values (integer) are 0 for disabled (Never Activate in Firefox Tools (Alt + T) &gt; Add-ons &gt; Plugins), 1 for click-to-play (Ask to Activate), and 2 for enabled (Always Activate). Firefox 22 has 0 and 2, and 23+ includes all the three states. The state Ask to Activate (1) is triggered after toggling plugins.click_to_play to true in about:config.</p>
<p>One way to get the correct names used by Firefox is from a reference/IT PC. Toggle the default states of all the discovered plugins (Firefox Tools (Alt + T) &gt; Add-ons &gt; Plugins) once, to reveal the corresponding plugin.state.* keys in about:config.</p>
<p>VLC:<br>plugin.state.npvlc</p>
<p>Acrobat:<br>plugin.state.nppdf<br>注意这不影响 pdf.js。</p>
<p>Java:<br>plugin.state.java</p>
<p>Flash:<br>plugin.state.flash</p>
<p>Silverlight:<br>plugin.state.npctrl</p>
<p>在禁用后：<br>object标签如果有替代内容，则显示替代内容；如果没有，firefox 显示一个黑色窗口写着“此插件已被禁用”，xulrunner/geckofx只有一个黑窗，没有提示（可能是bug）。</p>
<h3 id="禁用全部插件"><a href="#禁用全部插件" class="headerlink" title="禁用全部插件"></a>禁用全部插件</h3><p>“plugin.disable” = true </p>
<h2 id="下载和未知内容的处理"><a href="#下载和未知内容的处理" class="headerlink" title="下载和未知内容的处理"></a>下载和未知内容的处理</h2><p>当触发a[download] 或未知类型的链接时，浏览器一般会弹出对话框提示是否用其它应用程序打开，或者下载保存链接。<br>但xulrunner应用、geckofx则有一些麻烦，有时候会出错（firefox28, xulrunner 29）。</p>
<h2 id="web控制台"><a href="#web控制台" class="headerlink" title="web控制台"></a>web控制台</h2><p>有时firefox的控制台显示“Web 控制台的日志记录API (console.log, console.info, console.warn, console.error) 已被此页面的脚本禁用。”<br>网页中的console.log是输出不了信息的。这可能是因为某些扩展的问题。尝试禁用一些扩展，看看问题是否解决了。参考：<br>Firefox的Web控制台禁用？<a href="http://codego.net/382392/" target="_blank" rel="noopener">http://codego.net/382392/</a></p>
<h2 id="内存使用，内存泄露-（memory-usage-amp-leak）"><a href="#内存使用，内存泄露-（memory-usage-amp-leak）" class="headerlink" title="内存使用，内存泄露 （memory usage &amp; leak）"></a>内存使用，内存泄露 （memory usage &amp; leak）</h2><p>A better about:memory: stage 1.75<br>  <a href="https://blog.mozilla.org/nnethercote/2011/05/23/a-better-aboutmemory-stage-1-75/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2011/05/23/a-better-aboutmemory-stage-1-75/</a></p>
<p>How to read Firefox “about:memory” correctly?<br>  <a href="http://stackoverflow.com/questions/7146108/how-to-read-firefox-aboutmemory-correctly" target="_blank" rel="noopener">http://stackoverflow.com/questions/7146108/how-to-read-firefox-aboutmemory-correctly</a></p>
<p>Zombie compartments<br>  <a href="https://developer.mozilla.org/en-US/docs/Zombie_compartments" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Zombie_compartments</a></p>
<p>Per-class JS object and shape measurements in Firefox’s about:memory<br>  <a href="https://blog.mozilla.org/nnethercote/2014/08/29/per-class-js-object-and-shape-measurements-in-firefoxs-aboutmemory/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2014/08/29/per-class-js-object-and-shape-measurements-in-firefoxs-aboutmemory/</a></p>
<p>MemShrink’s 3rd birthday<br>  <a href="https://blog.mozilla.org/nnethercote/2014/06/16/memshrinks-3rd-birthday/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2014/06/16/memshrinks-3rd-birthday/</a></p>
<p>MemShrink progress<br>  <a href="https://blog.mozilla.org/nnethercote/category/aboutcompartments/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/category/aboutcompartments/</a></p>
<p>Firefox 15 plugs the add-on leaks<br>  <a href="https://blog.mozilla.org/nnethercote/2012/07/19/firefox-15-plugs-the-add-on-leaks/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2012/07/19/firefox-15-plugs-the-add-on-leaks/</a></p>
<p>Leak Monitor Extension<br>  <a href="http://dbaron.org/mozilla/leak-monitor/" target="_blank" rel="noopener">http://dbaron.org/mozilla/leak-monitor/</a></p>
<p>Firefox memory leak detection tool<br>  <a href="http://www.squarefree.com/2006/01/13/memory-leak-detection-tool/" target="_blank" rel="noopener">http://www.squarefree.com/2006/01/13/memory-leak-detection-tool/</a></p>
<p>Please file good memory leak bugs<br>  <a href="http://dbaron.org/log/2006-01#e20060110a" target="_blank" rel="noopener">http://dbaron.org/log/2006-01#e20060110a</a></p>
<p>System-wide memory measurement for Firefox OS<br>  <a href="https://blog.mozilla.org/nnethercote/2013/12/17/system-wide-memory-measurement-for-firefox-os/" target="_blank" rel="noopener">https://blog.mozilla.org/nnethercote/2013/12/17/system-wide-memory-measurement-for-firefox-os/</a></p>
<h3 id="ghost-windows"><a href="#ghost-windows" class="headerlink" title="ghost-windows"></a>ghost-windows</h3><p>What is a “ghost window”?<br>  <a href="http://forum.palemoon.org/viewtopic.php?f=26&amp;t=3476" target="_blank" rel="noopener">http://forum.palemoon.org/viewtopic.php?f=26&amp;t=3476</a></p>
<p>Report number of ghost windows in telemetry<br>  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=737857" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=737857</a></p>
<h2 id="直接执行特权js代码"><a href="#直接执行特权js代码" class="headerlink" title="直接执行特权js代码"></a>直接执行特权js代码</h2><p>TODO<br>geckofx 中，不创建 browser 对象，直接创建 AutoJSContext:<br> new AutoJSContext()<br> new AutoJSContext(GlobalJSContextHolder.BackstageJSContext)<br>但这样的代码都没有特权，找不到 Components 对象。</p>
<h2 id="综合代码片段"><a href="#综合代码片段" class="headerlink" title="综合代码片段"></a>综合代码片段</h2><p>Code_snippets/Miscellaneous<br>  <a href="https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Miscellaneous" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Miscellaneous</a><br>包括：<br>  Saving an arbitrary URL to a local file<br>  Operating system detection</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="UcWORK统一桌面系统"><a href="#UcWORK统一桌面系统" class="headerlink" title="UcWORK统一桌面系统"></a>UcWORK统一桌面系统</h3><p><a href="http://www.qqtech.com/ucwork.htm" target="_blank" rel="noopener">http://www.qqtech.com/ucwork.htm</a></p>
<pre><code>    UcWORK基于桌面应用的设计思想，采用mozilla技术框架，并进行多方面的扩展实现，UcWork是主平台/框架，其它应用可嵌入到UcWork中，这是我们的主推目标。此种情况是“我为主，人为辅”。
    客户或代理商(第三方)可以在界面和服务器层扩展应用。界面和服务层通过UcBUS(即DBUS)交互。在服务层，UcWork除提供DBus接口外，还可提供面向服务层的API接口，供第三方服务层开发调用。</code></pre><h3 id="XULApp-StarterKit"><a href="#XULApp-StarterKit" class="headerlink" title="XULApp StarterKit"></a>XULApp StarterKit</h3><p><a href="https://github.com/racklin/xulapp-starterkit" target="_blank" rel="noopener">https://github.com/racklin/xulapp-starterkit</a></p>
<p>XULApp StarterKit is a generic framework for XULRunner applications, like Rich Client Platform .</p>
<p>It provides the “plumbing” that, before, every developer had to write themselves—saving state, connecting actions to menu items, toolbar items and keyboard shortcuts; window management, add-ons mechanism, update mechanism and so on.</p>
<h2 id="链接-内容处理方式"><a href="#链接-内容处理方式" class="headerlink" title="链接/内容处理方式"></a>链接/内容处理方式</h2><p>Document Loading - From Load Start to Finding a Handler<br>  <a href="http://www-archive.mozilla.org/docs/docshell/uri-load-start.html" target="_blank" rel="noopener">http://www-archive.mozilla.org/docs/docshell/uri-load-start.html</a><br>  <a href="https://developer.mozilla.org/en-US/docs/Document_Loading_-_From_Load_Start_to_Finding_a_Handler" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Document_Loading_-_From_Load_Start_to_Finding_a_Handler</a></p>
<p>nsIContentPolicy<br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy</a><br>Interface for content policy mechanism. Implementations of this interface can be used to control loading of various types of out-of-line content, or processing of certain types of inline content</p>
<p>nsILinkHandler<br>  an internal interface used for link clicks</p>
<p>nsIURIContentListener<br>  this gives embedders a chance to abort the load if this URI type is something they want to handle in the embedding app.<br>  <a href="http://www-archive.mozilla.org/projects/embedding/embedapiref/embedapi67.html#1086464" target="_blank" rel="noopener">http://www-archive.mozilla.org/projects/embedding/embedapiref/embedapi67.html#1086464</a><br>  onStartURIOpen() Gives the original content listener first crack at stopping a load before it happens.<br>  doContent() Notifies the content listener to hook up an nsIStreamListener capable of consuming the data stream.<br>  canHandleContent() Indicates whether the content listener is capable of handling the content. </p>
<p>NS_CONTENT_LISTENER_CATEGORYMANAGER_ENTRY of category manager</p>
<p>nsIStreamListener</p>
<p>nsIExternalHelperAppService<br>  <a href="https://developer.mozilla.org/en-US/docs/Helper_Apps_%28and_a_bit_of_Save_As%29" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Helper_Apps_%28and_a_bit_of_Save_As%29</a></p>
<p>  nsIHelperAppLauncher</p>
<p>  nsExternalAppHandler details</p>
<pre><code>Implements nsIStreamListener.
Gets notifications from Necko as the data comes in.
Four primary tasks:
    Sets up temporary file and instantiate the nsIHelperAppLauncherDialog in OnStartRequest.
    Puts the data in the file as OnDataAvailable notifications come in.
    Knows how to launch a helper application on the data based on the nsIMIMEInfo.
    Knows how to save the data to disk at a given location if the user decides to do so. </code></pre><h2 id="下载download"><a href="#下载download" class="headerlink" title="下载download"></a>下载download</h2><p>nsIDownloader<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloader" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloader</a></p>
<p>Downloads.jsm<br>  <a href="https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Downloads.jsm" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Downloads.jsm</a></p>
<p>nsIDownloadManager<br>  <a href="https://bitbucket.org/geckofx/geckofx-29.0/issue/73/download-completed-event-the-right-way" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0/issue/73/download-completed-event-the-right-way</a></p>
<p>Gecko.LauncherDialog.Download<br>  <a href="https://bitbucket.org/geckofx/geckofx-29.0/issue/34/how-to-download-files-using-this-engine" target="_blank" rel="noopener">https://bitbucket.org/geckofx/geckofx-29.0/issue/34/how-to-download-files-using-this-engine</a></p>
<p>base/mozglue/GeckoLoader.java.in:80:    private static void setupDownloadEnviron<br>ment(Context context)</p>
<p>base/updater/UpdateService.java:212:        int autoDownloadPolicy = getAutoDown<br>loadPolicy();</p>
<p>chrome/content/downloads.js:90:  handleClickEvent: function dl_handleClickEvent(<br>aDownload) {</p>
<h2 id="gecko-事件"><a href="#gecko-事件" class="headerlink" title="gecko 事件"></a>gecko 事件</h2><p><a href="https://developer.mozilla.org/en-US/docs/Observer_Notifications" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a></p>
<h2 id="特殊协议"><a href="#特殊协议" class="headerlink" title="特殊协议"></a>特殊协议</h2><h3 id="jar-协议"><a href="#jar-协议" class="headerlink" title="jar 协议"></a>jar 协议</h3><p>与 java 的 jar 协议没什么区别。语法是 jar:sub-url!/path-to/file-in-zip<br>注意’!’之后的路径总是以’/‘开头，不管zip中的实际条目名是否以’/‘开头。<br>jar协议的效果与file、http等没有本质的不同。不过，目前播放音视频时有个限制：未播放的部分不能seek，而且也不一定能正确显示总时长。<br>在android版mozilla上，点击jar协议引用的非web文件，例如.doc，也无法调动外部程序来打开（这应该是个bug）。</p>
<h2 id="新的嵌入-API"><a href="#新的嵌入-API" class="headerlink" title="+ 新的嵌入 API"></a>+ 新的嵌入 API</h2><p><a href="https://wiki.mozilla.org/Embedding/IPCLiteAPI" target="_blank" rel="noopener">https://wiki.mozilla.org/Embedding/IPCLiteAPI</a></p>
<h2 id="外部进程的创建和管理"><a href="#外部进程的创建和管理" class="headerlink" title="外部进程的创建和管理"></a>外部进程的创建和管理</h2><p>gecko 实现了一套与 node.js child_process 兼容的 API：</p>
<p><a href="https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/system_child_process</a></p>
<p>// Import SDK Stuff<br>var COMMONJS_URI = ‘resource://gre/modules/commonjs’;<br>var { require } = Components.utils.import(COMMONJS_URI + ‘/toolkit/require.js’, {});<br>var child_process = require(‘sdk/system/child_process’);</p>
<p>//var ls = child_process.spawn(‘ls’, [‘.’]);<br>var ls = child_process.spawn(‘D:\software\UnxUtils\usr\local\wbin\ls.exe’, [‘D:\‘], {encoding: ‘GBK’});<br>//var ls = child_process.spawn(‘C:\Windows\System32\ipconfig.exe’, {encoding: null}); // null 得到的是按字节值直接转化的字符串</p>
<p>//ls.stdout.setEncoding(‘GBK’); //stdout.setEncoding() 目前无效<br>ls.stdout.on(‘data’, function (data) {<br>  console.log(‘stdout(‘ + data.length + ‘): ‘, data);<br>});</p>
<p>ls.stderr.on(‘data’, function (data) {<br>  console.log(‘stderr: ‘ + data);<br>});</p>
<p>ls.on(‘close’, function (code) {<br>  console.log(‘child process exited with code ‘ + code);<br>});</p>
<p>ls.on(‘error’, function (err) {<br>  console.log(‘child process error ‘, err);<br>});</p>
<p>实现代码的位置在<br>omni.jar!\modules\commonjs\sdk\system/child_process.js<br>omni.jar!\jsloader\resource\gre\modules\commonjs\sdk\system/child_process.js</p>
<p>stdout.setEncoding() 目前无效。<br>child_process.spawn(cmd, args, {encoding: ‘GBK’}) 在 Firefox 46 上有效，但 52a2 上无效。<br>也不能向 stdin 写入非ASCII字符。<br>参考：<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1180409" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=1180409</a></p>
<h2 id="JS-Ctypes"><a href="#JS-Ctypes" class="headerlink" title="JS-Ctypes"></a>JS-Ctypes</h2><p>JS 直接调用 C api.<br>js-ctypes allows application and extension code to call back and forth to native code written in C. C++ support is limited, see bug 505907 for full support. Unlike binary XPCOM components, It allows developers to ship a single binary for use with multiple versions of Firefox.</p>
<p>二进制数据优化-Harmony typed objects (nés binary data)<br>  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=578700" target="_blank" rel="noopener">https://bugzilla.mozilla.org/show_bug.cgi?id=578700</a><br>  <a href="http://wiki.ecmascript.org/doku.php?id=harmony:typed_objects" target="_blank" rel="noopener">http://wiki.ecmascript.org/doku.php?id=harmony:typed_objects</a><br>  <a href="https://github.com/Yoric/js-js-ctypes" target="_blank" rel="noopener">https://github.com/Yoric/js-js-ctypes</a></p>
<p>ChromeWorker<br>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/ChromeWorker" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/ChromeWorker</a><br>  If you’re developing privileged code, and would like to create a worker that can use js-ctypes to perform calls to native code, you can do so by using ChromeWorker instead of the standard Worker object. </p>
<h2 id="web-app"><a href="#web-app" class="headerlink" title="web app"></a>web app</h2><p>mozilla web app 是运行于 firefox OS, 桌面 firefox，移动 firefox 的 web app，三者具有大致统一的规范。<br>mozilla web app 是基于 web 标准的，再加上一些希望成为 web 标准的扩展 api。因此与firefox扩展和xulrunner应用不同，不能使用mozilla特有的底层API，包括XPCOM。<br>事实上，mozilla web app 与 chrome web app 在概念上很相似，互相移植也比较容易。</p>
<h3 id="packaged-app"><a href="#packaged-app" class="headerlink" title="packaged app"></a>packaged app</h3><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>web app 目前似乎只能通过http安装，如果通过file安装会产生invalid url错误。</p>
<h3 id="desktop-web-app"><a href="#desktop-web-app" class="headerlink" title="desktop web app"></a>desktop web app</h3><p>安装后会产生一个类似普通应用程序的入口，在windows上就是一个exe文件，例如<br>“C:\Users\duanyao\AppData\Roaming\xhrcontenttypetest-facc7b2fa7338eec4c5fd305b78b8e71\xhr content type test.exe”<br>并且也提供了反安装程序。</p>
<h3 id="android-web-app"><a href="#android-web-app" class="headerlink" title="android web app"></a>android web app</h3><p>出了从 firefox 中安装，也可以将web app打包为 apk，详见“Open Web Apps for Android”。</p>
<p>mozilla-apk-cli<br>  npm install -g mozilla-apk-cli<br>  mozilla-apk-cli ./www my_test_app.apk<br>  mozilla-apk-cli is only for testing and debugging your new Android app locally.</p>
<h3 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h3><p>Writing your first Firefox OS app<br>  <a href="http://www.adobe.com/devnet/html5/articles/writing-your-first-firefox-os-app.html" target="_blank" rel="noopener">http://www.adobe.com/devnet/html5/articles/writing-your-first-firefox-os-app.html</a><br>Getting Started with Firefox OS: Hosted and Packaged Apps<br>  <a href="http://www.sitepoint.com/getting-started-with-firefox-os-hosted-and-packaged-apps/" target="_blank" rel="noopener">http://www.sitepoint.com/getting-started-with-firefox-os-hosted-and-packaged-apps/</a><br>Packaged apps<br>  <a href="https://developer.mozilla.org/en-US/Marketplace/Options/Packaged_apps" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Marketplace/Options/Packaged_apps</a><br>Open Web Apps for Android<br>  <a href="https://developer.mozilla.org/en-US/Marketplace/Options/Open_web_apps_for_android" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/Marketplace/Options/Open_web_apps_for_android</a></p>
<h2 id="firefox-html"><a href="#firefox-html" class="headerlink" title="firefox.html"></a>firefox.html</h2><p>  Firefox.html is an experiment: trying to re-implement the Firefox UI in HTML.<br>  <a href="https://github.com/paulrouget/firefox.html" target="_blank" rel="noopener">https://github.com/paulrouget/firefox.html</a></p>
<h2 id="GeckoView"><a href="#GeckoView" class="headerlink" title="GeckoView"></a>GeckoView</h2><p><a href="http://ftp.mozilla.org/pub/mozilla.org/mobile/nightly/latest-mozilla-central-android/" target="_blank" rel="noopener">http://ftp.mozilla.org/pub/mozilla.org/mobile/nightly/latest-mozilla-central-android/</a></p>
<p>未特别指出时包为 org.mozilla.gecko</p>
<h3 id="GeckoView-1"><a href="#GeckoView-1" class="headerlink" title="GeckoView"></a>GeckoView</h3><p>mobile/android/base/GeckoView.java</p>
<p>public Browser addBrowser(String url)<br>public void removeBrowser(Browser browser)<br>public void setCurrentBrowser(Browser browser)<br>public Browser getCurrentBrowser()<br>public List<Browser> getBrowsers()<br>public void setChromeDelegate(ChromeDelegate chrome)<br>public void setContentDelegate(ContentDelegate content)<br>public static void setGeckoInterface(final BaseGeckoInterface geckoInterface)<br>public static GeckoAppShell.GeckoInterface getGeckoInterface()</p>
<p>GeckoView.Browser</p>
<p>public void loadUrl(String url)<br>public void reload()<br>public void stop()<br>public boolean canGoBack()<br>public void goBack()<br>public boolean canGoForward()<br>public void goForward()</p>
<h3 id="interface-GeckoView-ContentDelegate"><a href="#interface-GeckoView-ContentDelegate" class="headerlink" title="interface GeckoView.ContentDelegate"></a>interface GeckoView.ContentDelegate</h3><p>默认空实现 GeckoViewContent<br>onPageStart<br>onPageStop<br>onPageShow<br>onReceivedTitle</p>
<h3 id="interface-GeckoView-ChromeDelegate"><a href="#interface-GeckoView-ChromeDelegate" class="headerlink" title="interface GeckoView.ChromeDelegate"></a>interface GeckoView.ChromeDelegate</h3><p>默认实现 GeckoViewChrome<br>onReady<br>onAlert<br>onPrompt<br>onConfirm<br>onDebugRequest</p>
<h3 id="GeckoAppShell"><a href="#GeckoAppShell" class="headerlink" title="GeckoAppShell"></a>GeckoAppShell</h3><p>mobile/android/base/GeckoAppShell.java</p>
<p>//Adds a listener for a gecko event. This method is thread-safe and may be called at any time.<br>public static void registerEventListener(String event, GeckoEventListener listener)<br>public static void unregisterEventListener(String event, GeckoEventListener listener)</p>
<pre><code>    GeckoAppShell.registerEventListener(&quot;Gecko:Ready&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Content:StateChange&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Content:LoadError&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Content:PageShow&quot;, this);
    GeckoAppShell.registerEventListener(&quot;DOMTitleChanged&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Link:Favicon&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Prompt:Show&quot;, this);
    GeckoAppShell.registerEventListener(&quot;Prompt:ShowTop&quot;, this);</code></pre><p>base/Tabs.java:87:        registerEventListener(“Session:RestoreEnd”);<br>base/Tabs.java:88:        registerEventListener(“SessionHistory:New”);<br>base/Tabs.java:89:        registerEventListener(“SessionHistory:Back”);<br>base/Tabs.java:90:        registerEventListener(“SessionHistory:Forward”);<br>base/Tabs.java:91:        registerEventListener(“SessionHistory:Goto”);<br>base/Tabs.java:92:        registerEventListener(“SessionHistory:Purge”);<br>base/Tabs.java:93:        registerEventListener(“Tab:Added”);<br>base/Tabs.java:94:        registerEventListener(“Tab:Close”);<br>base/Tabs.java:95:        registerEventListener(“Tab:Select”);<br>base/Tabs.java:96:        registerEventListener(“Content:LocationChange”);<br>base/Tabs.java:97:        registerEventListener(“Content:SecurityChange”);<br>base/Tabs.java:98:        registerEventListener(“Content:ReaderEnabled”);<br>base/Tabs.java:99:        registerEventListener(“Content:StateChange”);<br>base/Tabs.java:100:        registerEventListener(“Content:LoadError”);<br>base/Tabs.java:101:        registerEventListener(“Content:PageShow”);<br>base/Tabs.java:102:        registerEventListener(“DOMContentLoaded”);<br>base/Tabs.java:103:        registerEventListener(“DOMTitleChanged”);<br>base/Tabs.java:104:        registerEventListener(“Link:Favicon”);<br>base/Tabs.java:105:        registerEventListener(“Link:Feed”);<br>base/Tabs.java:106:        registerEventListener(“Link:OpenSearch”);<br>base/Tabs.java:107:        registerEventListener(“DesktopMode:Changed”);<br>base/Tabs.java:108:        registerEventListener(“Tab:ViewportMetadata”);</p>
<p>base/GeckoApp.java:1517:        registerEventListener(“log”);<br>base/GeckoApp.java:1518:        registerEventListener(“Reader:ListCountRequest”);<br>base/GeckoApp.java:1519:        registerEventListener(“Reader:ListStatusRequest”);<br>base/GeckoApp.java:1520:        registerEventListener(“Reader:Added”);<br>base/GeckoApp.java:1521:        registerEventListener(“Reader:Removed”);<br>base/GeckoApp.java:1522:        registerEventListener(“Reader:Share”);<br>base/GeckoApp.java:1523:        registerEventListener(“Reader:FaviconRequest”);<br>base/GeckoApp.java:1524:        registerEventListener(“onCameraCapture”);<br>base/GeckoApp.java:1525:        registerEventListener(“Menu:Add”);<br>base/GeckoApp.java:1526:        registerEventListener(“Menu:Remove”);<br>base/GeckoApp.java:1527:        registerEventListener(“Menu:Update”);<br>base/GeckoApp.java:1528:        registerEventListener(“Gecko:Ready”);<br>base/GeckoApp.java:1529:        registerEventListener(“Gecko:DelayedStartup”);<br>base/GeckoApp.java:1530:        registerEventListener(“Toast:Show”);<br>base/GeckoApp.java:1531:        registerEventListener(“DOMFullScreen:Start”);<br>base/GeckoApp.java:1532:        registerEventListener(“DOMFullScreen:Stop”);<br>base/GeckoApp.java:1533:        registerEventListener(“ToggleChrome:Hide”);<br>base/GeckoApp.java:1534:        registerEventListener(“ToggleChrome:Show”);<br>base/GeckoApp.java:1535:        registerEventListener(“ToggleChrome:Focus”);<br>base/GeckoApp.java:1536:        registerEventListener(“Permissions:Data”);<br>base/GeckoApp.java:1537:        registerEventListener(“Session:StatePurged”);<br>base/GeckoApp.java:1538:        registerEventListener(“Bookmark:Insert”);<br>base/GeckoApp.java:1539:        registerEventListener(“Accessibility:Event”);<br>base/GeckoApp.java:1540:        registerEventListener(“Accessibility:Ready”);<br>base/GeckoApp.java:1541:        registerEventListener(“Shortcut:Remove”);<br>base/GeckoApp.java:1542:        registerEventListener(“Share:Text”);<br>base/GeckoApp.java:1543:        registerEventListener(“Share:Image”);<br>base/GeckoApp.java:1544:        registerEventListener(“Image:SetAs”);<br>base/GeckoApp.java:1545:        registerEventListener(“Sanitize:ClearHistory”);<br>base/GeckoApp.java:1546:        registerEventListener(“Update:Check”);<br>base/GeckoApp.java:1547:        registerEventListener(“Update:Download”);<br>base/GeckoApp.java:1548:        registerEventListener(“Update:Install”);<br>base/GeckoApp.java:1549:        registerEventListener(“PrivateBrowsing:Data”);<br>base/GeckoApp.java:1550:        registerEventListener(“Contact:Add”);<br>base/GeckoApp.java:1551:        registerEventListener(“Intent:Open”);<br>base/GeckoApp.java:1552:        registerEventListener(“Intent:GetHandlers”);<br>base/GeckoApp.java:1553:        registerEventListener(“Locale:Set”);<br>base/GeckoApp.java:1554:        registerEventListener(“NativeApp:IsDebuggable”);<br>base/GeckoApp.java:1555:        registerEventListener(“SystemUI:Visibility”);</p>
<h3 id="click"><a href="#click" class="headerlink" title="click"></a>click</h3><p>chrome/content/browser.js:1709:    Services.obs.addObserver(this, “PageActions:C<br>licked”, false);<br>chrome/content/browser.js:1710:    Services.obs.addObserver(this, “PageActions:L<br>ongClicked”, false);</p>
<h3 id="components-HelperAppDialog-js"><a href="#components-HelperAppDialog-js" class="headerlink" title="components/HelperAppDialog.js"></a>components/HelperAppDialog.js</h3><h3 id="HelperApps"><a href="#HelperApps" class="headerlink" title="HelperApps"></a>HelperApps</h3><p>mobile/android/chrome/content/HelperApps.js<br><a href="https://hg.mozilla.org/integration/fx-team/rev/dd3dd64aa432" target="_blank" rel="noopener">https://hg.mozilla.org/integration/fx-team/rev/dd3dd64aa432</a><br>  getAppsForUri</p>
<h3 id="PrefsHelper"><a href="#PrefsHelper" class="headerlink" title="PrefsHelper"></a>PrefsHelper</h3><h2 id="内存管理-GC-CC"><a href="#内存管理-GC-CC" class="headerlink" title="内存管理/GC/CC"></a>内存管理/GC/CC</h2><p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.forceGC" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.forceGC</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.schedulePreciseGC" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Language_Bindings/Components.utils.schedulePreciseGC</a><br><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Interfacing_with_the_XPCOM_cycle_collector" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Interfacing_with_the_XPCOM_cycle_collector</a></p>
<p>触发 CC:<br>var domWindowUtils = window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)<br>                     .getInterface(Components.interfaces.nsIDOMWindowUtils);<br>domWindowUtils.cycleCollect()</p>
<p>触发 JS GC:<br>异步：<br>Components.utils.schedulePreciseGC(function(){})<br>同步：<br>Components.utils.forceGC()</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">HKmaster</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://huangxok.github.io/2017/01/13/XULRunner-Gecko-Firefox/">https://huangxok.github.io/2017/01/13/XULRunner-Gecko-Firefox/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">HKmaster</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/XUL/">
                                    <span class="chip bg-color">XUL</span>
                                </a>
                            
                                <a href="/tags/XULRunner/">
                                    <span class="chip bg-color">XULRunner</span>
                                </a>
                            
                                <a href="/tags/Firefox/">
                                    <span class="chip bg-color">Firefox</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2017/03/03/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="函数式编程笔记">
                        
                        <span class="card-title">函数式编程笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2017-03-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            HKmaster
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/curry/">
                        <span class="chip bg-color">curry</span>
                    </a>
                    
                    <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">
                        <span class="chip bg-color">函数式编程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2017/01/10/webpack-note/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="webpack-note">
                        
                        <span class="card-title">webpack-note</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2017-01-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            HKmaster
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="18726943"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">HKmaster</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/huangxok" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:huangx.ok@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://twitter.com/HuangxOk" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://twitter.com/HuangxOk" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>





    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=569299387" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 569299387" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc('search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
